<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Puppet::Transaction
  
    &mdash; Documentation by YARD 0.7.5
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/docco.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/docco.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (T)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Puppet.html" title="Puppet (module)">Puppet</a></span></span>
     &raquo; 
    <span class="title">Transaction</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Puppet::Transaction
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Puppet::Transaction</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="Util.html" title="Puppet::Util (module)">Util</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/puppet/transaction.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Defined Under Namespace</h2>
<p class="children">
   
    
   
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Transaction/Change.html" title="Puppet::Transaction::Change (class)">Change</a></span>, <span class='object_link'><a href="Transaction/Event.html" title="Puppet::Transaction::Event (class)">Event</a></span>, <span class='object_link'><a href="Transaction/Report.html" title="Puppet::Transaction::Report (class)">Report</a></span>
    
  
</p>




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#catalog-instance_method" title="#catalog (instance method)">- (Object) <strong>catalog</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute catalog.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#component-instance_method" title="#component (instance method)">- (Object) <strong>component</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute component.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#configurator-instance_method" title="#configurator (instance method)">- (Object) <strong>configurator</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute configurator.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#events-instance_method" title="#events (instance method)">- (Object) <strong>events</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The list of events generated in this transaction.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#ignoreschedules-instance_method" title="#ignoreschedules (instance method)">- (Object) <strong>ignoreschedules</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute ignoreschedules.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#report-instance_method" title="#report (instance method)">- (Object) <strong>report</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The report, once generated.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#sorted_resources-instance_method" title="#sorted_resources (instance method)">- (Object) <strong>sorted_resources</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute sorted_resources.
</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#addtimes-instance_method" title="#addtimes (instance method)">- (Object) <strong>addtimes</strong>(hash) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Add some additional times for reporting.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#allow_processing%3F-instance_method" title="#allow_processing? (instance method)">- (Boolean) <strong>allow_processing?</strong>(resource, changes) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Check to see if we should actually allow processing, but this really only
matters when a resource is getting deleted.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#any_failed%3F-instance_method" title="#any_failed? (instance method)">- (Boolean) <strong>any_failed?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Are there any failed resources in this transaction?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply-instance_method" title="#apply (instance method)">- (Object) <strong>apply</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Apply all changes for a resource, returning a list of the events generated.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply_changes-instance_method" title="#apply_changes (instance method)">- (Object) <strong>apply_changes</strong>(resource, changes) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Apply each change in turn.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#changed%3F-instance_method" title="#changed? (instance method)">- (Boolean) <strong>changed?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Find all of the changed resources.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cleanup-instance_method" title="#cleanup (instance method)">- (Object) <strong>cleanup</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Do any necessary cleanup.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#copy_relationships-instance_method" title="#copy_relationships (instance method)">- (Object) <strong>copy_relationships</strong>(resource, children) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Copy an important relationships from the parent to the newly-generated
child resource.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#deleting%3F-instance_method" title="#deleting? (instance method)">- (Boolean) <strong>deleting?</strong>(changes) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Are we deleting this resource?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#eval_generate-instance_method" title="#eval_generate (instance method)">- (Object) <strong>eval_generate</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
See if the resource generates new resources at evaluation time.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#eval_resource-instance_method" title="#eval_resource (instance method)">- (Object) <strong>eval_resource</strong>(resource, checkskip = true) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Evaluate a single resource.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#evaluate-instance_method" title="#evaluate (instance method)">- (Object) <strong>evaluate</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This method does all the actual work of running a transaction.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#failed%3F-instance_method" title="#failed? (instance method)">- (Boolean) <strong>failed?</strong>(obj) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Determine whether a given resource has failed.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#failed_dependencies%3F-instance_method" title="#failed_dependencies? (instance method)">- (Boolean) <strong>failed_dependencies?</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Does this resource have any failed dependencies?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate-instance_method" title="#generate (instance method)">- (Object) <strong>generate</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Collect any dynamically generated resources.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_report-instance_method" title="#generate_report (instance method)">- (Object) <strong>generate_report</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate a transaction report.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ignore_tags%3F-instance_method" title="#ignore_tags? (instance method)">- (Boolean) <strong>ignore_tags?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Should we ignore tags?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Transaction) <strong>initialize</strong>(resources) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
this should only be called by a Puppet::Type::Component resource now and it
should only receive an array.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#missing_tags%3F-instance_method" title="#missing_tags? (instance method)">- (Boolean) <strong>missing_tags?</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Is this resource tagged appropriately?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prefetch-instance_method" title="#prefetch (instance method)">- (Object) <strong>prefetch</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Prefetch any providers that support it.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prepare-instance_method" title="#prepare (instance method)">- (Object) <strong>prepare</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Prepare to evaluate the resources in a transaction.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#relationship_graph-instance_method" title="#relationship_graph (instance method)">- (Object) <strong>relationship_graph</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reportclient-instance_method" title="#reportclient (instance method)">- (Object) <strong>reportclient</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rollback-instance_method" title="#rollback (instance method)">- (Object) <strong>rollback</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Roll all completed changes back.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#scheduled%3F-instance_method" title="#scheduled? (instance method)">- (Boolean) <strong>scheduled?</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Is the resource currently scheduled?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_report-instance_method" title="#send_report (instance method)">- (Object) <strong>send_report</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Send off the transaction report.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_trigger-instance_method" title="#set_trigger (instance method)">- (Object) <strong>set_trigger</strong>(edge) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Set an edge to be triggered when we evaluate its target.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#skip%3F-instance_method" title="#skip? (instance method)">- (Boolean) <strong>skip?</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Should this resource be skipped?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tags-instance_method" title="#tags (instance method)">- (Object) <strong>tags</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The tags we should be checking.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tags%3D-instance_method" title="#tags= (instance method)">- (Object) <strong>tags=</strong>(tags) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#targeted%3F-instance_method" title="#targeted? (instance method)">- (Boolean) <strong>targeted?</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Are there any edges that target this resource?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#trigger-instance_method" title="#trigger (instance method)">- (Object) <strong>trigger</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Trigger any subscriptions to a child.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#triggered-instance_method" title="#triggered (instance method)">- (Object) <strong>triggered</strong>(resource, method) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#triggered%3F-instance_method" title="#triggered? (instance method)">- (Boolean) <strong>triggered?</strong>(resource, method) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Util.html" title="Puppet::Util (module)">Util</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Util.html#benchmark-instance_method" title="Puppet::Util#benchmark (method)">#benchmark</a></span>, <span class='object_link'><a href="Util.html#binary-instance_method" title="Puppet::Util#binary (method)">#binary</a></span>, <span class='object_link'><a href="Util.html#chuser-class_method" title="Puppet::Util.chuser (method)">chuser</a></span>, <span class='object_link'><a href="Util.html#classproxy-class_method" title="Puppet::Util.classproxy (method)">classproxy</a></span>, <span class='object_link'><a href="Util.html#execfail-instance_method" title="Puppet::Util#execfail (method)">#execfail</a></span>, <span class='object_link'><a href="Util.html#execpipe-instance_method" title="Puppet::Util#execpipe (method)">#execpipe</a></span>, <span class='object_link'><a href="Util.html#execute-instance_method" title="Puppet::Util#execute (method)">#execute</a></span>, <span class='object_link'><a href="Util.html#logmethods-class_method" title="Puppet::Util.logmethods (method)">logmethods</a></span>, <span class='object_link'><a href="Util.html#memory-instance_method" title="Puppet::Util#memory (method)">#memory</a></span>, <span class='object_link'><a href="Util.html#proxy-class_method" title="Puppet::Util.proxy (method)">proxy</a></span>, <span class='object_link'><a href="Util.html#recmkdir-class_method" title="Puppet::Util.recmkdir (method)">recmkdir</a></span>, <span class='object_link'><a href="Util.html#secure_open-instance_method" title="Puppet::Util#secure_open (method)">#secure_open</a></span>, <span class='object_link'><a href="Util.html#symbolize-instance_method" title="Puppet::Util#symbolize (method)">#symbolize</a></span>, <span class='object_link'><a href="Util.html#symbolizehash-instance_method" title="Puppet::Util#symbolizehash (method)">#symbolizehash</a></span>, <span class='object_link'><a href="Util.html#symbolizehash%21-instance_method" title="Puppet::Util#symbolizehash! (method)">#symbolizehash!</a></span>, <span class='object_link'><a href="Util.html#sync-class_method" title="Puppet::Util.sync (method)">sync</a></span>, <span class='object_link'><a href="Util.html#thinmark-instance_method" title="Puppet::Util#thinmark (method)">#thinmark</a></span>, <span class='object_link'><a href="Util.html#threadlock-instance_method" title="Puppet::Util#threadlock (method)">#threadlock</a></span>, <span class='object_link'><a href="Util.html#withumask-class_method" title="Puppet::Util.withumask (method)">withumask</a></span></p>

  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Puppet::Transaction (class)">Transaction</a></span></tt>) <strong>initialize</strong>(resources) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
this should only be called by a Puppet::Type::Component resource now and it
should only receive an array
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 431</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_resources'>resources</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_resources'>resources</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Node</span><span class='op'>::</span><span class='const'>Catalog</span><span class='rparen'>)</span>
        <span class='ivar'>@catalog</span> <span class='op'>=</span> <span class='id identifier rubyid_resources'>resources</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_resources'>resources</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Puppet</span><span class='op'>::</span><span class='const'>PGraph</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Transactions should get catalogs now, not PGraph</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Transactions require catalogs</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='ivar'>@resourcemetrics</span> <span class='op'>=</span> <span class='lbrace'>{</span>
        <span class='symbol'>:total</span> <span class='op'>=&gt;</span> <span class='ivar'>@catalog</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='comma'>,</span>
        <span class='symbol'>:out_of_sync</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>    <span class='comment'># The number of resources that had changes
</span>        <span class='symbol'>:applied</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>        <span class='comment'># The number of resources fixed
</span>        <span class='symbol'>:skipped</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>      <span class='comment'># The number of resources skipped
</span>        <span class='symbol'>:restarted</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>    <span class='comment'># The number of resources triggered
</span>        <span class='symbol'>:failed_restarts</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span> <span class='comment'># The number of resources that fail a trigger
</span>        <span class='symbol'>:scheduled</span> <span class='op'>=&gt;</span> <span class='int'>0</span>     <span class='comment'># The number of resources scheduled
</span>    <span class='rbrace'>}</span>

    <span class='comment'># Metrics for distributing times across the different types.
</span>    <span class='ivar'>@timemetrics</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>

    <span class='comment'># The number of resources that were triggered in this run
</span>    <span class='ivar'>@triggered</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
        <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>

    <span class='comment'># Targets of being triggered.
</span>    <span class='ivar'>@targets</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
        <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='comment'># The changes we're performing
</span>    <span class='ivar'>@changes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

    <span class='comment'># The resources that have failed and the number of failures each.  This
</span>    <span class='comment'># is used for skipping resources because of failed dependencies.
</span>    <span class='ivar'>@failures</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
        <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>end</span>

    <span class='ivar'>@report</span> <span class='op'>=</span> <span class='const'>Report</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='ivar'>@count</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 431</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def initialize(resources)
    if resources.is_a?(Puppet::Node::Catalog)
        @catalog = resources
    elsif resources.is_a?(Puppet::PGraph)
        raise &quot;Transactions should get catalogs now, not PGraph&quot;
    else
        raise &quot;Transactions require catalogs&quot;
    end

    @resourcemetrics = {
        :total =&gt; @catalog.vertices.length,
        :out_of_sync =&gt; 0,    # The number of resources that had changes
        :applied =&gt; 0,        # The number of resources fixed
        :skipped =&gt; 0,      # The number of resources skipped
        :restarted =&gt; 0,    # The number of resources triggered
        :failed_restarts =&gt; 0, # The number of resources that fail a trigger
        :scheduled =&gt; 0     # The number of resources scheduled
    }
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Metrics for distributing times across the different types.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">451
452
453</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='ivar'>@timemetrics</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
The number of resources that were triggered in this run
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">454
455
456
457
458</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='ivar'>@triggered</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
        <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Targets of being triggered.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">459
460
461
462
463</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='ivar'>@targets</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
        <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
The changes we&#8217;re performing
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">464
465
466</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='ivar'>@changes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
The resources that have failed and the number of failures each.  This is
used for skipping resources because of failed dependencies.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">468
469
470
471
472
473
474
475</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    @failures = Hash.new do |h, key|
        h[key] = 0
    end

    @report = Report.new
    @count = 0
end</pre>
      </td>
    </tr>
  

</table>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="catalog=-instance_method"></span>
      <span id="catalog-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="catalog-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>catalog</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute catalog
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 11</span>

<span class='kw'>def</span> <span class='id identifier rubyid_catalog'>catalog</span>
  <span class='ivar'>@catalog</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 11</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">11
12
13
14</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_catalog'>catalog</span>
  <span class='ivar'>@catalog</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      
      <span id="component=-instance_method"></span>
      <span id="component-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="component-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>component</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute component
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 11</span>

<span class='kw'>def</span> <span class='id identifier rubyid_component'>component</span>
  <span class='ivar'>@component</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 11</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">11
12
13
14</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_component'>component</span>
  <span class='ivar'>@component</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      
      <span id="configurator=-instance_method"></span>
      <span id="configurator-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="configurator-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>configurator</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute configurator
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_configurator'>configurator</span>
  <span class='ivar'>@configurator</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 12</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">12
13
14
15</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_configurator'>configurator</span>
  <span class='ivar'>@configurator</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      
      <span id=""></span>
      <span id="events-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="events-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>events</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The list of events generated in this transaction.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 18</span>

<span class='kw'>def</span> <span class='id identifier rubyid_events'>events</span>
  <span class='ivar'>@events</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 18</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">18
19
20
21</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_events'>events</span>
  <span class='ivar'>@events</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      
      <span id="ignoreschedules=-instance_method"></span>
      <span id="ignoreschedules-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="ignoreschedules-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>ignoreschedules</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute ignoreschedules
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 11</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ignoreschedules'>ignoreschedules</span>
  <span class='ivar'>@ignoreschedules</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 11</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">11
12
13
14</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_ignoreschedules'>ignoreschedules</span>
  <span class='ivar'>@ignoreschedules</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      
      <span id=""></span>
      <span id="report-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="report-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>report</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The report, once generated.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_report'>report</span>
  <span class='ivar'>@report</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 15</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">15
16
17
18</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_report'>report</span>
  <span class='ivar'>@report</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      
      <span id="sorted_resources=-instance_method"></span>
      <span id="sorted_resources-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="sorted_resources-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>sorted_resources</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute sorted_resources
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sorted_resources'>sorted_resources</span>
  <span class='ivar'>@sorted_resources</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 12</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">12
13
14
15</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_sorted_resources'>sorted_resources</span>
  <span class='ivar'>@sorted_resources</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="addtimes-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>addtimes</strong>(hash) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Add some additional times for reporting
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 23</span>

<span class='kw'>def</span> <span class='id identifier rubyid_addtimes'>addtimes</span><span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_hash'>hash</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_num'>num</span><span class='op'>|</span>
        <span class='ivar'>@timemetrics</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_num'>num</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 23</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">23
24
25
26
27
28</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_addtimes'>addtimes</span><span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_hash'>hash</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_num'>num</span><span class='op'>|</span>
        <span class='ivar'>@timemetrics</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_num'>num</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="allow_processing?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>allow_processing?</strong>(resource, changes) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Check to see if we should actually allow processing, but this really only
matters when a resource is getting deleted.
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 31</span>

<span class='kw'>def</span> <span class='id identifier rubyid_allow_processing?'>allow_processing?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_changes'>changes</span><span class='rparen'>)</span>
    <span class='comment'># If a resource is going to be deleted but it still has
</span>    <span class='comment'># dependencies, then don't delete it unless it's implicit or the
</span>    <span class='comment'># dependency is itself being deleted.
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_purging?'>purging?</span> <span class='kw'>and</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_deleting?'>deleting?</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_deps'>deps</span> <span class='op'>=</span> <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_dependents'>dependents</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='op'>!</span> <span class='id identifier rubyid_deps'>deps</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='kw'>and</span> <span class='id identifier rubyid_deps'>deps</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_d'>d</span><span class='op'>|</span> <span class='op'>!</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_deleting?'>deleting?</span> <span class='rbrace'>}</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%s still depend%s on me -- not purging</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                <span class='lbracket'>[</span><span class='id identifier rubyid_deps'>deps</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_ref'>ref</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_deps'>deps</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='op'>:</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>s</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> 
            <span class='kw'>return</span> <span class='kw'>false</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 31</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">31
32</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def allow_processing?(resource, changes)</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
If a resource is going to be deleted but it still has dependencies, then
don&#8217;t delete it unless it&#8217;s implicit or the dependency is
itself being deleted.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">35
36
37
38
39
40
41
42
43
44
45</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    if resource.purging? and resource.deleting?
        if deps = relationship_graph.dependents(resource) and ! deps.empty? and deps.detect { |d| ! d.deleting? }
            resource.warning &quot;%s still depend%s on me -- not purging&quot; %
                [deps.collect { |r| r.ref }.join(&quot;,&quot;), deps.length &gt; 1 ? &quot;&quot;:&quot;s&quot;] 
            return false
        end
    end

    return true
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="any_failed?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>any_failed?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Are there any failed resources in this transaction?
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49
50
51
52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 47</span>

<span class='kw'>def</span> <span class='id identifier rubyid_any_failed?'>any_failed?</span>
    <span class='id identifier rubyid_failures'>failures</span> <span class='op'>=</span> <span class='ivar'>@failures</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_failures'>failures</span><span class='comma'>,</span> <span class='id identifier rubyid_array'>array</span><span class='op'>|</span> <span class='id identifier rubyid_failures'>failures</span> <span class='op'>+=</span> <span class='id identifier rubyid_array'>array</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='semicolon'>;</span> <span class='id identifier rubyid_failures'>failures</span> <span class='rbrace'>}</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_failures'>failures</span> <span class='op'>&gt;</span> <span class='int'>0</span>
        <span class='id identifier rubyid_failures'>failures</span>
    <span class='kw'>else</span>
        <span class='kw'>false</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 47</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">47
48
49
50
51
52
53
54
55</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_any_failed?'>any_failed?</span>
    <span class='id identifier rubyid_failures'>failures</span> <span class='op'>=</span> <span class='ivar'>@failures</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_failures'>failures</span><span class='comma'>,</span> <span class='id identifier rubyid_array'>array</span><span class='op'>|</span> <span class='id identifier rubyid_failures'>failures</span> <span class='op'>+=</span> <span class='id identifier rubyid_array'>array</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='semicolon'>;</span> <span class='id identifier rubyid_failures'>failures</span> <span class='rbrace'>}</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_failures'>failures</span> <span class='op'>&gt;</span> <span class='int'>0</span>
        <span class='id identifier rubyid_failures'>failures</span>
    <span class='kw'>else</span>
        <span class='kw'>false</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="apply-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>apply</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Apply all changes for a resource, returning a list of the events generated.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 58</span>

<span class='kw'>def</span> <span class='id identifier rubyid_apply'>apply</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='kw'>begin</span>
        <span class='id identifier rubyid_changes'>changes</span> <span class='op'>=</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_evaluate'>evaluate</span>
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:trace</span><span class='rbracket'>]</span>
            <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to retrieve current state of resource: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_detail'>detail</span>

        <span class='comment'># Mark that it failed
</span>        <span class='ivar'>@failures</span><span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>

        <span class='comment'># And then return
</span>        <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_changes'>changes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_changes'>changes</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_changes'>changes</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_changes'>changes</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>
        <span class='ivar'>@resourcemetrics</span><span class='lbracket'>[</span><span class='symbol'>:out_of_sync</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_changes'>changes</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='kw'>or</span> <span class='op'>!</span> <span class='id identifier rubyid_allow_processing?'>allow_processing?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_changes'>changes</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_resourceevents'>resourceevents</span> <span class='op'>=</span> <span class='id identifier rubyid_apply_changes'>apply_changes</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_changes'>changes</span><span class='rparen'>)</span>

    <span class='comment'># If there were changes and the resource isn't in noop mode...
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_changes'>changes</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='kw'>or</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_noop'>noop</span>
        <span class='comment'># Record when we last synced
</span>        <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_cache'>cache</span><span class='lparen'>(</span><span class='symbol'>:synced</span><span class='comma'>,</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span>

        <span class='comment'># Flush, if appropriate
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:flush</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_flush'>flush</span>
        <span class='kw'>end</span>
        
        <span class='comment'># And set a trigger for refreshing this resource if it's a
</span>        <span class='comment'># self-refresher
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_self_refresh?'>self_refresh?</span> <span class='kw'>and</span> <span class='op'>!</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_deleting?'>deleting?</span>
            <span class='comment'># Create an edge with this resource as both the source and
</span>            <span class='comment'># target.  The triggering method treats these specially for
</span>            <span class='comment'># logging.
</span>            <span class='id identifier rubyid_events'>events</span> <span class='op'>=</span> <span class='id identifier rubyid_resourceevents'>resourceevents</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='rbrace'>}</span>
            <span class='id identifier rubyid_set_trigger'>set_trigger</span><span class='lparen'>(</span><span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Relationship</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='symbol'>:refresh</span><span class='comma'>,</span> <span class='symbol'>:event</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_events'>events</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_resourceevents'>resourceevents</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 58</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">58
59
60
61
62
63
64
65
66
67
68</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def apply(resource)
    begin
        changes = resource.evaluate
    rescue =&gt; detail
        if Puppet[:trace]
            puts detail.backtrace
        end

        resource.err &quot;Failed to retrieve current state of resource: %s&quot; % detail
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Mark that it failed
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">69
70
71</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        <span class='ivar'>@failures</span><span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
And then return
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">72
73
74
75
76
77
78
79
80
81
82
83
84
85</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        return []
    end

    changes = [changes] unless changes.is_a?(Array)

    if changes.length &gt; 0
        @resourcemetrics[:out_of_sync] += 1
    end

    return [] if changes.empty? or ! allow_processing?(resource, changes)

    resourceevents = apply_changes(resource, changes)
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
If there were changes and the resource isn&#8217;t in noop mode&#8230;
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">86
87</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    unless changes.empty? or resource.noop</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Record when we last synced
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">88
89
90</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_cache'>cache</span><span class='lparen'>(</span><span class='symbol'>:synced</span><span class='comma'>,</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Flush, if appropriate
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">91
92
93
94
95</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        <span class='kw'>if</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:flush</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_flush'>flush</span>
        <span class='kw'>end</span>
        </pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
And set a trigger for refreshing this resource if it&#8217;s a
self-refresher
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">97
98</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        if resource.self_refresh? and ! resource.deleting?</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Create an edge with this resource as both the source and target.  The
triggering method treats these specially for logging.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">101
102
103
104
105
106
107
108</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">            events = resourceevents.collect { |e| e.name }
            set_trigger(Puppet::Relationship.new(resource, resource, :callback =&gt; :refresh, :event =&gt; events))
        end
    end

    resourceevents
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="apply_changes-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>apply_changes</strong>(resource, changes) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Apply each change in turn.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 110</span>

<span class='kw'>def</span> <span class='id identifier rubyid_apply_changes'>apply_changes</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_changes'>changes</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_changes'>changes</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_change'>change</span><span class='op'>|</span>
        <span class='ivar'>@changes</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_change'>change</span>
        <span class='ivar'>@count</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_events'>events</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='kw'>begin</span>
            <span class='comment'># use an array, so that changes can return more than one
</span>            <span class='comment'># event if they want
</span>            <span class='id identifier rubyid_events'>events</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_forward'>forward</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
            <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:trace</span><span class='rbracket'>]</span>
                <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>change from %s to %s failed: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                <span class='lbracket'>[</span><span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span><span class='period'>.</span><span class='id identifier rubyid_is_to_s'>is_to_s</span><span class='lparen'>(</span><span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_is'>is</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span><span class='period'>.</span><span class='id identifier rubyid_should_to_s'>should_to_s</span><span class='lparen'>(</span><span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_detail'>detail</span><span class='rbracket'>]</span>
            <span class='ivar'>@failures</span><span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
            <span class='kw'>next</span>
            <span class='comment'># FIXME this should support using onerror to determine
</span>            <span class='comment'># behaviour; or more likely, the client calling us
</span>            <span class='comment'># should do so
</span>        <span class='kw'>end</span>

        <span class='comment'># Mark that our change happened, so it can be reversed
</span>        <span class='comment'># if we ever get to that point
</span>        <span class='kw'>unless</span> <span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='lparen'>(</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='lparen'>(</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:noop</span><span class='rparen'>)</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_changed'>changed</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='ivar'>@resourcemetrics</span><span class='lbracket'>[</span><span class='symbol'>:applied</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_events'>events</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 110</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">110
111
112
113
114
115
116</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def apply_changes(resource, changes)
    changes.collect { |change|
        @changes &lt;&lt; change
        @count += 1
        events = nil
        begin</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
use an array, so that changes can return more than one event if they want
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">118
119
120
121
122
123
124
125
126
127</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">            events = [change.forward].flatten.reject { |e| e.nil? }
        rescue =&gt; detail
            if Puppet[:trace]
                puts detail.backtrace
            end
            change.property.err &quot;change from %s to %s failed: %s&quot; %
                [change.property.is_to_s(change.is), change.property.should_to_s(change.should), detail]
            @failures[resource] += 1
            next</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
FIXME this should support using onerror to determine behaviour; or more
likely, the client calling us should do so
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">130
131
132</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        end
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Mark that our change happened, so it can be reversed if we ever get to that
point
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">134
135
136
137
138
139
140
141
142</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        unless events.nil? or (events.is_a?(Array) and (events.empty?) or events.include?(:noop))
            change.changed = true
            @resourcemetrics[:applied] += 1
        end

        events
    }.flatten.reject { |e| e.nil? }
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="changed?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>changed?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Find all of the changed resources.
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


144
145
146
147
148
149
150
151</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 144</span>

<span class='kw'>def</span> <span class='id identifier rubyid_changed?'>changed?</span>
    <span class='ivar'>@changes</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_change'>change</span><span class='op'>|</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_changed'>changed</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_change'>change</span><span class='op'>|</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No resource for %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 144</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">144
145
146
147
148
149
150
151
152</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_changed?'>changed?</span>
    <span class='ivar'>@changes</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_change'>change</span><span class='op'>|</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_changed'>changed</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_change'>change</span><span class='op'>|</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No resource for %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="cleanup-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>cleanup</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Do any necessary cleanup.  If we don&#8217;t get rid of the graphs, the
contained resources might never get cleaned up.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


155
156
157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 155</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cleanup'>cleanup</span>
    <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='ivar'>@generated</span>
        <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_remove_resource'>remove_resource</span><span class='lparen'>(</span><span class='op'>*</span><span class='ivar'>@generated</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 155</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">155
156
157
158
159
160</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_cleanup'>cleanup</span>
    <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='ivar'>@generated</span>
        <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_remove_resource'>remove_resource</span><span class='lparen'>(</span><span class='op'>*</span><span class='ivar'>@generated</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="copy_relationships-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>copy_relationships</strong>(resource, children) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Copy an important relationships from the parent to the newly-generated
child resource.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 163</span>

<span class='kw'>def</span> <span class='id identifier rubyid_copy_relationships'>copy_relationships</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_children'>children</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_depthfirst'>depthfirst</span> <span class='op'>=</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_depthfirst?'>depthfirst?</span>
    
    <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gen_child'>gen_child</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_depthfirst'>depthfirst</span>
            <span class='id identifier rubyid_edge'>edge</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_gen_child'>gen_child</span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='rbracket'>]</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_edge'>edge</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_gen_child'>gen_child</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_add_resource'>add_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_gen_child'>gen_child</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span><span class='lparen'>(</span><span class='id identifier rubyid_gen_child'>gen_child</span><span class='period'>.</span><span class='id identifier rubyid_ref'>ref</span><span class='rparen'>)</span>

        <span class='kw'>unless</span> <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_edge?'>edge?</span><span class='lparen'>(</span><span class='id identifier rubyid_edge'>edge</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_edge'>edge</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_add_edge'>add_edge</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_edge'>edge</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skipping automatic relationship to %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_gen_child'>gen_child</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 163</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_copy_relationships'>copy_relationships</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_children'>children</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_depthfirst'>depthfirst</span> <span class='op'>=</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_depthfirst?'>depthfirst?</span>
    
    <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_gen_child'>gen_child</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_depthfirst'>depthfirst</span>
            <span class='id identifier rubyid_edge'>edge</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_gen_child'>gen_child</span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='rbracket'>]</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_edge'>edge</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_gen_child'>gen_child</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_add_resource'>add_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_gen_child'>gen_child</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span><span class='lparen'>(</span><span class='id identifier rubyid_gen_child'>gen_child</span><span class='period'>.</span><span class='id identifier rubyid_ref'>ref</span><span class='rparen'>)</span>

        <span class='kw'>unless</span> <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_edge?'>edge?</span><span class='lparen'>(</span><span class='id identifier rubyid_edge'>edge</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_edge'>edge</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_add_edge'>add_edge</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_edge'>edge</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skipping automatic relationship to %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_gen_child'>gen_child</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="deleting?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>deleting?</strong>(changes) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Are we deleting this resource?
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


183
184
185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 183</span>

<span class='kw'>def</span> <span class='id identifier rubyid_deleting?'>deleting?</span><span class='lparen'>(</span><span class='id identifier rubyid_changes'>changes</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_changes'>changes</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_change'>change</span><span class='op'>|</span>
        <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:ensure</span> <span class='kw'>and</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='op'>==</span> <span class='symbol'>:absent</span>
    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 183</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">183
184
185
186
187
188</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_deleting?'>deleting?</span><span class='lparen'>(</span><span class='id identifier rubyid_changes'>changes</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_changes'>changes</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_change'>change</span><span class='op'>|</span>
        <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:ensure</span> <span class='kw'>and</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span> <span class='op'>==</span> <span class='symbol'>:absent</span>
    <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="eval_generate-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>eval_generate</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
See if the resource generates new resources at evaluation time.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 190</span>

<span class='kw'>def</span> <span class='id identifier rubyid_eval_generate'>eval_generate</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:eval_generate</span><span class='rparen'>)</span>
        <span class='kw'>begin</span>
            <span class='id identifier rubyid_children'>children</span> <span class='op'>=</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_eval_generate'>eval_generate</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
            <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:trace</span><span class='rbracket'>]</span>
                <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to generate additional resources during transaction: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                <span class='id identifier rubyid_detail'>detail</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>end</span>
        
        <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span>
            <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_child'>child</span><span class='op'>|</span> <span class='id identifier rubyid_child'>child</span><span class='period'>.</span><span class='id identifier rubyid_finish'>finish</span> <span class='rbrace'>}</span>
            <span class='ivar'>@generated</span> <span class='op'>+=</span> <span class='id identifier rubyid_children'>children</span>
            <span class='kw'>return</span> <span class='id identifier rubyid_children'>children</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 190</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_eval_generate'>eval_generate</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:eval_generate</span><span class='rparen'>)</span>
        <span class='kw'>begin</span>
            <span class='id identifier rubyid_children'>children</span> <span class='op'>=</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_eval_generate'>eval_generate</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
            <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:trace</span><span class='rbracket'>]</span>
                <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to generate additional resources during transaction: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                <span class='id identifier rubyid_detail'>detail</span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>end</span>
        
        <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span>
            <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_child'>child</span><span class='op'>|</span> <span class='id identifier rubyid_child'>child</span><span class='period'>.</span><span class='id identifier rubyid_finish'>finish</span> <span class='rbrace'>}</span>
            <span class='ivar'>@generated</span> <span class='op'>+=</span> <span class='id identifier rubyid_children'>children</span>
            <span class='kw'>return</span> <span class='id identifier rubyid_children'>children</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="eval_resource-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>eval_resource</strong>(resource, checkskip = true) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Evaluate a single resource.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 212</span>

<span class='kw'>def</span> <span class='id identifier rubyid_eval_resource'>eval_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_checkskip'>checkskip</span> <span class='op'>=</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_events'>events</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    
    <span class='kw'>if</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Type</span><span class='op'>::</span><span class='const'>Component</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>DevError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Got a component to evaluate</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    
    <span class='kw'>if</span> <span class='id identifier rubyid_checkskip'>checkskip</span> <span class='kw'>and</span> <span class='id identifier rubyid_skip?'>skip?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
        <span class='ivar'>@resourcemetrics</span><span class='lbracket'>[</span><span class='symbol'>:skipped</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>else</span>
        <span class='ivar'>@resourcemetrics</span><span class='lbracket'>[</span><span class='symbol'>:scheduled</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
        
        <span class='id identifier rubyid_changecount'>changecount</span> <span class='op'>=</span> <span class='ivar'>@changes</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
        
        <span class='comment'># We need to generate first regardless, because the recursive
</span>        <span class='comment'># actions sometimes change how the top resource is applied.
</span>        <span class='id identifier rubyid_children'>children</span> <span class='op'>=</span> <span class='id identifier rubyid_eval_generate'>eval_generate</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
        
        <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span> <span class='kw'>and</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_depthfirst?'>depthfirst?</span>
            <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_child'>child</span><span class='op'>|</span>
                <span class='comment'># The child will never be skipped when the parent isn't
</span>                <span class='id identifier rubyid_events'>events</span> <span class='op'>+=</span> <span class='id identifier rubyid_eval_resource'>eval_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_child'>child</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='comment'># Perform the actual changes
</span>        <span class='id identifier rubyid_seconds'>seconds</span> <span class='op'>=</span> <span class='id identifier rubyid_thinmark'>thinmark</span> <span class='kw'>do</span>
            <span class='id identifier rubyid_events'>events</span> <span class='op'>+=</span> <span class='id identifier rubyid_apply'>apply</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span> <span class='kw'>and</span> <span class='op'>!</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_depthfirst?'>depthfirst?</span>
            <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_child'>child</span><span class='op'>|</span>
                <span class='id identifier rubyid_events'>events</span> <span class='op'>+=</span> <span class='id identifier rubyid_eval_resource'>eval_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_child'>child</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='comment'># Create a child/parent relationship.  We do this after everything else because
</span>        <span class='comment'># we want explicit relationships to be able to override automatic relationships,
</span>        <span class='comment'># including this one.
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span>
            <span class='id identifier rubyid_copy_relationships'>copy_relationships</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_children'>children</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        
        <span class='comment'># A bit of hackery here -- if skipcheck is true, then we're the
</span>        <span class='comment'># top-level resource.  If that's the case, then make sure all of
</span>        <span class='comment'># the changes list this resource as a proxy.  This is really only
</span>        <span class='comment'># necessary for rollback, since we know the generating resource
</span>        <span class='comment'># during forward changes.
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span> <span class='kw'>and</span> <span class='id identifier rubyid_checkskip'>checkskip</span>
            <span class='ivar'>@changes</span><span class='lbracket'>[</span><span class='id identifier rubyid_changecount'>changecount</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_change'>change</span><span class='op'>|</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_resource'>resource</span> <span class='rbrace'>}</span>
        <span class='kw'>end</span>

        <span class='comment'># Keep track of how long we spend in each type of resource
</span>        <span class='ivar'>@timemetrics</span><span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='id identifier rubyid_seconds'>seconds</span>
    <span class='kw'>end</span>

    <span class='comment'># Check to see if there are any events for this resource
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_triggedevents'>triggedevents</span> <span class='op'>=</span> <span class='id identifier rubyid_trigger'>trigger</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_events'>events</span> <span class='op'>+=</span> <span class='id identifier rubyid_triggedevents'>triggedevents</span>
    <span class='kw'>end</span>

    <span class='comment'># Collect the targets of any subscriptions to those events.  We pass
</span>    <span class='comment'># the parent resource in so it will override the source in the events,
</span>    <span class='comment'># since eval_generated children can't have direct relationships.
</span>    <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_matching_edges'>matching_edges</span><span class='lparen'>(</span><span class='id identifier rubyid_events'>events</span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_orig_edge'>orig_edge</span><span class='op'>|</span>
        <span class='comment'># We have to dup the label here, else we modify the original edge label,
</span>        <span class='comment'># which affects whether a given event will match on the next run, which is,
</span>        <span class='comment'># of course, bad.
</span>        <span class='id identifier rubyid_edge'>edge</span> <span class='op'>=</span> <span class='id identifier rubyid_orig_edge'>orig_edge</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_orig_edge'>orig_edge</span><span class='period'>.</span><span class='id identifier rubyid_source'>source</span><span class='comma'>,</span> <span class='id identifier rubyid_orig_edge'>orig_edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_label'>label</span> <span class='op'>=</span> <span class='id identifier rubyid_orig_edge'>orig_edge</span><span class='period'>.</span><span class='id identifier rubyid_label'>label</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
        <span class='id identifier rubyid_label'>label</span><span class='lbracket'>[</span><span class='symbol'>:event</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_label'>label</span> <span class='op'>=</span> <span class='id identifier rubyid_label'>label</span>
        <span class='id identifier rubyid_set_trigger'>set_trigger</span><span class='lparen'>(</span><span class='id identifier rubyid_edge'>edge</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># And return the events for collection
</span>    <span class='id identifier rubyid_events'>events</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 212</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">212
213
214
215
216
217
218
219
220
221
222
223
224
225
226</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def eval_resource(resource, checkskip = true)
    events = []
    
    if resource.is_a?(Puppet::Type::Component)
        raise Puppet::DevError, &quot;Got a component to evaluate&quot;
    end
    
    if checkskip and skip?(resource)
        @resourcemetrics[:skipped] += 1
    else
        @resourcemetrics[:scheduled] += 1
        
        changecount = @changes.length
        </pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
We need to generate first regardless, because the recursive actions
sometimes change how the top resource is applied.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">228
229
230
231
232</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        children = eval_generate(resource)
        
        if children and resource.depthfirst?
            children.each do |child|</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
The child will never be skipped when the parent isn&#8217;t
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">233
234
235
236
237</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">                events += eval_resource(child, false)
            end
        end
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Perform the actual changes
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">238
239
240
241
242
243
244
245
246
247
248</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        <span class='id identifier rubyid_seconds'>seconds</span> <span class='op'>=</span> <span class='id identifier rubyid_thinmark'>thinmark</span> <span class='kw'>do</span>
            <span class='id identifier rubyid_events'>events</span> <span class='op'>+=</span> <span class='id identifier rubyid_apply'>apply</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span> <span class='kw'>and</span> <span class='op'>!</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_depthfirst?'>depthfirst?</span>
            <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_child'>child</span><span class='op'>|</span>
                <span class='id identifier rubyid_events'>events</span> <span class='op'>+=</span> <span class='id identifier rubyid_eval_resource'>eval_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_child'>child</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Create a child/parent relationship.  We do this after everything else
because we want explicit relationships to be able to override automatic
relationships, including this one.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">251
252
253
254
255</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span>
            <span class='id identifier rubyid_copy_relationships'>copy_relationships</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_children'>children</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        </pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
A bit of hackery here &#8212; if skipcheck is true, then we&#8217;re the
top-level resource.  If that&#8217;s the case, then make sure all of the
changes list this resource as a proxy.  This is really only necessary for
rollback, since we know the generating resource during forward changes.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">260
261
262
263
264</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span> <span class='kw'>and</span> <span class='id identifier rubyid_checkskip'>checkskip</span>
            <span class='ivar'>@changes</span><span class='lbracket'>[</span><span class='id identifier rubyid_changecount'>changecount</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_change'>change</span><span class='op'>|</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_proxy'>proxy</span> <span class='op'>=</span> <span class='id identifier rubyid_resource'>resource</span> <span class='rbrace'>}</span>
        <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Keep track of how long we spend in each type of resource
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">265
266
267
268</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        @timemetrics[resource.class.name] += seconds
    end
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Check to see if there are any events for this resource
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">269
270
271
272
273</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='kw'>if</span> <span class='id identifier rubyid_triggedevents'>triggedevents</span> <span class='op'>=</span> <span class='id identifier rubyid_trigger'>trigger</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_events'>events</span> <span class='op'>+=</span> <span class='id identifier rubyid_triggedevents'>triggedevents</span>
    <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Collect the targets of any subscriptions to those events.  We pass the
parent resource in so it will override the source in the events, since
eval_generated children can&#8217;t have direct relationships.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">276
277</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    relationship_graph.matching_edges(events, resource).each do |orig_edge|</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
We have to dup the label here, else we modify the original edge label,
which affects whether a given event will match on the next run, which is,
of course, bad.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">280
281
282
283
284
285
286
287</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        edge = orig_edge.class.new(orig_edge.source, orig_edge.target)
        label = orig_edge.label.dup
        label[:event] = events.collect { |e| e.name }
        edge.label = label
        set_trigger(edge)
    end
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
And return the events for collection
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">288
289
290</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    events
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="evaluate-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>evaluate</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This method does all the actual work of running a transaction.  It collects
all of the changes, executes them, and responds to any necessary events.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 294</span>

<span class='kw'>def</span> <span class='id identifier rubyid_evaluate'>evaluate</span>
    <span class='ivar'>@count</span> <span class='op'>=</span> <span class='int'>0</span>

    <span class='comment'># Start logging.
</span>    <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_newdestination'>newdestination</span><span class='lparen'>(</span><span class='ivar'>@report</span><span class='rparen'>)</span>
    
    <span class='id identifier rubyid_prepare'>prepare</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='kw'>begin</span>
        <span class='id identifier rubyid_allevents'>allevents</span> <span class='op'>=</span> <span class='ivar'>@sorted_resources</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_resource'>resource</span><span class='op'>|</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Type</span><span class='op'>::</span><span class='const'>Component</span><span class='rparen'>)</span>
                <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Somehow left a component in the relationship graph</span><span class='tstring_end'>&quot;</span></span>
                <span class='kw'>next</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='kw'>nil</span>
            <span class='id identifier rubyid_seconds'>seconds</span> <span class='op'>=</span> <span class='id identifier rubyid_thinmark'>thinmark</span> <span class='kw'>do</span>
                <span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='id identifier rubyid_eval_resource'>eval_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
            <span class='kw'>end</span>

            <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:evaltrace</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='ivar'>@catalog</span><span class='period'>.</span><span class='id identifier rubyid_host_config?'>host_config?</span>
                <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Evaluated in %0.2f seconds</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_seconds'>seconds</span>
            <span class='kw'>end</span>
            <span class='id identifier rubyid_ret'>ret</span>
        <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>
    <span class='kw'>ensure</span>
        <span class='comment'># And then close the transaction log.
</span>        <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span><span class='lparen'>(</span><span class='ivar'>@report</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Finishing transaction %s with %s changes</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
        <span class='lbracket'>[</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_object_id'>object_id</span><span class='comma'>,</span> <span class='ivar'>@count</span><span class='rbracket'>]</span>

    <span class='ivar'>@events</span> <span class='op'>=</span> <span class='id identifier rubyid_allevents'>allevents</span>
    <span class='id identifier rubyid_allevents'>allevents</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 294</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">294
295
296
297</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def evaluate
    @count = 0
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Start logging.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    Puppet::Util::Log.newdestination(@report)
    
    prepare()

    begin
        allevents = @sorted_resources.collect { |resource|
            if resource.is_a?(Puppet::Type::Component)
                Puppet.warning &quot;Somehow left a component in the relationship graph&quot;
                next
            end
            ret = nil
            seconds = thinmark do
                ret = eval_resource(resource)
            end

            if Puppet[:evaltrace] and @catalog.host_config?
                resource.info &quot;Evaluated in %0.2f seconds&quot; % seconds
            end
            ret
        }.flatten.reject { |e| e.nil? }
    ensure</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
And then close the transaction log.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">320
321
322
323
324
325
326
327
328
329</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        Puppet::Util::Log.close(@report)
    end

    Puppet.debug &quot;Finishing transaction %s with %s changes&quot; %
        [self.object_id, @count]

    @events = allevents
    allevents
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="failed?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>failed?</strong>(obj) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Determine whether a given resource has failed.
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


331
332
333
334
335
336
337</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 331</span>

<span class='kw'>def</span> <span class='id identifier rubyid_failed?'>failed?</span><span class='lparen'>(</span><span class='id identifier rubyid_obj'>obj</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@failures</span><span class='lbracket'>[</span><span class='id identifier rubyid_obj'>obj</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='int'>0</span>
        <span class='kw'>return</span> <span class='ivar'>@failures</span><span class='lbracket'>[</span><span class='id identifier rubyid_obj'>obj</span><span class='rbracket'>]</span>
    <span class='kw'>else</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 331</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">331
332
333
334
335
336
337
338</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_failed?'>failed?</span><span class='lparen'>(</span><span class='id identifier rubyid_obj'>obj</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@failures</span><span class='lbracket'>[</span><span class='id identifier rubyid_obj'>obj</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='int'>0</span>
        <span class='kw'>return</span> <span class='ivar'>@failures</span><span class='lbracket'>[</span><span class='id identifier rubyid_obj'>obj</span><span class='rbracket'>]</span>
    <span class='kw'>else</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="failed_dependencies?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>failed_dependencies?</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Does this resource have any failed dependencies?
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 340</span>

<span class='kw'>def</span> <span class='id identifier rubyid_failed_dependencies?'>failed_dependencies?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='comment'># First make sure there are no failed dependencies.  To do this,
</span>    <span class='comment'># we check for failures in any of the vertexes above us.  It's not
</span>    <span class='comment'># enough to check the immediate dependencies, which is why we use
</span>    <span class='comment'># a tree from the reversed graph.
</span>    <span class='id identifier rubyid_skip'>skip</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_deps'>deps</span> <span class='op'>=</span> <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_dependencies'>dependencies</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_deps'>deps</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dep'>dep</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_fails'>fails</span> <span class='op'>=</span> <span class='id identifier rubyid_failed?'>failed?</span><span class='lparen'>(</span><span class='id identifier rubyid_dep'>dep</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_notice'>notice</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Dependency %s[%s] has %s failures</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                <span class='lbracket'>[</span><span class='id identifier rubyid_dep'>dep</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_dep'>dep</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='ivar'>@failures</span><span class='lbracket'>[</span><span class='id identifier rubyid_dep'>dep</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
            <span class='id identifier rubyid_skip'>skip</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    
    <span class='kw'>return</span> <span class='id identifier rubyid_skip'>skip</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 340</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">340
341</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def failed_dependencies?(resource)</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
First make sure there are no failed dependencies.  To do this, we check for
failures in any of the vertexes above us.  It&#8217;s not enough to check
the immediate dependencies, which is why we use a tree from the reversed
graph.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">345
346
347
348
349
350
351
352
353
354
355
356
357</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    skip = false
    deps = relationship_graph.dependencies(resource)
    deps.each do |dep|
        if fails = failed?(dep)
            resource.notice &quot;Dependency %s[%s] has %s failures&quot; %
                [dep.class.name, dep.name, @failures[dep]]
            skip = true
        end
    end
    
    return skip
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="generate-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>generate</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Collect any dynamically generated resources.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 359</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generate'>generate</span>
    <span class='id identifier rubyid_list'>list</span> <span class='op'>=</span> <span class='ivar'>@catalog</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span>
    
    <span class='comment'># Store a list of all generated resources, so that we can clean them up
</span>    <span class='comment'># after the transaction closes.
</span>    <span class='ivar'>@generated</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    
    <span class='id identifier rubyid_newlist'>newlist</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>while</span> <span class='op'>!</span> <span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_resource'>resource</span><span class='op'>|</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:generate</span><span class='rparen'>)</span>
                <span class='kw'>begin</span>
                    <span class='id identifier rubyid_made'>made</span> <span class='op'>=</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_generate'>generate</span>
                <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
                    <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to generate additional resources: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                        <span class='id identifier rubyid_detail'>detail</span>
                <span class='kw'>end</span>
                <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_made'>made</span>
                <span class='kw'>unless</span> <span class='id identifier rubyid_made'>made</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
                    <span class='id identifier rubyid_made'>made</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_made'>made</span><span class='rbracket'>]</span>
                <span class='kw'>end</span>
                <span class='id identifier rubyid_made'>made</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
                <span class='id identifier rubyid_made'>made</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_res'>res</span><span class='op'>|</span>
                    <span class='ivar'>@catalog</span><span class='period'>.</span><span class='id identifier rubyid_add_resource'>add_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_res'>res</span><span class='rparen'>)</span>
                    <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_catalog'>catalog</span> <span class='op'>=</span> <span class='id identifier rubyid_catalog'>catalog</span>
                    <span class='id identifier rubyid_newlist'>newlist</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_res'>res</span>
                    <span class='ivar'>@generated</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_res'>res</span>
                    <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_finish'>finish</span>
                <span class='kw'>end</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_list'>list</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
        <span class='id identifier rubyid_list'>list</span> <span class='op'>=</span> <span class='id identifier rubyid_newlist'>newlist</span>
        <span class='id identifier rubyid_newlist'>newlist</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 359</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">359
360
361
362</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def generate
    list = @catalog.vertices
    </pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Store a list of all generated resources, so that we can clean them up after
the transaction closes.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    @generated = []
    
    newlist = []
    while ! list.empty?
        list.each do |resource|
            if resource.respond_to?(:generate)
                begin
                    made = resource.generate
                rescue =&gt; detail
                    resource.err &quot;Failed to generate additional resources: %s&quot; %
                        detail
                end
                next unless made
                unless made.is_a?(Array)
                    made = [made]
                end
                made.uniq!
                made.each do |res|
                    @catalog.add_resource(res)
                    res.catalog = catalog
                    newlist &lt;&lt; res
                    @generated &lt;&lt; res
                    res.finish
                end
            end
        end
        list.clear
        list = newlist
        newlist = []
    end
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="generate_report-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>generate_report</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Generate a transaction report.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 397</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_report'>generate_report</span>
    <span class='ivar'>@resourcemetrics</span><span class='lbracket'>[</span><span class='symbol'>:failed</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@failures</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_num'>num</span><span class='op'>|</span>
        <span class='id identifier rubyid_num'>num</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>

    <span class='comment'># Get the total time spent
</span>    <span class='ivar'>@timemetrics</span><span class='lbracket'>[</span><span class='symbol'>:total</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@timemetrics</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_total'>total</span><span class='comma'>,</span> <span class='id identifier rubyid_vals'>vals</span><span class='op'>|</span>
        <span class='id identifier rubyid_total'>total</span> <span class='op'>+=</span> <span class='id identifier rubyid_vals'>vals</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_total'>total</span>
    <span class='kw'>end</span>

    <span class='comment'># Add all of the metrics related to resource count and status
</span>    <span class='ivar'>@report</span><span class='period'>.</span><span class='id identifier rubyid_newmetric'>newmetric</span><span class='lparen'>(</span><span class='symbol'>:resources</span><span class='comma'>,</span> <span class='ivar'>@resourcemetrics</span><span class='rparen'>)</span>

    <span class='comment'># Record the relative time spent in each resource.
</span>    <span class='ivar'>@report</span><span class='period'>.</span><span class='id identifier rubyid_newmetric'>newmetric</span><span class='lparen'>(</span><span class='symbol'>:time</span><span class='comma'>,</span> <span class='ivar'>@timemetrics</span><span class='rparen'>)</span>

    <span class='comment'># Then all of the change-related metrics
</span>    <span class='ivar'>@report</span><span class='period'>.</span><span class='id identifier rubyid_newmetric'>newmetric</span><span class='lparen'>(</span><span class='symbol'>:changes</span><span class='comma'>,</span>
        <span class='symbol'>:total</span> <span class='op'>=&gt;</span> <span class='ivar'>@changes</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='rparen'>)</span>

    <span class='ivar'>@report</span><span class='period'>.</span><span class='id identifier rubyid_time'>time</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>

    <span class='kw'>return</span> <span class='ivar'>@report</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 397</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">397
398
399
400
401
402</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def generate_report
    @resourcemetrics[:failed] = @failures.find_all do |name, num|
        num &gt; 0
    end.length
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Get the total time spent
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">403
404
405
406
407
408</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='ivar'>@timemetrics</span><span class='lbracket'>[</span><span class='symbol'>:total</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@timemetrics</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_total'>total</span><span class='comma'>,</span> <span class='id identifier rubyid_vals'>vals</span><span class='op'>|</span>
        <span class='id identifier rubyid_total'>total</span> <span class='op'>+=</span> <span class='id identifier rubyid_vals'>vals</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_total'>total</span>
    <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Add all of the metrics related to resource count and status
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">409
410
411</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='ivar'>@report</span><span class='period'>.</span><span class='id identifier rubyid_newmetric'>newmetric</span><span class='lparen'>(</span><span class='symbol'>:resources</span><span class='comma'>,</span> <span class='ivar'>@resourcemetrics</span><span class='rparen'>)</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Record the relative time spent in each resource.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">412
413
414</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='ivar'>@report</span><span class='period'>.</span><span class='id identifier rubyid_newmetric'>newmetric</span><span class='lparen'>(</span><span class='symbol'>:time</span><span class='comma'>,</span> <span class='ivar'>@timemetrics</span><span class='rparen'>)</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Then all of the change-related metrics
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">415
416
417
418
419
420
421
422
423</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    @report.newmetric(:changes,
        :total =&gt; @changes.length
    )

    @report.time = Time.now

    return @report
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="ignore_tags?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>ignore_tags?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Should we ignore tags?
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


425
426
427</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 425</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ignore_tags?'>ignore_tags?</span>
    <span class='op'>!</span> <span class='lparen'>(</span><span class='ivar'>@catalog</span><span class='period'>.</span><span class='id identifier rubyid_host_config?'>host_config?</span> <span class='kw'>or</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>puppet</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 425</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">425
426
427
428</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_ignore_tags?'>ignore_tags?</span>
    <span class='op'>!</span> <span class='lparen'>(</span><span class='ivar'>@catalog</span><span class='period'>.</span><span class='id identifier rubyid_host_config?'>host_config?</span> <span class='kw'>or</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>puppet</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="missing_tags?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>missing_tags?</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Is this resource tagged appropriately?
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


647
648
649
650</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 647</span>

<span class='kw'>def</span> <span class='id identifier rubyid_missing_tags?'>missing_tags?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_ignore_tags?'>ignore_tags?</span> <span class='kw'>or</span> <span class='id identifier rubyid_tags'>tags</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>unless</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_tagged?'>tagged?</span><span class='lparen'>(</span><span class='id identifier rubyid_tags'>tags</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 647</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">647
648
649
650
651</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_missing_tags?'>missing_tags?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_ignore_tags?'>ignore_tags?</span> <span class='kw'>or</span> <span class='id identifier rubyid_tags'>tags</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>unless</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_tagged?'>tagged?</span><span class='lparen'>(</span><span class='id identifier rubyid_tags'>tags</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="prefetch-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>prefetch</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Prefetch any providers that support it.  We don&#8217;t support prefetching
types, just providers.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 478</span>

<span class='kw'>def</span> <span class='id identifier rubyid_prefetch'>prefetch</span>
    <span class='id identifier rubyid_prefetchers'>prefetchers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='ivar'>@catalog</span><span class='period'>.</span><span class='id identifier rubyid_vertices'>vertices</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_resource'>resource</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_provider'>provider</span> <span class='op'>=</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span> <span class='kw'>and</span> <span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:prefetch</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_prefetchers'>prefetchers</span><span class='lbracket'>[</span><span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
            <span class='id identifier rubyid_prefetchers'>prefetchers</span><span class='lbracket'>[</span><span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_resource'>resource</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Now call prefetch, passing in the resources so that the provider instances can be replaced.
</span>    <span class='id identifier rubyid_prefetchers'>prefetchers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_provider'>provider</span><span class='comma'>,</span> <span class='id identifier rubyid_resources'>resources</span><span class='op'>|</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Prefetching %s resources for %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_resource_type'>resource_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>
        <span class='kw'>begin</span>
            <span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_prefetch'>prefetch</span><span class='lparen'>(</span><span class='id identifier rubyid_resources'>resources</span><span class='rparen'>)</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
            <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:trace</span><span class='rbracket'>]</span>
                <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span>
            <span class='kw'>end</span>
            <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not prefetch %s provider '%s': %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_resource_type'>resource_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_detail'>detail</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 478</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">478
479
480
481
482
483
484
485
486
487</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def prefetch
    prefetchers = {}
    @catalog.vertices.each do |resource|
        if provider = resource.provider and provider.class.respond_to?(:prefetch)
            prefetchers[provider.class] ||= {}
            prefetchers[provider.class][resource.name] = resource
        end
    end
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Now call prefetch, passing in the resources so that the provider instances
can be replaced.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">488
489
490
491
492
493
494
495
496
497
498
499
500</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    prefetchers.each do |provider, resources|
        Puppet.debug &quot;Prefetching %s resources for %s&quot; % [provider.name, provider.resource_type.name]
        begin
            provider.prefetch(resources)
        rescue =&gt; detail
            if Puppet[:trace]
                puts detail.backtrace
            end
            Puppet.err &quot;Could not prefetch %s provider '%s': %s&quot; % [provider.resource_type.name, provider.name, detail]
        end
    end
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="prepare-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>prepare</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Prepare to evaluate the resources in a transaction.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


502
503
504
505
506
507
508
509
510
511
512</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 502</span>

<span class='kw'>def</span> <span class='id identifier rubyid_prepare'>prepare</span>
    <span class='comment'># Now add any dynamically generated resources
</span>    <span class='id identifier rubyid_generate'>generate</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='comment'># Then prefetch.  It's important that we generate and then prefetch,
</span>    <span class='comment'># so that any generated resources also get prefetched.
</span>    <span class='id identifier rubyid_prefetch'>prefetch</span><span class='lparen'>(</span><span class='rparen'>)</span>
    
    <span class='comment'># This will throw an error if there are cycles in the graph.
</span>    <span class='ivar'>@sorted_resources</span> <span class='op'>=</span> <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_topsort'>topsort</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 502</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">502
503</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def prepare</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Now add any dynamically generated resources
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">504
505
506</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='id identifier rubyid_generate'>generate</span><span class='lparen'>(</span><span class='rparen'>)</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Then prefetch.  It&#8217;s important that we generate and then prefetch, so
that any generated resources also get prefetched.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">508
509
510</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='id identifier rubyid_prefetch'>prefetch</span><span class='lparen'>(</span><span class='rparen'>)</span>
    </pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
This will throw an error if there are cycles in the graph.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">511
512
513</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    @sorted_resources = relationship_graph.topsort
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="relationship_graph-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>relationship_graph</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


514
515
516</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 514</span>

<span class='kw'>def</span> <span class='id identifier rubyid_relationship_graph'>relationship_graph</span>
    <span class='id identifier rubyid_catalog'>catalog</span><span class='period'>.</span><span class='id identifier rubyid_relationship_graph'>relationship_graph</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 514</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">514
515
516
517</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_relationship_graph'>relationship_graph</span>
    <span class='id identifier rubyid_catalog'>catalog</span><span class='period'>.</span><span class='id identifier rubyid_relationship_graph'>relationship_graph</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="reportclient-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>reportclient</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


544
545
546
547
548
549
550
551
552</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 544</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reportclient'>reportclient</span>
    <span class='kw'>unless</span> <span class='kw'>defined?</span> <span class='ivar'>@reportclient</span>
        <span class='ivar'>@reportclient</span> <span class='op'>=</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Network</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
            <span class='symbol'>:Server</span> <span class='op'>=&gt;</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:reportserver</span><span class='rbracket'>]</span>
        <span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='ivar'>@reportclient</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 544</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">544
545
546
547
548
549
550
551
552
553</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_reportclient'>reportclient</span>
    <span class='kw'>unless</span> <span class='kw'>defined?</span> <span class='ivar'>@reportclient</span>
        <span class='ivar'>@reportclient</span> <span class='op'>=</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Network</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
            <span class='symbol'>:Server</span> <span class='op'>=&gt;</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:reportserver</span><span class='rbracket'>]</span>
        <span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='ivar'>@reportclient</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="rollback-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>rollback</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Roll all completed changes back.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 555</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rollback'>rollback</span>
    <span class='ivar'>@targets</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
    <span class='ivar'>@triggered</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
    <span class='id identifier rubyid_allevents'>allevents</span> <span class='op'>=</span> <span class='ivar'>@changes</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_change'>change</span><span class='op'>|</span>
        <span class='comment'># skip changes that were never actually run
</span>        <span class='kw'>unless</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_changed'>changed</span>
            <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%s was not changed</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
            <span class='kw'>next</span>
        <span class='kw'>end</span>
        <span class='kw'>begin</span>
            <span class='id identifier rubyid_events'>events</span> <span class='op'>=</span> <span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_backward'>backward</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
            <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%s rollback failed: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='id identifier rubyid_change'>change</span><span class='comma'>,</span><span class='id identifier rubyid_detail'>detail</span><span class='rbracket'>]</span><span class='rparen'>)</span>
            <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:trace</span><span class='rbracket'>]</span>
                <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span>
            <span class='kw'>end</span>
            <span class='kw'>next</span>
            <span class='comment'># at this point, we would normally do error handling
</span>            <span class='comment'># but i haven't decided what to do for that yet
</span>            <span class='comment'># so just record that a sync failed for a given resource
</span>            <span class='comment'>#@@failures[change.property.parent] += 1
</span>            <span class='comment'># this still could get hairy; what if file contents changed,
</span>            <span class='comment'># but a chmod failed?  how would i handle that error? dern
</span>        <span class='kw'>end</span>
        
        <span class='comment'># FIXME This won't work right now.
</span>        <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_matching_edges'>matching_edges</span><span class='lparen'>(</span><span class='id identifier rubyid_events'>events</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_edge'>edge</span><span class='op'>|</span>
            <span class='ivar'>@targets</span><span class='lbracket'>[</span><span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_edge'>edge</span>
        <span class='kw'>end</span>

        <span class='comment'># Now check to see if there are any events for this child.
</span>        <span class='comment'># Kind of hackish, since going backwards goes a change at a
</span>        <span class='comment'># time, not a child at a time.
</span>        <span class='id identifier rubyid_trigger'>trigger</span><span class='lparen'>(</span><span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>

        <span class='comment'># And return the events for collection
</span>        <span class='id identifier rubyid_events'>events</span>
    <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 555</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">555
556
557
558
559</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def rollback
    @targets.clear
    @triggered.clear
    allevents = @changes.reverse.collect { |change|</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
skip changes that were never actually run
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">560
561
562
563
564
565
566
567
568
569
570
571
572</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        unless change.changed
            Puppet.debug &quot;%s was not changed&quot; % change.to_s
            next
        end
        begin
            events = change.backward
        rescue =&gt; detail
            Puppet.err(&quot;%s rollback failed: %s&quot; % [change,detail])
            if Puppet[:trace]
                puts detail.backtrace
            end
            next</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
at this point, we would normally do error handling but i haven&#8217;t
decided what to do for that yet so just record that a sync failed for a
given resource @@<a href="http://change.property.parent">failures</a> += 1
this still could get hairy; what if file contents changed, but a chmod
failed?  how would i handle that error? dern
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">578
579
580</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        end
        </pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
FIXME This won&#8217;t work right now.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">581
582
583
584
585</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        <span class='id identifier rubyid_relationship_graph'>relationship_graph</span><span class='period'>.</span><span class='id identifier rubyid_matching_edges'>matching_edges</span><span class='lparen'>(</span><span class='id identifier rubyid_events'>events</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_edge'>edge</span><span class='op'>|</span>
            <span class='ivar'>@targets</span><span class='lbracket'>[</span><span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_edge'>edge</span>
        <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Now check to see if there are any events for this child. Kind of hackish,
since going backwards goes a change at a time, not a child at a time.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">588
589
590</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        <span class='id identifier rubyid_trigger'>trigger</span><span class='lparen'>(</span><span class='id identifier rubyid_change'>change</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
And return the events for collection
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">591
592
593
594</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        events
    }.flatten.reject { |e| e.nil? }
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="scheduled?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>scheduled?</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Is the resource currently scheduled?
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


596
597
598</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 596</span>

<span class='kw'>def</span> <span class='id identifier rubyid_scheduled?'>scheduled?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_ignoreschedules'>ignoreschedules</span> <span class='kw'>or</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_scheduled?'>scheduled?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 596</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">596
597
598
599</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_scheduled?'>scheduled?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_ignoreschedules'>ignoreschedules</span> <span class='kw'>or</span> <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_scheduled?'>scheduled?</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="send_report-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>send_report</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Send off the transaction report.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 519</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_report'>send_report</span>
    <span class='kw'>begin</span>
        <span class='id identifier rubyid_report'>report</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_report'>generate_report</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not generate report: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='kw'>return</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:rrdgraph</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_report'>report</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:summarize</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_report'>report</span><span class='period'>.</span><span class='id identifier rubyid_summary'>summary</span>
    <span class='kw'>end</span>
    
    <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:report</span><span class='rbracket'>]</span>
        <span class='kw'>begin</span>
            <span class='id identifier rubyid_reportclient'>reportclient</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span><span class='lparen'>(</span><span class='id identifier rubyid_report'>report</span><span class='rparen'>)</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
            <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Reporting failed: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 519</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_send_report'>send_report</span>
    <span class='kw'>begin</span>
        <span class='id identifier rubyid_report'>report</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_report'>generate_report</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not generate report: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='kw'>return</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:rrdgraph</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_report'>report</span><span class='period'>.</span><span class='id identifier rubyid_graph'>graph</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:summarize</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_report'>report</span><span class='period'>.</span><span class='id identifier rubyid_summary'>summary</span>
    <span class='kw'>end</span>
    
    <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:report</span><span class='rbracket'>]</span>
        <span class='kw'>begin</span>
            <span class='id identifier rubyid_reportclient'>reportclient</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span><span class='lparen'>(</span><span class='id identifier rubyid_report'>report</span><span class='rparen'>)</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
            <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Reporting failed: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="set_trigger-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>set_trigger</strong>(edge) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Set an edge to be triggered when we evaluate its target.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


601
602
603
604
605
606
607
608
609
610</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 601</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_trigger'>set_trigger</span><span class='lparen'>(</span><span class='id identifier rubyid_edge'>edge</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_callback'>callback</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:ref</span><span class='rparen'>)</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_source'>source</span> <span class='op'>==</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span>
            <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Scheduling %s of %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_callback'>callback</span><span class='comma'>,</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_ref'>ref</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='ivar'>@targets</span><span class='lbracket'>[</span><span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_edge'>edge</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 601</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">601
602
603
604
605
606
607
608
609
610
611</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_set_trigger'>set_trigger</span><span class='lparen'>(</span><span class='id identifier rubyid_edge'>edge</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_callback'>callback</span>
    <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:ref</span><span class='rparen'>)</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_source'>source</span> <span class='op'>==</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span>
            <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Scheduling %s of %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_callback'>callback</span><span class='comma'>,</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='period'>.</span><span class='id identifier rubyid_ref'>ref</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='ivar'>@targets</span><span class='lbracket'>[</span><span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_edge'>edge</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="skip?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>skip?</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Should this resource be skipped?
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


613
614
615
616
617
618
619
620
621
622
623
624
625</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 613</span>

<span class='kw'>def</span> <span class='id identifier rubyid_skip?'>skip?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_skip'>skip</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_missing_tags?'>missing_tags?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not tagged with %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_tags'>tags</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>, </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='op'>!</span> <span class='id identifier rubyid_scheduled?'>scheduled?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not scheduled</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_failed_dependencies?'>failed_dependencies?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skipping because of failed dependencies</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 613</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">613
614
615
616
617
618
619
620
621
622
623
624
625
626</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_skip?'>skip?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_skip'>skip</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_missing_tags?'>missing_tags?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not tagged with %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_tags'>tags</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>, </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='op'>!</span> <span class='id identifier rubyid_scheduled?'>scheduled?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not scheduled</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_failed_dependencies?'>failed_dependencies?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Skipping because of failed dependencies</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="tags-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>tags</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The tags we should be checking.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


628
629
630
631
632
633
634
635
636
637
638
639</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 628</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tags'>tags</span>
    <span class='kw'>unless</span> <span class='kw'>defined?</span> <span class='ivar'>@tags</span>
        <span class='id identifier rubyid_tags'>tags</span> <span class='op'>=</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:tags</span><span class='rbracket'>]</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_tags'>tags</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_tags'>tags</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
            <span class='ivar'>@tags</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
        <span class='kw'>else</span>
            <span class='ivar'>@tags</span> <span class='op'>=</span> <span class='id identifier rubyid_tags'>tags</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s*,\s*</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    
    <span class='ivar'>@tags</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 628</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">628
629
630
631
632
633
634
635
636
637
638
639
640</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_tags'>tags</span>
    <span class='kw'>unless</span> <span class='kw'>defined?</span> <span class='ivar'>@tags</span>
        <span class='id identifier rubyid_tags'>tags</span> <span class='op'>=</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:tags</span><span class='rbracket'>]</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_tags'>tags</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_tags'>tags</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
            <span class='ivar'>@tags</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
        <span class='kw'>else</span>
            <span class='ivar'>@tags</span> <span class='op'>=</span> <span class='id identifier rubyid_tags'>tags</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s*,\s*</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
    
    <span class='ivar'>@tags</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="tags=-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>tags=</strong>(tags) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


641
642
643
644</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 641</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tags='>tags=</span><span class='lparen'>(</span><span class='id identifier rubyid_tags'>tags</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_tags'>tags</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_tags'>tags</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_tags'>tags</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
    <span class='ivar'>@tags</span> <span class='op'>=</span> <span class='id identifier rubyid_tags'>tags</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 641</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">641
642
643
644
645</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_tags='>tags=</span><span class='lparen'>(</span><span class='id identifier rubyid_tags'>tags</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_tags'>tags</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_tags'>tags</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id identifier rubyid_tags'>tags</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
    <span class='ivar'>@tags</span> <span class='op'>=</span> <span class='id identifier rubyid_tags'>tags</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="targeted?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>targeted?</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Are there any edges that target this resource?
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


653
654
655
656</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 653</span>

<span class='kw'>def</span> <span class='id identifier rubyid_targeted?'>targeted?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='comment'># The default value is a new array so we have to test the length of it.
</span>    <span class='ivar'>@targets</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='ivar'>@targets</span><span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 653</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">653
654</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def targeted?(resource)</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
The default value is a new array so we have to test the length of it.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">655
656
657</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    @targets.include?(resource) and @targets[resource].length &gt; 0
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="trigger-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>trigger</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Trigger any subscriptions to a child.  This does an upwardly recursive
search &#8212; it triggers the passed resource, but also the
resource&#8217;s parent and so on up the tree.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 661</span>

<span class='kw'>def</span> <span class='id identifier rubyid_trigger'>trigger</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_targeted?'>targeted?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_callbacks'>callbacks</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='op'>|</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>

    <span class='id identifier rubyid_trigged'>trigged</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='ivar'>@targets</span><span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_edge'>edge</span><span class='op'>|</span>
        <span class='comment'># Collect all of the subs for each callback
</span>        <span class='id identifier rubyid_callbacks'>callbacks</span><span class='lbracket'>[</span><span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_callback'>callback</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_edge'>edge</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_callbacks'>callbacks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_callback'>callback</span><span class='comma'>,</span> <span class='id identifier rubyid_subs'>subs</span><span class='op'>|</span>
        <span class='id identifier rubyid_noop'>noop</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_subs'>subs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_edge'>edge</span><span class='op'>|</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='op'>!</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:noop</span><span class='rparen'>)</span>
                <span class='id identifier rubyid_noop'>noop</span> <span class='op'>=</span> <span class='kw'>false</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_noop'>noop</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_notice'>notice</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Would have triggered %s from %s dependencies</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                <span class='lbracket'>[</span><span class='id identifier rubyid_callback'>callback</span><span class='comma'>,</span> <span class='id identifier rubyid_subs'>subs</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbracket'>]</span>

            <span class='comment'># And then add an event for it.
</span>            <span class='kw'>return</span> <span class='lbracket'>[</span><span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Transaction</span><span class='op'>::</span><span class='const'>Event</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:noop</span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_subs'>subs</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>1</span> <span class='kw'>and</span> <span class='id identifier rubyid_subs'>subs</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_source'>source</span> <span class='op'>==</span> <span class='id identifier rubyid_resource'>resource</span>
            <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Refreshing self</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>else</span>
            <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Triggering '%s' from %s dependencies</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                <span class='lbracket'>[</span><span class='id identifier rubyid_callback'>callback</span><span class='comma'>,</span> <span class='id identifier rubyid_subs'>subs</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_notice'>notice</span> <span class='id identifier rubyid_message'>message</span>
        
        <span class='comment'># At this point, just log failures, don't try to react
</span>        <span class='comment'># to them in any way.
</span>        <span class='kw'>begin</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_callback'>callback</span><span class='rparen'>)</span>
            <span class='ivar'>@resourcemetrics</span><span class='lbracket'>[</span><span class='symbol'>:restarted</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to call %s on %s: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                <span class='lbracket'>[</span><span class='id identifier rubyid_callback'>callback</span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_detail'>detail</span><span class='rbracket'>]</span>

            <span class='ivar'>@resourcemetrics</span><span class='lbracket'>[</span><span class='symbol'>:failed_restarts</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>

            <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:trace</span><span class='rbracket'>]</span>
                <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>

        <span class='comment'># And then add an event for it.
</span>        <span class='id identifier rubyid_trigged'>trigged</span> <span class='op'>&lt;&lt;</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Transaction</span><span class='op'>::</span><span class='const'>Event</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:triggered</span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_triggered'>triggered</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_callback'>callback</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_trigged'>trigged</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='kw'>return</span> <span class='kw'>nil</span>
    <span class='kw'>else</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_trigged'>trigged</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 661</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">661
662
663
664
665
666
667</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def trigger(resource)
    return nil unless targeted?(resource)
    callbacks = Hash.new { |hash, key| hash[key] = [] }

    trigged = []
    @targets[resource].each do |edge|</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Collect all of the subs for each callback
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        callbacks[edge.callback] &lt;&lt; edge
    end

    callbacks.each do |callback, subs|
        noop = true
        subs.each do |edge|
            if edge.event.nil? or ! edge.event.include?(:noop)
                noop = false
            end
        end

        if noop
            resource.notice &quot;Would have triggered %s from %s dependencies&quot; %
                [callback, subs.length]
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
And then add an event for it.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">684
685
686
687
688
689
690
691
692
693
694
695</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">            return [Puppet::Transaction::Event.new(:noop, resource)]
        end

        if subs.length == 1 and subs[0].source == resource
            message = &quot;Refreshing self&quot;
        else
            message = &quot;Triggering '%s' from %s dependencies&quot; %
                [callback, subs.length]
        end
        resource.notice message
        </pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
At this point, just log failures, don&#8217;t try to react to them in any
way.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">697
698
699
700
701
702
703
704
705
706
707
708
709
710
711</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        <span class='kw'>begin</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_callback'>callback</span><span class='rparen'>)</span>
            <span class='ivar'>@resourcemetrics</span><span class='lbracket'>[</span><span class='symbol'>:restarted</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
            <span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to call %s on %s: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                <span class='lbracket'>[</span><span class='id identifier rubyid_callback'>callback</span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_detail'>detail</span><span class='rbracket'>]</span>

            <span class='ivar'>@resourcemetrics</span><span class='lbracket'>[</span><span class='symbol'>:failed_restarts</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>

            <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:trace</span><span class='rbracket'>]</span>
                <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
And then add an event for it.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">712
713
714
715
716
717
718
719
720
721
722
723</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        trigged &lt;&lt; Puppet::Transaction::Event.new(:triggered, resource)

        triggered(resource, callback)
    end

    if trigged.empty?
        return nil
    else
        return trigged
    end
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="triggered-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>triggered</strong>(resource, method) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


724
725
726</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 724</span>

<span class='kw'>def</span> <span class='id identifier rubyid_triggered'>triggered</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
    <span class='ivar'>@triggered</span><span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_method'>method</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 724</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">724
725
726
727</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_triggered'>triggered</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
    <span class='ivar'>@triggered</span><span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_method'>method</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="triggered?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>triggered?</strong>(resource, method) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


728
729
730</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 728</span>

<span class='kw'>def</span> <span class='id identifier rubyid_triggered?'>triggered?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
    <span class='ivar'>@triggered</span><span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_method'>method</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/transaction.rb', line 728</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">728
729
730
731</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_triggered?'>triggered?</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
    <span class='ivar'>@triggered</span><span class='lbracket'>[</span><span class='id identifier rubyid_resource'>resource</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_method'>method</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Mar  6 02:12:33 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.5 (ruby-1.9.2).
</div>

  </body>
</html>