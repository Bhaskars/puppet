<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Puppet::Network::Handler::CA
  
    &mdash; Documentation by YARD 0.7.5
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/docco.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/docco.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (C)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../../Puppet.html" title="Puppet (module)">Puppet</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Network.html" title="Puppet::Network (module)">Network</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Handler.html" title="Puppet::Network::Handler (class)">Handler</a></span></span>
     &raquo; 
    <span class="title">CA</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Puppet::Network::Handler::CA
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../Handler.html#Handler-constant" title="Puppet::Network::Handler::Handler (constant)">Handler</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Puppet::Network::Handler::CA</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/puppet/network/handler/ca.rb</dd>
  
</dl>
<div class="clear"></div>





  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#ca-instance_method" title="#ca (instance method)">- (Object) <strong>ca</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute ca.
</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#autosign-instance_method" title="#autosign (instance method)">- (Object) <strong>autosign</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#autosign%3F-instance_method" title="#autosign? (instance method)">- (Boolean) <strong>autosign?</strong>(hostname) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
FIXME autosign? should probably accept both hostnames and IP addresses.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#getcert-instance_method" title="#getcert (instance method)">- (Object) <strong>getcert</strong>(csrtext, client = nil, clientip = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
our client sends us a csr, and we either store it for later signing, or we
sign it right away.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (CA) <strong>initialize</strong>(hash = {}) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A new instance of CA.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Puppet::Network::Handler::CA (class)">CA</a></span></tt>) <strong>initialize</strong>(hash = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A new instance of CA
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/network/handler/ca.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='symbol'>:main</span><span class='comma'>,</span> <span class='symbol'>:ssl</span><span class='comma'>,</span> <span class='symbol'>:ca</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_hash'>hash</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbol'>:autosign</span>
        <span class='ivar'>@autosign</span> <span class='op'>=</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:autosign</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='ivar'>@ca</span> <span class='op'>=</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>SSLCertificates</span><span class='op'>::</span><span class='const'>CA</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/network/handler/ca.rb', line 62</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">62
63
64
65
66
67
68
69
70</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='symbol'>:main</span><span class='comma'>,</span> <span class='symbol'>:ssl</span><span class='comma'>,</span> <span class='symbol'>:ca</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_hash'>hash</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbol'>:autosign</span>
        <span class='ivar'>@autosign</span> <span class='op'>=</span> <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:autosign</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='ivar'>@ca</span> <span class='op'>=</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>SSLCertificates</span><span class='op'>::</span><span class='const'>CA</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_hash'>hash</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="ca-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="ca-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>ca</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute ca
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/network/handler/ca.rb', line 11</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ca'>ca</span>
  <span class='ivar'>@ca</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/network/handler/ca.rb', line 11</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">11
12
13
14</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_ca'>ca</span>
  <span class='ivar'>@ca</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="autosign-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>autosign</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23
24
25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/network/handler/ca.rb', line 21</span>

<span class='kw'>def</span> <span class='id identifier rubyid_autosign'>autosign</span>
    <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='ivar'>@autosign</span>
        <span class='ivar'>@autosign</span>
    <span class='kw'>else</span>
        <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:autosign</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/network/handler/ca.rb', line 21</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">21
22
23
24
25
26
27
28</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_autosign'>autosign</span>
    <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='ivar'>@autosign</span>
        <span class='ivar'>@autosign</span>
    <span class='kw'>else</span>
        <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:autosign</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="autosign?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>autosign?</strong>(hostname) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
FIXME autosign? should probably accept both hostnames and IP addresses
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/network/handler/ca.rb', line 30</span>

<span class='kw'>def</span> <span class='id identifier rubyid_autosign?'>autosign?</span><span class='lparen'>(</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rparen'>)</span>
    <span class='comment'># simple values are easy
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_autosign'>autosign</span> <span class='op'>==</span> <span class='kw'>true</span> <span class='kw'>or</span> <span class='id identifier rubyid_autosign'>autosign</span> <span class='op'>==</span> <span class='kw'>false</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_autosign'>autosign</span>
    <span class='kw'>end</span>

    <span class='comment'># we only otherwise know how to handle files
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_autosign'>autosign</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\/</span><span class='regexp_end'>/</span></span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid autosign value %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
            <span class='id identifier rubyid_autosign'>autosign</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
    <span class='kw'>end</span>

    <span class='kw'>unless</span> <span class='const'>FileTest</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_autosign'>autosign</span><span class='rparen'>)</span>
        <span class='kw'>unless</span> <span class='kw'>defined?</span> <span class='cvar'>@@warnedonautosign</span>
            <span class='cvar'>@@warnedonautosign</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Autosign is enabled but %s is missing</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_autosign'>autosign</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_auth'>auth</span> <span class='op'>=</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Network</span><span class='op'>::</span><span class='const'>AuthStore</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_autosign'>autosign</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
        <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*#</span><span class='regexp_end'>/</span></span>
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*$</span><span class='regexp_end'>/</span></span>
            <span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_allow'>allow</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='rparen'>)</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>

    <span class='comment'># for now, just cheat and pass a fake IP address to allowed?
</span>    <span class='kw'>return</span> <span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_allowed?'>allowed?</span><span class='lparen'>(</span><span class='id identifier rubyid_hostname'>hostname</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.1.1.1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/network/handler/ca.rb', line 30</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">30
31</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def autosign?(hostname)</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
simple values are easy
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">32
33
34
35
36</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='kw'>if</span> <span class='id identifier rubyid_autosign'>autosign</span> <span class='op'>==</span> <span class='kw'>true</span> <span class='kw'>or</span> <span class='id identifier rubyid_autosign'>autosign</span> <span class='op'>==</span> <span class='kw'>false</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_autosign'>autosign</span>
    <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
we only otherwise know how to handle files
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='kw'>unless</span> <span class='id identifier rubyid_autosign'>autosign</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\/</span><span class='regexp_end'>/</span></span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid autosign value %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
            <span class='id identifier rubyid_autosign'>autosign</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
    <span class='kw'>end</span>

    <span class='kw'>unless</span> <span class='const'>FileTest</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_autosign'>autosign</span><span class='rparen'>)</span>
        <span class='kw'>unless</span> <span class='kw'>defined?</span> <span class='cvar'>@@warnedonautosign</span>
            <span class='cvar'>@@warnedonautosign</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Autosign is enabled but %s is missing</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_autosign'>autosign</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='kw'>false</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_auth'>auth</span> <span class='op'>=</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Network</span><span class='op'>::</span><span class='const'>AuthStore</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_autosign'>autosign</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span>
        <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*#</span><span class='regexp_end'>/</span></span>
            <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*$</span><span class='regexp_end'>/</span></span>
            <span class='id identifier rubyid_auth'>auth</span><span class='period'>.</span><span class='id identifier rubyid_allow'>allow</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='rparen'>)</span>
        <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
for now, just cheat and pass a fake IP address to allowed?
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">59
60
61</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    return auth.allowed?(hostname, &quot;127.1.1.1&quot;)
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="getcert-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>getcert</strong>(csrtext, client = nil, clientip = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
our client sends us a csr, and we either store it for later signing, or we
sign it right away
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/network/handler/ca.rb', line 73</span>

<span class='kw'>def</span> <span class='id identifier rubyid_getcert'>getcert</span><span class='lparen'>(</span><span class='id identifier rubyid_csrtext'>csrtext</span><span class='comma'>,</span> <span class='id identifier rubyid_client'>client</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_clientip'>clientip</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_csr'>csr</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>X509</span><span class='op'>::</span><span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_csrtext'>csrtext</span><span class='rparen'>)</span>

    <span class='comment'># Use the hostname from the CSR, not from the network.
</span>    <span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_csr'>csr</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span>

    <span class='id identifier rubyid_nameary'>nameary</span> <span class='op'>=</span> <span class='id identifier rubyid_subject'>subject</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ary'>ary</span><span class='op'>|</span>
        <span class='id identifier rubyid_ary'>ary</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CN</span><span class='tstring_end'>&quot;</span></span>
    <span class='rbrace'>}</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_nameary'>nameary</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span><span class='lparen'>(</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid certificate request: could not retrieve server name</span><span class='tstring_end'>&quot;</span></span>
        <span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_hostname'>hostname</span> <span class='op'>=</span> <span class='id identifier rubyid_nameary'>nameary</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>

    <span class='kw'>unless</span> <span class='ivar'>@ca</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_notice'>notice</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Host %s asked for signing from non-CA master</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_hostname'>hostname</span>
        <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'># We used to save the public key, but it's basically unnecessary
</span>    <span class='comment'># and it mucks with the permissions requirements.
</span>    <span class='comment'># save_pk(hostname, csr.public_key)
</span>
    <span class='id identifier rubyid_certfile'>certfile</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:certdir</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pem</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

    <span class='comment'># first check to see if we already have a signed cert for the host
</span>    <span class='id identifier rubyid_cert'>cert</span><span class='comma'>,</span> <span class='id identifier rubyid_cacert'>cacert</span> <span class='op'>=</span> <span class='id identifier rubyid_ca'>ca</span><span class='period'>.</span><span class='id identifier rubyid_getclientcert'>getclientcert</span><span class='lparen'>(</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_cert'>cert</span> <span class='kw'>and</span> <span class='id identifier rubyid_cacert'>cacert</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Retrieving existing certificate for %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_hostname'>hostname</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_csr'>csr</span><span class='period'>.</span><span class='id identifier rubyid_public_key'>public_key</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='id identifier rubyid_cert'>cert</span><span class='period'>.</span><span class='id identifier rubyid_public_key'>public_key</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Certificate request does not match existing certificate; run 'puppetca --clean %s'.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_hostname'>hostname</span>
        <span class='kw'>end</span>
        <span class='kw'>return</span> <span class='lbracket'>[</span><span class='id identifier rubyid_cert'>cert</span><span class='period'>.</span><span class='id identifier rubyid_to_pem'>to_pem</span><span class='comma'>,</span> <span class='id identifier rubyid_cacert'>cacert</span><span class='period'>.</span><span class='id identifier rubyid_to_pem'>to_pem</span><span class='rbracket'>]</span>
    <span class='kw'>elsif</span> <span class='ivar'>@ca</span>
        <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_autosign?'>autosign?</span><span class='lparen'>(</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
            <span class='kw'>if</span> <span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
                <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Signing certificate for CA server</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>end</span>
            <span class='comment'># okay, we don't have a signed cert
</span>            <span class='comment'># if we're a CA and autosign is turned on, then go ahead and sign
</span>            <span class='comment'># the csr and return the results
</span>            <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Signing certificate for %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_hostname'>hostname</span>
            <span class='id identifier rubyid_cert'>cert</span><span class='comma'>,</span> <span class='id identifier rubyid_cacert'>cacert</span> <span class='op'>=</span> <span class='ivar'>@ca</span><span class='period'>.</span><span class='id identifier rubyid_sign'>sign</span><span class='lparen'>(</span><span class='id identifier rubyid_csr'>csr</span><span class='rparen'>)</span>
            <span class='comment'>#Puppet.info &quot;Cert: %s; Cacert: %s&quot; % [cert.class, cacert.class]
</span>            <span class='kw'>return</span> <span class='lbracket'>[</span><span class='id identifier rubyid_cert'>cert</span><span class='period'>.</span><span class='id identifier rubyid_to_pem'>to_pem</span><span class='comma'>,</span> <span class='id identifier rubyid_cacert'>cacert</span><span class='period'>.</span><span class='id identifier rubyid_to_pem'>to_pem</span><span class='rbracket'>]</span>
        <span class='kw'>else</span> <span class='comment'># just write out the csr for later signing
</span>            <span class='kw'>if</span> <span class='ivar'>@ca</span><span class='period'>.</span><span class='id identifier rubyid_getclientcsr'>getclientcsr</span><span class='lparen'>(</span><span class='id identifier rubyid_hostname'>hostname</span><span class='rparen'>)</span>
                <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not replacing existing request from %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_hostname'>hostname</span>
            <span class='kw'>else</span>
                <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_notice'>notice</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Host %s has a waiting certificate request</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                    <span class='id identifier rubyid_hostname'>hostname</span>
                <span class='ivar'>@ca</span><span class='period'>.</span><span class='id identifier rubyid_storeclientcsr'>storeclientcsr</span><span class='lparen'>(</span><span class='id identifier rubyid_csr'>csr</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
            <span class='kw'>return</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
    <span class='kw'>else</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>huh?</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/network/handler/ca.rb', line 73</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">73
74
75
76</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def getcert(csrtext, client = nil, clientip = nil)
    csr = OpenSSL::X509::Request.new(csrtext)
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Use the hostname from the CSR, not from the network.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='id identifier rubyid_subject'>subject</span> <span class='op'>=</span> <span class='id identifier rubyid_csr'>csr</span><span class='period'>.</span><span class='id identifier rubyid_subject'>subject</span>

    <span class='id identifier rubyid_nameary'>nameary</span> <span class='op'>=</span> <span class='id identifier rubyid_subject'>subject</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ary'>ary</span><span class='op'>|</span>
        <span class='id identifier rubyid_ary'>ary</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CN</span><span class='tstring_end'>&quot;</span></span>
    <span class='rbrace'>}</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_nameary'>nameary</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span><span class='lparen'>(</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid certificate request: could not retrieve server name</span><span class='tstring_end'>&quot;</span></span>
        <span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_hostname'>hostname</span> <span class='op'>=</span> <span class='id identifier rubyid_nameary'>nameary</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>

    <span class='kw'>unless</span> <span class='ivar'>@ca</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_notice'>notice</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Host %s asked for signing from non-CA master</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_hostname'>hostname</span>
        <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
We used to save the public key, but it&#8217;s basically unnecessary and it
mucks with the permissions requirements. save_pk(hostname, csr.public_key)
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">100
101
102
103</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">
    <span class='id identifier rubyid_certfile'>certfile</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:certdir</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_hostname'>hostname</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pem</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
first check to see if we already have a signed cert for the host
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">104
105
106
107
108
109
110
111
112
113
114
115
116</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    cert, cacert = ca.getclientcert(hostname)
    if cert and cacert
        Puppet.info &quot;Retrieving existing certificate for %s&quot; % hostname
        unless csr.public_key.to_s == cert.public_key.to_s
            raise Puppet::Error, &quot;Certificate request does not match existing certificate; run 'puppetca --clean %s'.&quot; % hostname
        end
        return [cert.to_pem, cacert.to_pem]
    elsif @ca
        if self.autosign?(hostname) or client.nil?
            if client.nil?
                Puppet.info &quot;Signing certificate for CA server&quot;
            end</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
okay, we don&#8217;t have a signed cert if we&#8217;re a CA and autosign is
turned on, then go ahead and sign the csr and return the results
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">119
120
121</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">            <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Signing certificate for %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_hostname'>hostname</span>
            <span class='id identifier rubyid_cert'>cert</span><span class='comma'>,</span> <span class='id identifier rubyid_cacert'>cacert</span> <span class='op'>=</span> <span class='ivar'>@ca</span><span class='period'>.</span><span class='id identifier rubyid_sign'>sign</span><span class='lparen'>(</span><span class='id identifier rubyid_csr'>csr</span><span class='rparen'>)</span></pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Puppet.info &#8220;Cert: %s; Cacert: %s&#8221; % [cert.class, cacert.class]
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">            return [cert.to_pem, cacert.to_pem]
        else # just write out the csr for later signing
            if @ca.getclientcsr(hostname)
                Puppet.info &quot;Not replacing existing request from %s&quot; % hostname
            else
                Puppet.notice &quot;Host %s has a waiting certificate request&quot; %
                    hostname
                @ca.storeclientcsr(csr)
            end
            return [&quot;&quot;, &quot;&quot;]
        end
    else
        raise &quot;huh?&quot;
    end
end</pre>
      </td>
    </tr>
  

</table>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Mar  6 02:12:40 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.5 (ruby-1.9.2).
</div>

  </body>
</html>