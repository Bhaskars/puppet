<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Puppet::Configurer
  
    &mdash; Documentation by YARD 0.7.5
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/docco.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/docco.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Puppet.html" title="Puppet (module)">Puppet</a></span></span>
     &raquo; 
    <span class="title">Configurer</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Puppet::Configurer
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Puppet::Configurer</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
      <dt class="r2">Extended by:</dt>
      <dd class="r2"><span class='object_link'><a href="Util.html" title="Puppet::Util (module)">Util</a></span></dd>
      
    
  
    
      <dt class="r1">Includes:</dt>
      <dd class="r1"><span class='object_link'><a href="Configurer/FactHandler.html" title="Puppet::Configurer::FactHandler (module)">FactHandler</a></span>, <span class='object_link'><a href="Configurer/PluginHandler.html" title="Puppet::Configurer::PluginHandler (module)">PluginHandler</a></span>, <span class='object_link'><a href="Util.html" title="Puppet::Util (module)">Util</a></span></dd>
      
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/puppet/configurer.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Defined Under Namespace</h2>
<p class="children">
   
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Configurer/FactHandler.html" title="Puppet::Configurer::FactHandler (module)">FactHandler</a></span>, <span class='object_link'><a href="Configurer/PluginHandler.html" title="Puppet::Configurer::PluginHandler (module)">PluginHandler</a></span>
    
   
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Configurer/CommandHookError.html" title="Puppet::Configurer::CommandHookError (class)">CommandHookError</a></span>, <span class='object_link'><a href="Configurer/Downloader.html" title="Puppet::Configurer::Downloader (class)">Downloader</a></span>
    
  
</p>




  <h2>Class Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#instance-class_method" title="instance (class method)">+ (Object) <strong>instance</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Puppetd should only have one instance running, and we need a way to
retrieve it.
</p>
</div></span>
  
</li>

    
  </ul>

  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#catalog-instance_method" title="#catalog (instance method)">- (Object) <strong>catalog</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute catalog.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#compile_time-instance_method" title="#compile_time (instance method)">- (Object) <strong>compile_time</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute compile_time.
</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#lockfile_path-class_method" title="lockfile_path (class method)">+ (Object) <strong>lockfile_path</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
How to lock instances of this class.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_s-class_method" title="to_s (class method)">+ (Object) <strong>to_s</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Provide more helpful strings to the logging that the Agent does.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear-instance_method" title="#clear (instance method)">- (Object) <strong>clear</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#convert_catalog-instance_method" title="#convert_catalog (instance method)">- (Object) <strong>convert_catalog</strong>(result, duration) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Convert a plain resource catalog into our full host catalog.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dostorage-instance_method" title="#dostorage (instance method)">- (Object) <strong>dostorage</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Initialize and load storage.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_postrun_command-instance_method" title="#execute_postrun_command (instance method)">- (Object) <strong>execute_postrun_command</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_prerun_command-instance_method" title="#execute_prerun_command (instance method)">- (Object) <strong>execute_prerun_command</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Configurer) <strong>initialize</strong> </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Just so we can specify that we are &#8220;the&#8221; instance.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prepare-instance_method" title="#prepare (instance method)">- (Object) <strong>prepare</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Prepare for catalog retrieval.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#retrieve_catalog-instance_method" title="#retrieve_catalog (instance method)">- (Object) <strong>retrieve_catalog</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Get the remote catalog, yo.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-instance_method" title="#run (instance method)">- (Object) <strong>run</strong>(options = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The code that actually runs the catalog.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Util.html" title="Puppet::Util (module)">Util</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Util.html#benchmark-instance_method" title="Puppet::Util#benchmark (method)">benchmark</a></span>, <span class='object_link'><a href="Util.html#binary-instance_method" title="Puppet::Util#binary (method)">binary</a></span>, <span class='object_link'><a href="Util.html#chuser-class_method" title="Puppet::Util.chuser (method)">chuser</a></span>, <span class='object_link'><a href="Util.html#classproxy-class_method" title="Puppet::Util.classproxy (method)">classproxy</a></span>, <span class='object_link'><a href="Util.html#execfail-instance_method" title="Puppet::Util#execfail (method)">execfail</a></span>, <span class='object_link'><a href="Util.html#execpipe-instance_method" title="Puppet::Util#execpipe (method)">execpipe</a></span>, <span class='object_link'><a href="Util.html#execute-instance_method" title="Puppet::Util#execute (method)">execute</a></span>, <span class='object_link'><a href="Util.html#logmethods-class_method" title="Puppet::Util.logmethods (method)">logmethods</a></span>, <span class='object_link'><a href="Util.html#memory-instance_method" title="Puppet::Util#memory (method)">memory</a></span>, <span class='object_link'><a href="Util.html#proxy-class_method" title="Puppet::Util.proxy (method)">proxy</a></span>, <span class='object_link'><a href="Util.html#recmkdir-class_method" title="Puppet::Util.recmkdir (method)">recmkdir</a></span>, <span class='object_link'><a href="Util.html#secure_open-instance_method" title="Puppet::Util#secure_open (method)">secure_open</a></span>, <span class='object_link'><a href="Util.html#symbolize-instance_method" title="Puppet::Util#symbolize (method)">symbolize</a></span>, <span class='object_link'><a href="Util.html#symbolizehash-instance_method" title="Puppet::Util#symbolizehash (method)">symbolizehash</a></span>, <span class='object_link'><a href="Util.html#symbolizehash%21-instance_method" title="Puppet::Util#symbolizehash! (method)">symbolizehash!</a></span>, <span class='object_link'><a href="Util.html#sync-class_method" title="Puppet::Util.sync (method)">sync</a></span>, <span class='object_link'><a href="Util.html#thinmark-instance_method" title="Puppet::Util#thinmark (method)">thinmark</a></span>, <span class='object_link'><a href="Util.html#threadlock-instance_method" title="Puppet::Util#threadlock (method)">threadlock</a></span>, <span class='object_link'><a href="Util.html#withumask-class_method" title="Puppet::Util.withumask (method)">withumask</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Util/POSIX.html" title="Puppet::Util::POSIX (module)">Util::POSIX</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Util/POSIX.html#get_posix_field-instance_method" title="Puppet::Util::POSIX#get_posix_field (method)">#get_posix_field</a></span>, <span class='object_link'><a href="Util/POSIX.html#gid-instance_method" title="Puppet::Util::POSIX#gid (method)">#gid</a></span>, <span class='object_link'><a href="Util/POSIX.html#idfield-instance_method" title="Puppet::Util::POSIX#idfield (method)">#idfield</a></span>, <span class='object_link'><a href="Util/POSIX.html#methodbyid-instance_method" title="Puppet::Util::POSIX#methodbyid (method)">#methodbyid</a></span>, <span class='object_link'><a href="Util/POSIX.html#methodbyname-instance_method" title="Puppet::Util::POSIX#methodbyname (method)">#methodbyname</a></span>, <span class='object_link'><a href="Util/POSIX.html#search_posix_field-instance_method" title="Puppet::Util::POSIX#search_posix_field (method)">#search_posix_field</a></span>, <span class='object_link'><a href="Util/POSIX.html#uid-instance_method" title="Puppet::Util::POSIX#uid (method)">#uid</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Configurer/PluginHandler.html" title="Puppet::Configurer::PluginHandler (module)">PluginHandler</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Configurer/PluginHandler.html#download_plugins-instance_method" title="Puppet::Configurer::PluginHandler#download_plugins (method)">#download_plugins</a></span>, <span class='object_link'><a href="Configurer/PluginHandler.html#download_plugins%3F-instance_method" title="Puppet::Configurer::PluginHandler#download_plugins? (method)">#download_plugins?</a></span>, <span class='object_link'><a href="Configurer/PluginHandler.html#load_plugin-instance_method" title="Puppet::Configurer::PluginHandler#load_plugin (method)">#load_plugin</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Configurer/FactHandler.html" title="Puppet::Configurer::FactHandler (module)">FactHandler</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Configurer/FactHandler.html#download_fact_plugins-instance_method" title="Puppet::Configurer::FactHandler#download_fact_plugins (method)">#download_fact_plugins</a></span>, <span class='object_link'><a href="Configurer/FactHandler.html#download_fact_plugins%3F-instance_method" title="Puppet::Configurer::FactHandler#download_fact_plugins? (method)">#download_fact_plugins?</a></span>, <span class='object_link'><a href="Configurer/FactHandler.html#facts_for_uploading-instance_method" title="Puppet::Configurer::FactHandler#facts_for_uploading (method)">#facts_for_uploading</a></span>, <span class='object_link'><a href="Configurer/FactHandler.html#find_facts-instance_method" title="Puppet::Configurer::FactHandler#find_facts (method)">#find_facts</a></span>, <span class='object_link'><a href="Configurer/FactHandler.html#reload_facter-instance_method" title="Puppet::Configurer::FactHandler#reload_facter (method)">#reload_facter</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Puppet::Configurer (class)">Configurer</a></span></tt>) <strong>initialize</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Just so we can specify that we are &#8220;the&#8221; instance.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75
76
77
78
79</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 73</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
    <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='symbol'>:main</span><span class='comma'>,</span> <span class='symbol'>:ssl</span><span class='comma'>,</span> <span class='symbol'>:puppetd</span><span class='rparen'>)</span>

    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='ivar'>@running</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='ivar'>@splayed</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 73</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">73
74
75
76
77
78
79
80</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
    <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_settings'>settings</span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span><span class='lparen'>(</span><span class='symbol'>:main</span><span class='comma'>,</span> <span class='symbol'>:ssl</span><span class='comma'>,</span> <span class='symbol'>:puppetd</span><span class='rparen'>)</span>

    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span> <span class='op'>=</span> <span class='kw'>self</span>
    <span class='ivar'>@running</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='ivar'>@splayed</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
  
</div>

  <div id="class_attr_details" class="attr_details">
    <h2>Class Attribute Details</h2>
    
      
      <span id="instance=-class_method"></span>
      <span id="instance-class_method"></span>
      <div class="method_details first">
  <p class="signature first" id="instance-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>instance</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Puppetd should only have one instance running, and we need a way to
retrieve it.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 30</span>

<span class='kw'>def</span> <span class='id identifier rubyid_instance'>instance</span>
  <span class='ivar'>@instance</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 30</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">30
31
32
33</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_instance'>instance</span>
  <span class='ivar'>@instance</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
  </div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="catalog=-instance_method"></span>
      <span id="catalog-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="catalog-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>catalog</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute catalog
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_catalog'>catalog</span>
  <span class='ivar'>@catalog</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 19</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">19
20
21
22</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_catalog'>catalog</span>
  <span class='ivar'>@catalog</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      
      <span id=""></span>
      <span id="compile_time-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="compile_time-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>compile_time</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute compile_time
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compile_time'>compile_time</span>
  <span class='ivar'>@compile_time</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 20</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">20
21
22
23</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_compile_time'>compile_time</span>
  <span class='ivar'>@compile_time</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="lockfile_path-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>lockfile_path</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
How to lock instances of this class.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 35</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lockfile_path'>lockfile_path</span>
    <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:puppetdlockfile</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 35</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">35
36
37
38</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lockfile_path'>lockfile_path</span>
    <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:puppetdlockfile</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="to_s-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>to_s</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Provide more helpful strings to the logging that the Agent does
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 23</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Puppet configuration client</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 23</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">23
24
25
26</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Puppet configuration client</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="clear-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>clear</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41
42</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 39</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clear'>clear</span>
    <span class='ivar'>@catalog</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@catalog</span>
    <span class='ivar'>@catalog</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 39</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">39
40
41
42
43</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_clear'>clear</span>
    <span class='ivar'>@catalog</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span><span class='lparen'>(</span><span class='kw'>true</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@catalog</span>
    <span class='ivar'>@catalog</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="convert_catalog-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>convert_catalog</strong>(result, duration) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Convert a plain resource catalog into our full host catalog.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


118
119
120
121
122
123
124
125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 118</span>

<span class='kw'>def</span> <span class='id identifier rubyid_convert_catalog'>convert_catalog</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_duration'>duration</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_catalog'>catalog</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_to_ral'>to_ral</span>
    <span class='id identifier rubyid_catalog'>catalog</span><span class='period'>.</span><span class='id identifier rubyid_finalize'>finalize</span>
    <span class='id identifier rubyid_catalog'>catalog</span><span class='period'>.</span><span class='id identifier rubyid_retrieval_duration'>retrieval_duration</span> <span class='op'>=</span> <span class='id identifier rubyid_duration'>duration</span>
    <span class='id identifier rubyid_catalog'>catalog</span><span class='period'>.</span><span class='id identifier rubyid_host_config'>host_config</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_catalog'>catalog</span><span class='period'>.</span><span class='id identifier rubyid_write_class_file'>write_class_file</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_catalog'>catalog</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 118</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">118
119
120
121
122
123
124
125
126</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_convert_catalog'>convert_catalog</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='id identifier rubyid_duration'>duration</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_catalog'>catalog</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_to_ral'>to_ral</span>
    <span class='id identifier rubyid_catalog'>catalog</span><span class='period'>.</span><span class='id identifier rubyid_finalize'>finalize</span>
    <span class='id identifier rubyid_catalog'>catalog</span><span class='period'>.</span><span class='id identifier rubyid_retrieval_duration'>retrieval_duration</span> <span class='op'>=</span> <span class='id identifier rubyid_duration'>duration</span>
    <span class='id identifier rubyid_catalog'>catalog</span><span class='period'>.</span><span class='id identifier rubyid_host_config'>host_config</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_catalog'>catalog</span><span class='period'>.</span><span class='id identifier rubyid_write_class_file'>write_class_file</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_catalog'>catalog</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="dostorage-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>dostorage</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Initialize and load storage
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 53</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dostorage'>dostorage</span>
    <span class='kw'>begin</span>
        <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Storage</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span>
        <span class='ivar'>@compile_time</span> <span class='op'>||=</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Storage</span><span class='period'>.</span><span class='id identifier rubyid_cache'>cache</span><span class='lparen'>(</span><span class='symbol'>:configuration</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:compile_time</span><span class='rbracket'>]</span>
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:trace</span><span class='rbracket'>]</span>
            <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span>
        <span class='kw'>end</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Corrupt state file %s: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:statefile</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_detail'>detail</span><span class='rbracket'>]</span>
        <span class='kw'>begin</span>
            <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_unlink'>unlink</span><span class='lparen'>(</span><span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:statefile</span><span class='rbracket'>]</span><span class='rparen'>)</span>
            <span class='kw'>retry</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Error</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot remove %s: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                <span class='lbracket'>[</span><span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:statefile</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_detail'>detail</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 53</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_dostorage'>dostorage</span>
    <span class='kw'>begin</span>
        <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Storage</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span>
        <span class='ivar'>@compile_time</span> <span class='op'>||=</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Storage</span><span class='period'>.</span><span class='id identifier rubyid_cache'>cache</span><span class='lparen'>(</span><span class='symbol'>:configuration</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:compile_time</span><span class='rbracket'>]</span>
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:trace</span><span class='rbracket'>]</span>
            <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span>
        <span class='kw'>end</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Corrupt state file %s: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:statefile</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_detail'>detail</span><span class='rbracket'>]</span>
        <span class='kw'>begin</span>
            <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_unlink'>unlink</span><span class='lparen'>(</span><span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:statefile</span><span class='rbracket'>]</span><span class='rparen'>)</span>
            <span class='kw'>retry</span>
        <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Error</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot remove %s: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span>
                <span class='lbracket'>[</span><span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:statefile</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_detail'>detail</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="execute_postrun_command-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>execute_postrun_command</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 44</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_postrun_command'>execute_postrun_command</span>
    <span class='id identifier rubyid_execute_from_setting'>execute_from_setting</span><span class='lparen'>(</span><span class='symbol'>:postrun_command</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 44</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">44
45
46
47</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_execute_postrun_command'>execute_postrun_command</span>
    <span class='id identifier rubyid_execute_from_setting'>execute_from_setting</span><span class='lparen'>(</span><span class='symbol'>:postrun_command</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="execute_prerun_command-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>execute_prerun_command</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 48</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_prerun_command'>execute_prerun_command</span>
    <span class='id identifier rubyid_execute_from_setting'>execute_from_setting</span><span class='lparen'>(</span><span class='symbol'>:prerun_command</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 48</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">48
49
50
51</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_execute_prerun_command'>execute_prerun_command</span>
    <span class='id identifier rubyid_execute_from_setting'>execute_from_setting</span><span class='lparen'>(</span><span class='symbol'>:prerun_command</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="prepare-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>prepare</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Prepare for catalog retrieval.  Downloads everything necessary, etc.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


82
83
84
85
86
87
88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 82</span>

<span class='kw'>def</span> <span class='id identifier rubyid_prepare'>prepare</span>
    <span class='id identifier rubyid_dostorage'>dostorage</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_download_plugins'>download_plugins</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_download_fact_plugins'>download_fact_plugins</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_execute_prerun_command'>execute_prerun_command</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 82</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">82
83
84
85
86
87
88
89
90
91</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_prepare'>prepare</span>
    <span class='id identifier rubyid_dostorage'>dostorage</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_download_plugins'>download_plugins</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_download_fact_plugins'>download_fact_plugins</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_execute_prerun_command'>execute_prerun_command</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="retrieve_catalog-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>retrieve_catalog</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Get the remote catalog, yo.  Returns nil if no catalog can be found.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 93</span>

<span class='kw'>def</span> <span class='id identifier rubyid_retrieve_catalog'>retrieve_catalog</span>
    <span class='kw'>if</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Resource</span><span class='op'>::</span><span class='const'>Catalog</span><span class='period'>.</span><span class='id identifier rubyid_indirection'>indirection</span><span class='period'>.</span><span class='id identifier rubyid_terminus_class'>terminus_class</span> <span class='op'>==</span> <span class='symbol'>:rest</span>
        <span class='comment'># This is a bit complicated.  We need the serialized and escaped facts,
</span>        <span class='comment'># and we need to know which format they're encoded in.  Thus, we
</span>        <span class='comment'># get a hash with both of these pieces of information.
</span>        <span class='id identifier rubyid_fact_options'>fact_options</span> <span class='op'>=</span> <span class='id identifier rubyid_facts_for_uploading'>facts_for_uploading</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
        <span class='id identifier rubyid_fact_options'>fact_options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='kw'>end</span>

    <span class='comment'># First try it with no cache, then with the cache.
</span>    <span class='kw'>unless</span> <span class='lparen'>(</span><span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:use_cached_catalog</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_retrieve_catalog_from_cache'>retrieve_catalog_from_cache</span><span class='lparen'>(</span><span class='id identifier rubyid_fact_options'>fact_options</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_retrieve_new_catalog'>retrieve_new_catalog</span><span class='lparen'>(</span><span class='id identifier rubyid_fact_options'>fact_options</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='op'>!</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:usecacheonfailure</span><span class='rbracket'>]</span>
            <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not using cache on failed catalog</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>return</span> <span class='kw'>nil</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_retrieve_catalog_from_cache'>retrieve_catalog_from_cache</span><span class='lparen'>(</span><span class='id identifier rubyid_fact_options'>fact_options</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_result'>result</span>

    <span class='id identifier rubyid_convert_catalog'>convert_catalog</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='ivar'>@duration</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 93</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">93
94
95</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def retrieve_catalog
    if Puppet::Resource::Catalog.indirection.terminus_class == :rest</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
This is a bit complicated.  We need the serialized and escaped facts, and
we need to know which format they&#8217;re encoded in.  Thus, we get a hash
with both of these pieces of information.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">98
99
100
101
102
103</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        fact_options = facts_for_uploading()
    else
        fact_options = {}
    end
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
First try it with no cache, then with the cache.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">104
105
106
107
108
109
110
111
112
113
114
115
116</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    unless (Puppet[:use_cached_catalog] and result = retrieve_catalog_from_cache(fact_options)) or result = retrieve_new_catalog(fact_options)
        if ! Puppet[:usecacheonfailure]
            Puppet.warning &quot;Not using cache on failed catalog&quot;
            return nil
        end
        result = retrieve_catalog_from_cache(fact_options)
    end

    return nil unless result

    convert_catalog(result, @duration)
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="run-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>run</strong>(options = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The code that actually runs the catalog. This just passes any options on to
the catalog, which accepts :tags and :ignoreschedules.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 130</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>begin</span>
        <span class='id identifier rubyid_prepare'>prepare</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>SystemExit</span><span class='comma'>,</span><span class='const'>NoMemoryError</span>
        <span class='id identifier rubyid_raise'>raise</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span> <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:trace</span><span class='rbracket'>]</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to prepare catalog: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_catalog'>catalog</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:catalog</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:catalog</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='op'>!</span> <span class='id identifier rubyid_catalog'>catalog</span> <span class='op'>=</span> <span class='id identifier rubyid_retrieve_catalog'>retrieve_catalog</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not retrieve catalog; skipping run</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>return</span>
    <span class='kw'>end</span>

    <span class='kw'>begin</span>
        <span class='id identifier rubyid_benchmark'>benchmark</span><span class='lparen'>(</span><span class='symbol'>:notice</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Finished catalog run</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
            <span class='id identifier rubyid_catalog'>catalog</span><span class='period'>.</span><span class='id identifier rubyid_apply'>apply</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span> <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:trace</span><span class='rbracket'>]</span>
        <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_err'>err</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to apply catalog: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='kw'>end</span>

    <span class='comment'># Now close all of our existing http connections, since there's no
</span>    <span class='comment'># reason to leave them lying open.
</span>    <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Network</span><span class='op'>::</span><span class='const'>HttpPool</span><span class='period'>.</span><span class='id identifier rubyid_clear_http_instances'>clear_http_instances</span>
<span class='kw'>ensure</span>
    <span class='id identifier rubyid_execute_postrun_command'>execute_postrun_command</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/configurer.rb', line 130</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def run(options = {})
    begin
        prepare()
    rescue SystemExit,NoMemoryError
        raise
    rescue Exception =&gt; detail
        puts detail.backtrace if Puppet[:trace]
        Puppet.err &quot;Failed to prepare catalog: %s&quot; % detail
    end

    if catalog = options[:catalog]
        options.delete(:catalog)
    elsif ! catalog = retrieve_catalog
        Puppet.err &quot;Could not retrieve catalog; skipping run&quot;
        return
    end

    begin
        benchmark(:notice, &quot;Finished catalog run&quot;) do
            catalog.apply(options)
        end
    rescue =&gt; detail
        puts detail.backtrace if Puppet[:trace]
        Puppet.err &quot;Failed to apply catalog: %s&quot; % detail
    end
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Now close all of our existing http connections, since there&#8217;s no
reason to leave them lying open.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">158
159
160
161
162</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    Puppet::Network::HttpPool.clear_http_instances
ensure
    execute_postrun_command
end</pre>
      </td>
    </tr>
  

</table>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Mar  6 02:11:08 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.5 (ruby-1.9.2).
</div>

  </body>
</html>