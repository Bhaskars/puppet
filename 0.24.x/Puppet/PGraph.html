<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Puppet::PGraph
  
    &mdash; Documentation by YARD 0.7.5
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/docco.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/docco.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (P)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Puppet.html" title="Puppet (module)">Puppet</a></span></span>
     &raquo; 
    <span class="title">PGraph</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Puppet::PGraph
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">SimpleGraph</span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">SimpleGraph</li>
          
            <li class="next">Puppet::PGraph</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="Util.html" title="Puppet::Util (module)">Util</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/puppet/pgraph.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
This class subclasses a graph class in order to handle relationships among
resources.
</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="Node/Catalog.html" title="Puppet::Node::Catalog (class)">Node::Catalog</a></span></p>
</div>







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_edge-instance_method" title="#add_edge (instance method)">- (Object) <strong>add_edge</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_vertex-instance_method" title="#add_vertex (instance method)">- (Object) <strong>add_vertex</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dependencies-instance_method" title="#dependencies (instance method)">- (Object) <strong>dependencies</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Which resources depend upon the given resource.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dependents-instance_method" title="#dependents (instance method)">- (Object) <strong>dependents</strong>(resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Which resources a given resource depends upon.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#leaves-instance_method" title="#leaves (instance method)">- (Object) <strong>leaves</strong>(vertex, direction = :out) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Determine all of the leaf nodes below a given vertex.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#matching_edges-instance_method" title="#matching_edges (instance method)">- (Object) <strong>matching_edges</strong>(events, base = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Collect all of the edges that the passed events match.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#splice%21-instance_method" title="#splice! (instance method)">- (Object) <strong>splice!</strong>(other, type) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Take container information from another graph and use it to replace any
container vertices with their respective leaves.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tree_from_vertex-instance_method" title="#tree_from_vertex (instance method)">- (Object) <strong>tree_from_vertex</strong>(start, direction = :out) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A different way of walking a tree, and a much faster way than the one that
comes with GRATR.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Util.html" title="Puppet::Util (module)">Util</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Util.html#benchmark-instance_method" title="Puppet::Util#benchmark (method)">#benchmark</a></span>, <span class='object_link'><a href="Util.html#binary-instance_method" title="Puppet::Util#binary (method)">#binary</a></span>, <span class='object_link'><a href="Util.html#chuser-class_method" title="Puppet::Util.chuser (method)">chuser</a></span>, <span class='object_link'><a href="Util.html#classproxy-class_method" title="Puppet::Util.classproxy (method)">classproxy</a></span>, <span class='object_link'><a href="Util.html#execfail-instance_method" title="Puppet::Util#execfail (method)">#execfail</a></span>, <span class='object_link'><a href="Util.html#execpipe-instance_method" title="Puppet::Util#execpipe (method)">#execpipe</a></span>, <span class='object_link'><a href="Util.html#execute-instance_method" title="Puppet::Util#execute (method)">#execute</a></span>, <span class='object_link'><a href="Util.html#logmethods-class_method" title="Puppet::Util.logmethods (method)">logmethods</a></span>, <span class='object_link'><a href="Util.html#memory-instance_method" title="Puppet::Util#memory (method)">#memory</a></span>, <span class='object_link'><a href="Util.html#proxy-class_method" title="Puppet::Util.proxy (method)">proxy</a></span>, <span class='object_link'><a href="Util.html#recmkdir-class_method" title="Puppet::Util.recmkdir (method)">recmkdir</a></span>, <span class='object_link'><a href="Util.html#secure_open-instance_method" title="Puppet::Util#secure_open (method)">#secure_open</a></span>, <span class='object_link'><a href="Util.html#symbolize-instance_method" title="Puppet::Util#symbolize (method)">#symbolize</a></span>, <span class='object_link'><a href="Util.html#symbolizehash-instance_method" title="Puppet::Util#symbolizehash (method)">#symbolizehash</a></span>, <span class='object_link'><a href="Util.html#symbolizehash%21-instance_method" title="Puppet::Util#symbolizehash! (method)">#symbolizehash!</a></span>, <span class='object_link'><a href="Util.html#sync-class_method" title="Puppet::Util.sync (method)">sync</a></span>, <span class='object_link'><a href="Util.html#thinmark-instance_method" title="Puppet::Util#thinmark (method)">#thinmark</a></span>, <span class='object_link'><a href="Util.html#threadlock-instance_method" title="Puppet::Util#threadlock (method)">#threadlock</a></span>, <span class='object_link'><a href="Util.html#withumask-class_method" title="Puppet::Util.withumask (method)">withumask</a></span></p>

  
  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="add_edge-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>add_edge</strong>(*args) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_edge'>add_edge</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
    <span class='ivar'>@reversal</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>super</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 12</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">12
13
14
15
16</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_add_edge'>add_edge</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
    <span class='ivar'>@reversal</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>super</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="add_vertex-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>add_vertex</strong>(*args) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 17</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_vertex'>add_vertex</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
    <span class='ivar'>@reversal</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>super</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 17</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">17
18
19
20
21</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_add_vertex'>add_vertex</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
    <span class='ivar'>@reversal</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>super</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="dependencies-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>dependencies</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Which resources depend upon the given resource.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30
31
32
33
34
35
36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 28</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dependencies'>dependencies</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='comment'># Cache the reversal graph, because it's somewhat expensive
</span>    <span class='comment'># to create.
</span>    <span class='kw'>unless</span> <span class='kw'>defined?</span> <span class='ivar'>@reversal</span> <span class='kw'>and</span> <span class='ivar'>@reversal</span>
        <span class='ivar'>@reversal</span> <span class='op'>=</span> <span class='id identifier rubyid_reversal'>reversal</span>
    <span class='kw'>end</span>
    <span class='comment'># Strangely, it's significantly faster to search a reversed
</span>    <span class='comment'># tree in the :out direction than to search a normal tree
</span>    <span class='comment'># in the :in direction.
</span>    <span class='ivar'>@reversal</span><span class='period'>.</span><span class='id identifier rubyid_tree_from_vertex'>tree_from_vertex</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='symbol'>:out</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 28</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">28
29</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def dependencies(resource)</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Cache the reversal graph, because it&#8217;s somewhat expensive to create.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">31
32
33
34</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='kw'>unless</span> <span class='kw'>defined?</span> <span class='ivar'>@reversal</span> <span class='kw'>and</span> <span class='ivar'>@reversal</span>
        <span class='ivar'>@reversal</span> <span class='op'>=</span> <span class='id identifier rubyid_reversal'>reversal</span>
    <span class='kw'>end</span></pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Strangely, it&#8217;s significantly faster to search a reversed tree in the
:out direction than to search a normal tree in the :in direction.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">37
38
39</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    @reversal.tree_from_vertex(resource, :out).keys
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="dependents-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>dependents</strong>(resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Which resources a given resource depends upon.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 23</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dependents'>dependents</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_tree_from_vertex'>tree_from_vertex</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 23</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">23
24
25
26</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_dependents'>dependents</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_tree_from_vertex'>tree_from_vertex</span><span class='lparen'>(</span><span class='id identifier rubyid_resource'>resource</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="leaves-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>leaves</strong>(vertex, direction = :out) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Determine all of the leaf nodes below a given vertex.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43
44
45</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 41</span>

<span class='kw'>def</span> <span class='id identifier rubyid_leaves'>leaves</span><span class='lparen'>(</span><span class='id identifier rubyid_vertex'>vertex</span><span class='comma'>,</span> <span class='id identifier rubyid_direction'>direction</span> <span class='op'>=</span> <span class='symbol'>:out</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_tree'>tree</span> <span class='op'>=</span> <span class='id identifier rubyid_tree_from_vertex'>tree_from_vertex</span><span class='lparen'>(</span><span class='id identifier rubyid_vertex'>vertex</span><span class='comma'>,</span> <span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_l'>l</span> <span class='op'>=</span> <span class='id identifier rubyid_tree'>tree</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_adjacent'>adjacent</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='comma'>,</span> <span class='symbol'>:direction</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_l'>l</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 41</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">41
42
43
44
45
46</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_leaves'>leaves</span><span class='lparen'>(</span><span class='id identifier rubyid_vertex'>vertex</span><span class='comma'>,</span> <span class='id identifier rubyid_direction'>direction</span> <span class='op'>=</span> <span class='symbol'>:out</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_tree'>tree</span> <span class='op'>=</span> <span class='id identifier rubyid_tree_from_vertex'>tree_from_vertex</span><span class='lparen'>(</span><span class='id identifier rubyid_vertex'>vertex</span><span class='comma'>,</span> <span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_l'>l</span> <span class='op'>=</span> <span class='id identifier rubyid_tree'>tree</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_adjacent'>adjacent</span><span class='lparen'>(</span><span class='id identifier rubyid_c'>c</span><span class='comma'>,</span> <span class='symbol'>:direction</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_l'>l</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="matching_edges-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>matching_edges</strong>(events, base = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Collect all of the edges that the passed events match.  Returns an array of
edges.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 49</span>

<span class='kw'>def</span> <span class='id identifier rubyid_matching_edges'>matching_edges</span><span class='lparen'>(</span><span class='id identifier rubyid_events'>events</span><span class='comma'>,</span> <span class='id identifier rubyid_base'>base</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_event'>event</span><span class='op'>|</span>
        <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='id identifier rubyid_base'>base</span> <span class='op'>||</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_source'>source</span>

        <span class='kw'>unless</span> <span class='id identifier rubyid_vertex?'>vertex?</span><span class='lparen'>(</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
            <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Got an event from invalid vertex %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_ref'>ref</span>
            <span class='kw'>next</span>
        <span class='kw'>end</span>
        <span class='comment'># Get all of the edges that this vertex should forward events
</span>        <span class='comment'># to, which is the same thing as saying all edges directly below
</span>        <span class='comment'># This vertex in the graph.
</span>        <span class='id identifier rubyid_adjacent'>adjacent</span><span class='lparen'>(</span><span class='id identifier rubyid_source'>source</span><span class='comma'>,</span> <span class='symbol'>:direction</span> <span class='op'>=&gt;</span> <span class='symbol'>:out</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='symbol'>:edges</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_edge'>edge</span><span class='op'>|</span>
            <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 49</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">49
50
51
52
53
54
55
56
57</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def matching_edges(events, base = nil)
    events.collect do |event|
        source = base || event.source

        unless vertex?(source)
            Puppet.warning &quot;Got an event from invalid vertex %s&quot; % source.ref
            next
        end</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Get all of the edges that this vertex should forward events to, which is
the same thing as saying all edges directly below This vertex in the graph.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">60
61
62
63
64
65</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        adjacent(source, :direction =&gt; :out, :type =&gt; :edges).find_all do |edge|
            edge.match?(event.name)
        end
    end.compact.flatten
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="splice!-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>splice!</strong>(other, type) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Take container information from another graph and use it to replace any
container vertices with their respective leaves. This creates direct
relationships where there were previously indirect relationships through
the containers.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 70</span>

<span class='kw'>def</span> <span class='id identifier rubyid_splice!'>splice!</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>
    <span class='comment'># We have to get the container list via a topological sort on the
</span>    <span class='comment'># configuration graph, because otherwise containers that contain
</span>    <span class='comment'># other containers will add those containers back into the
</span>    <span class='comment'># graph.  We could get a similar affect by only setting relationships
</span>    <span class='comment'># to container leaves, but that would result in many more
</span>    <span class='comment'># relationships.
</span>    <span class='id identifier rubyid_containers'>containers</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_topsort'>topsort</span><span class='period'>.</span><span class='id identifier rubyid_find_all'>find_all</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_vertex?'>vertex?</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_containers'>containers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_container'>container</span><span class='op'>|</span>
        <span class='comment'># Get the list of children from the other graph.
</span>        <span class='id identifier rubyid_children'>children</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_adjacent'>adjacent</span><span class='lparen'>(</span><span class='id identifier rubyid_container'>container</span><span class='comma'>,</span> <span class='symbol'>:direction</span> <span class='op'>=&gt;</span> <span class='symbol'>:out</span><span class='rparen'>)</span>

        <span class='comment'># Just remove the container if it's empty.
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_remove_vertex!'>remove_vertex!</span><span class='lparen'>(</span><span class='id identifier rubyid_container'>container</span><span class='rparen'>)</span>
            <span class='kw'>next</span>
        <span class='kw'>end</span>
        
        <span class='comment'># First create new edges for each of the :in edges
</span>        <span class='lbracket'>[</span><span class='symbol'>:in</span><span class='comma'>,</span> <span class='symbol'>:out</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_dir'>dir</span><span class='op'>|</span>
            <span class='id identifier rubyid_edges'>edges</span> <span class='op'>=</span> <span class='id identifier rubyid_adjacent'>adjacent</span><span class='lparen'>(</span><span class='id identifier rubyid_container'>container</span><span class='comma'>,</span> <span class='symbol'>:direction</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='symbol'>:edges</span><span class='rparen'>)</span>
            <span class='id identifier rubyid_edges'>edges</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_edge'>edge</span><span class='op'>|</span>
                <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_child'>child</span><span class='op'>|</span>
                    <span class='kw'>if</span> <span class='id identifier rubyid_dir'>dir</span> <span class='op'>==</span> <span class='symbol'>:in</span>
                        <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_source'>source</span>
                        <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_child'>child</span>
                    <span class='kw'>else</span>
                        <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_child'>child</span>
                        <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_target'>target</span>
                    <span class='kw'>end</span>

                    <span class='id identifier rubyid_add_edge'>add_edge</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='id identifier rubyid_edge'>edge</span><span class='period'>.</span><span class='id identifier rubyid_label'>label</span><span class='rparen'>)</span>
                <span class='kw'>end</span>

                <span class='comment'># Now get rid of the edge, so remove_vertex! works correctly.
</span>                <span class='id identifier rubyid_remove_edge!'>remove_edge!</span><span class='lparen'>(</span><span class='id identifier rubyid_edge'>edge</span><span class='rparen'>)</span>
            <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_remove_vertex!'>remove_vertex!</span><span class='lparen'>(</span><span class='id identifier rubyid_container'>container</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 70</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">70
71</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def splice!(other, type)</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
We have to get the container list via a topological sort on the
configuration graph, because otherwise containers that contain other
containers will add those containers back into the graph.  We could get a
similar affect by only setting relationships to container leaves, but that
would result in many more relationships.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">77
78
79</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    containers = other.topsort.find_all { |v| v.is_a?(type) and vertex?(v) }
    containers.each do |container|</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Get the list of children from the other graph.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">80
81
82</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        <span class='id identifier rubyid_children'>children</span> <span class='op'>=</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_adjacent'>adjacent</span><span class='lparen'>(</span><span class='id identifier rubyid_container'>container</span><span class='comma'>,</span> <span class='symbol'>:direction</span> <span class='op'>=&gt;</span> <span class='symbol'>:out</span><span class='rparen'>)</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Just remove the container if it&#8217;s empty.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">83
84
85
86
87
88</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        <span class='kw'>if</span> <span class='id identifier rubyid_children'>children</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
            <span class='id identifier rubyid_remove_vertex!'>remove_vertex!</span><span class='lparen'>(</span><span class='id identifier rubyid_container'>container</span><span class='rparen'>)</span>
            <span class='kw'>next</span>
        <span class='kw'>end</span>
        </pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
First create new edges for each of the :in edges
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        [:in, :out].each do |dir|
            edges = adjacent(container, :direction =&gt; dir, :type =&gt; :edges)
            edges.each do |edge|
                children.each do |child|
                    if dir == :in
                        s = edge.source
                        t = child
                    else
                        s = child
                        t = edge.target
                    end

                    add_edge(s, t, edge.label)
                end
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Now get rid of the edge, so remove_vertex! works correctly.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">105
106
107
108
109
110
111</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">                remove_edge!(edge)
            end
        end
        remove_vertex!(container)
    end
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="tree_from_vertex-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>tree_from_vertex</strong>(start, direction = :out) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A different way of walking a tree, and a much faster way than the one that
comes with GRATR.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116
117
118
119
120</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 114</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tree_from_vertex'>tree_from_vertex</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_direction'>direction</span> <span class='op'>=</span> <span class='symbol'>:out</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_predecessor'>predecessor</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_walk'>walk</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_child'>child</span><span class='op'>|</span>
        <span class='id identifier rubyid_predecessor'>predecessor</span><span class='lbracket'>[</span><span class='id identifier rubyid_child'>child</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_parent'>parent</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_predecessor'>predecessor</span>       
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/pgraph.rb', line 114</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">114
115
116
117
118
119
120
121</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_tree_from_vertex'>tree_from_vertex</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_direction'>direction</span> <span class='op'>=</span> <span class='symbol'>:out</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_predecessor'>predecessor</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_walk'>walk</span><span class='lparen'>(</span><span class='id identifier rubyid_start'>start</span><span class='comma'>,</span> <span class='id identifier rubyid_direction'>direction</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_parent'>parent</span><span class='comma'>,</span> <span class='id identifier rubyid_child'>child</span><span class='op'>|</span>
        <span class='id identifier rubyid_predecessor'>predecessor</span><span class='lbracket'>[</span><span class='id identifier rubyid_child'>child</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_parent'>parent</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_predecessor'>predecessor</span>       
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Mar  6 02:12:31 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.5 (ruby-1.9.2).
</div>

  </body>
</html>