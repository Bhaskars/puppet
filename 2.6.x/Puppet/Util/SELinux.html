<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Puppet::Util::SELinux
  
    &mdash; Documentation by YARD 0.7.5
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/docco.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/docco.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Puppet.html" title="Puppet (module)">Puppet</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Util.html" title="Puppet::Util (module)">Util</a></span></span>
     &raquo; 
    <span class="title">SELinux</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Puppet::Util::SELinux
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="../SELFileContext.html" title="Puppet::SELFileContext (class)">SELFileContext</a></span>, <span class='object_link'><a href="FileType.html" title="Puppet::Util::FileType (class)">FileType</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/puppet/util/selinux.rb</dd>
  
</dl>
<div class="clear"></div>








  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_fs-instance_method" title="#find_fs (instance method)">- (Object) <strong>find_fs</strong>(path) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Internal helper function to return which type of filesystem a given file
path resides on.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_selinux_current_context-instance_method" title="#get_selinux_current_context (instance method)">- (Object) <strong>get_selinux_current_context</strong>(file) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Retrieve and return the full context of the file.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_selinux_default_context-instance_method" title="#get_selinux_default_context (instance method)">- (Object) <strong>get_selinux_default_context</strong>(file) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Retrieve and return the default context of the file.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parent_directory-instance_method" title="#parent_directory (instance method)">- (Object) <strong>parent_directory</strong>(path) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_selinux_context-instance_method" title="#parse_selinux_context (instance method)">- (Object) <strong>parse_selinux_context</strong>(component, context) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Take the full SELinux context returned from the tools and parse it out to
the three (or four) component parts.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read_mounts-instance_method" title="#read_mounts (instance method)">- (Object) <strong>read_mounts</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Internal helper function to read and parse /proc/mounts.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#realpath-instance_method" title="#realpath (instance method)">- (Object) <strong>realpath</strong>(path) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#selinux_label_support%3F-instance_method" title="#selinux_label_support? (instance method)">- (Boolean) <strong>selinux_label_support?</strong>(file) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Check filesystem a path resides on for SELinux support against whitelist of
known-good filesystems.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#selinux_support%3F-instance_method" title="#selinux_support? (instance method)">- (Boolean) <strong>selinux_support?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_selinux_context-instance_method" title="#set_selinux_context (instance method)">- (Object) <strong>set_selinux_context</strong>(file, value, component = false) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This updates the actual SELinux label on the file.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_selinux_default_context-instance_method" title="#set_selinux_default_context (instance method)">- (Object) <strong>set_selinux_default_context</strong>(file) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Since this call relies on get_selinux_default_context it also needs a full
non-relative path to the file.
</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="find_fs-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>find_fs</strong>(path) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Internal helper function to return which type of filesystem a given file
path resides on
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 186</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_fs'>find_fs</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_mnts'>mnts</span> <span class='op'>=</span> <span class='id identifier rubyid_read_mounts'>read_mounts</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='comment'># For a given file:
</span>  <span class='comment'># Check if the filename is in the data structure;
</span>  <span class='comment'>#   return the fstype if it is.
</span>  <span class='comment'># Just in case: return something if you're down to &quot;/&quot; or &quot;&quot;
</span>  <span class='comment'># Remove the last slash and everything after it,
</span>  <span class='comment'>#   and repeat with that as the file for the next loop through.
</span>  <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_realpath'>realpath</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='kw'>while</span> <span class='kw'>not</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_mnts'>mnts</span><span class='lbracket'>[</span><span class='id identifier rubyid_path'>path</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_mnts'>mnts</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_parent_directory'>parent_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_mnts'>mnts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 186</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">186
187
188
189
190
191</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def find_fs(path)
  unless mnts = read_mounts
    return nil
  end
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
For a given file: Check if the filename is in the data structure;
</p>
<pre class="code ruby"><code>
  return the fstype if it is.
</code></pre>
<p>
Just in case: return something if you&#8217;re down to &#8220;/&#8221; or
&#8220;&#8221; Remove the last slash and everything after it,
</p>
<pre class="code ruby"><code>
  and repeat with that as the file for the next loop through.</code></pre>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">197
198
199
200
201
202
203
204</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  path = realpath(path)
  while not path.empty?
    return mnts[path] if mnts.has_key?(path)
    path = parent_directory(path)
  end
  mnts['/']
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="get_selinux_current_context-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_selinux_current_context</strong>(file) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Retrieve and return the full context of the file.  If we don&#8217;t have
SELinux support or if the SELinux call fails then return nil.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30
31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 26</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_selinux_current_context'>get_selinux_current_context</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_selinux_support?'>selinux_support?</span>
  <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='const'>Selinux</span><span class='period'>.</span><span class='id identifier rubyid_lgetfilecon'>lgetfilecon</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span> <span class='op'>==</span> <span class='op'>-</span><span class='int'>1</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 26</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">26
27
28
29
30
31
32
33
34</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_get_selinux_current_context'>get_selinux_current_context</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_selinux_support?'>selinux_support?</span>
  <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='const'>Selinux</span><span class='period'>.</span><span class='id identifier rubyid_lgetfilecon'>lgetfilecon</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span> <span class='op'>==</span> <span class='op'>-</span><span class='int'>1</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="get_selinux_default_context-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_selinux_default_context</strong>(file) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Retrieve and return the default context of the file.  If we don&#8217;t
have SELinux support or if the SELinux call fails to file a default then
return nil.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 37</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_selinux_default_context'>get_selinux_default_context</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_selinux_support?'>selinux_support?</span>
  <span class='comment'># If the filesystem has no support for SELinux labels, return a default of nil
</span>  <span class='comment'># instead of what matchpathcon would return
</span>  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_selinux_label_support?'>selinux_label_support?</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='comment'># If the file exists we should pass the mode to matchpathcon for the most specific
</span>  <span class='comment'># matching.  If not, we can pass a mode of 0.
</span>  <span class='kw'>begin</span>
    <span class='id identifier rubyid_filestat'>filestat</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_lstat'>lstat</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_mode'>mode</span> <span class='op'>=</span> <span class='id identifier rubyid_filestat'>filestat</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span>
  <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span>
    <span class='id identifier rubyid_mode'>mode</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='const'>Selinux</span><span class='period'>.</span><span class='id identifier rubyid_matchpathcon'>matchpathcon</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_mode'>mode</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span> <span class='op'>==</span> <span class='op'>-</span><span class='int'>1</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_retval'>retval</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 37</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">37
38
39</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def get_selinux_default_context(file)
  return nil unless selinux_support?</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
If the filesystem has no support for SELinux labels, return a default of
nil instead of what matchpathcon would return
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">41
42</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_selinux_label_support?'>selinux_label_support?</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span></pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
If the file exists we should pass the mode to matchpathcon for the most
specific matching.  If not, we can pass a mode of 0.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">44
45
46
47
48
49
50
51
52
53
54
55
56</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  begin
    filestat = File.lstat(file)
    mode = filestat.mode
  rescue Errno::ENOENT
    mode = 0
  end
  retval = Selinux.matchpathcon(file, mode)
  if retval == -1
    return nil
  end
  retval[1]
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="parent_directory-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>parent_directory</strong>(path) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


180
181
182</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 180</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parent_directory'>parent_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='const'>Pathname</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 180</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">180
181
182
183</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_parent_directory'>parent_directory</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='const'>Pathname</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="parse_selinux_context-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>parse_selinux_context</strong>(component, context) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Take the full SELinux context returned from the tools and parse it out to
the three (or four) component parts.  Supports :seluser, :selrole,
:seltype, and on systems with range support, :selrange.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 60</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parse_selinux_context'>parse_selinux_context</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_context'>context</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_context'>context</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unlabeled</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_context'>context</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^([a-z0-9_]+):([a-z0-9_]+):([a-zA-Z0-9_]+)(?::([a-zA-Z0-9:,._-]+))?</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid context to parse: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_context'>context</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:seluser</span> <span class='op'>=&gt;</span> <span class='backref'>$1</span><span class='comma'>,</span>
    <span class='symbol'>:selrole</span> <span class='op'>=&gt;</span> <span class='backref'>$2</span><span class='comma'>,</span>
    <span class='symbol'>:seltype</span> <span class='op'>=&gt;</span> <span class='backref'>$3</span><span class='comma'>,</span>
    <span class='symbol'>:selrange</span> <span class='op'>=&gt;</span> <span class='backref'>$4</span><span class='comma'>,</span>
  <span class='rbrace'>}</span>
  <span class='id identifier rubyid_ret'>ret</span><span class='lbracket'>[</span><span class='id identifier rubyid_component'>component</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 60</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_parse_selinux_context'>parse_selinux_context</span><span class='lparen'>(</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='id identifier rubyid_context'>context</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_context'>context</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unlabeled</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_context'>context</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^([a-z0-9_]+):([a-z0-9_]+):([a-zA-Z0-9_]+)(?::([a-zA-Z0-9:,._-]+))?</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid context to parse: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_context'>context</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:seluser</span> <span class='op'>=&gt;</span> <span class='backref'>$1</span><span class='comma'>,</span>
    <span class='symbol'>:selrole</span> <span class='op'>=&gt;</span> <span class='backref'>$2</span><span class='comma'>,</span>
    <span class='symbol'>:seltype</span> <span class='op'>=&gt;</span> <span class='backref'>$3</span><span class='comma'>,</span>
    <span class='symbol'>:selrange</span> <span class='op'>=&gt;</span> <span class='backref'>$4</span><span class='comma'>,</span>
  <span class='rbrace'>}</span>
  <span class='id identifier rubyid_ret'>ret</span><span class='lbracket'>[</span><span class='id identifier rubyid_component'>component</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="read_mounts-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>read_mounts</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Internal helper function to read and parse /proc/mounts
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 140</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read_mounts'>read_mounts</span>
  <span class='id identifier rubyid_mounts'>mounts</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>begin</span>
    <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_instance_methods'>instance_methods</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>read_nonblock</span><span class='tstring_end'>&quot;</span></span>
      <span class='comment'># If possible we use read_nonblock in a loop rather than read to work-
</span>      <span class='comment'># a linux kernel bug.  See ticket #1963 for details.
</span>      <span class='id identifier rubyid_mountfh'>mountfh</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/proc/mounts</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_mounts'>mounts</span> <span class='op'>+=</span> <span class='id identifier rubyid_mountfh'>mountfh</span><span class='period'>.</span><span class='id identifier rubyid_read_nonblock'>read_nonblock</span><span class='lparen'>(</span><span class='int'>1024</span><span class='rparen'>)</span> <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='kw'>else</span>
      <span class='comment'># Otherwise we shell out and let cat do it for us
</span>      <span class='id identifier rubyid_mountfh'>mountfh</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_popen'>popen</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/bin/cat /proc/mounts</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_mounts'>mounts</span> <span class='op'>=</span> <span class='id identifier rubyid_mountfh'>mountfh</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>EOFError</span>
    <span class='comment'># that's expected
</span>  <span class='kw'>rescue</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>ensure</span>
    <span class='id identifier rubyid_mountfh'>mountfh</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='id identifier rubyid_mountfh'>mountfh</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_mntpoint'>mntpoint</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='comment'># Read all entries in /proc/mounts.  The second column is the
</span>  <span class='comment'># mountpoint and the third column is the filesystem type.
</span>  <span class='comment'># We skip rootfs because it is always mounted at /
</span>  <span class='id identifier rubyid_mounts'>mounts</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
    <span class='id identifier rubyid_params'>params</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> </span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rootfs</span><span class='tstring_end'>'</span></span>
    <span class='id identifier rubyid_mntpoint'>mntpoint</span><span class='lbracket'>[</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_mntpoint'>mntpoint</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 140</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">140
141
142
143
144</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def read_mounts
  mounts = &quot;&quot;
  begin
    if File.instance_methods.include? &quot;read_nonblock&quot;</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
If possible we use read_nonblock in a loop rather than read to work- a
linux kernel bug.  See ticket #1963 for details.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">146
147
148
149</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">      mountfh = File.open(&quot;/proc/mounts&quot;)
      mounts += mountfh.read_nonblock(1024) while true
    else</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Otherwise we shell out and let cat do it for us
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">150
151
152
153
154</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">      mountfh = IO.popen(&quot;/bin/cat /proc/mounts&quot;)
      mounts = mountfh.read
    end
  rescue EOFError</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
that&#8217;s expected
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">155
156
157
158
159
160
161
162
163</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  rescue
    return nil
  ensure
    mountfh.close if mountfh
  end

  mntpoint = {}
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Read all entries in /proc/mounts.  The second column is the mountpoint and
the third column is the filesystem type. We skip rootfs because it is
always mounted at /
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">166
167
168
169
170
171
172
173</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  mounts.collect do |line|
    params = line.split(' ')
    next if params[2] == 'rootfs'
    mntpoint[params[1]] = params[2]
  end
  mntpoint
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="realpath-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>realpath</strong>(path) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174
175
176
177
178</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 174</span>

<span class='kw'>def</span> <span class='id identifier rubyid_realpath'>realpath</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span> <span class='op'>=</span> <span class='const'>Pathname</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span> <span class='op'>=</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_rest'>rest</span> <span class='kw'>while</span> <span class='op'>!</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_realpath'>realpath</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 174</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">174
175
176
177
178
179</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_realpath'>realpath</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span> <span class='op'>=</span> <span class='const'>Pathname</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_rest'>rest</span> <span class='op'>=</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_rest'>rest</span> <span class='kw'>while</span> <span class='op'>!</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_realpath'>realpath</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rest'>rest</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="selinux_label_support?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>selinux_label_support?</strong>(file) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Check filesystem a path resides on for SELinux support against whitelist of
known-good filesystems. Returns true if the filesystem can support SELinux
labels and false if not.
</p>


  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


209
210
211
212
213
214</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 209</span>

<span class='kw'>def</span> <span class='id identifier rubyid_selinux_label_support?'>selinux_label_support?</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fstype'>fstype</span> <span class='op'>=</span> <span class='id identifier rubyid_find_fs'>find_fs</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_fstype'>fstype</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_filesystems'>filesystems</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ext2</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ext3</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ext4</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>gfs</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>gfs2</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>xfs</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>jfs</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_filesystems'>filesystems</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_fstype'>fstype</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 209</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">209
210
211
212
213
214
215</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_selinux_label_support?'>selinux_label_support?</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fstype'>fstype</span> <span class='op'>=</span> <span class='id identifier rubyid_find_fs'>find_fs</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_fstype'>fstype</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_filesystems'>filesystems</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ext2</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ext3</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ext4</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>gfs</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>gfs2</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>xfs</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>jfs</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_filesystems'>filesystems</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_fstype'>fstype</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="selinux_support?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>selinux_support?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


16
17
18
19
20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 16</span>

<span class='kw'>def</span> <span class='id identifier rubyid_selinux_support?'>selinux_support?</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>Selinux</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Selinux</span><span class='period'>.</span><span class='id identifier rubyid_is_selinux_enabled'>is_selinux_enabled</span> <span class='op'>==</span> <span class='int'>1</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 16</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">16
17
18
19
20
21
22
23</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_selinux_support?'>selinux_support?</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='const'>Selinux</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Selinux</span><span class='period'>.</span><span class='id identifier rubyid_is_selinux_enabled'>is_selinux_enabled</span> <span class='op'>==</span> <span class='int'>1</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='kw'>false</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="set_selinux_context-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>set_selinux_context</strong>(file, value, component = false) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This updates the actual SELinux label on the file.  You can update only a
single component or update the entire context. The caveat is that since
setting a partial context makes no sense the file has to already exist. 
Puppet (via the File resource) will always just try to set components, even
if all values are specified by the manifest. I believe that the OS should
always provide at least a fall-through context though on any well-running
system.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 83</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_selinux_context'>set_selinux_context</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='comma'>,</span> <span class='id identifier rubyid_component'>component</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_selinux_support?'>selinux_support?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_selinux_label_support?'>selinux_label_support?</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_component'>component</span>
    <span class='comment'># Must first get existing context to replace a single component
</span>    <span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='const'>Selinux</span><span class='period'>.</span><span class='id identifier rubyid_lgetfilecon'>lgetfilecon</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_context'>context</span> <span class='op'>==</span> <span class='op'>-</span><span class='int'>1</span>
      <span class='comment'># We can't set partial context components when no context exists
</span>      <span class='comment'># unless/until we can find a way to make Puppet call this method
</span>      <span class='comment'># once for all selinux file label attributes.
</span>      <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can't set SELinux context on file unless the file already has some kind of context</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>return</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_component'>component</span>
      <span class='kw'>when</span> <span class='symbol'>:seluser</span>
        <span class='id identifier rubyid_context'>context</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
      <span class='kw'>when</span> <span class='symbol'>:selrole</span>
        <span class='id identifier rubyid_context'>context</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
      <span class='kw'>when</span> <span class='symbol'>:seltype</span>
        <span class='id identifier rubyid_context'>context</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
      <span class='kw'>when</span> <span class='symbol'>:selrange</span>
        <span class='id identifier rubyid_context'>context</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArguementError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>set_selinux_context component must be one of :seluser, :selrole, :seltype, or :selrange</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='id identifier rubyid_context'>context</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_context'>context</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_retval'>retval</span> <span class='op'>=</span> <span class='const'>Selinux</span><span class='period'>.</span><span class='id identifier rubyid_lsetfilecon'>lsetfilecon</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_context'>context</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_retval'>retval</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to set SELinux context </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_context'>context</span><span class='rbrace'>}</span><span class='tstring_content'> on </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file'>file</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 83</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">83
84
85
86
87</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def set_selinux_context(file, value, component = false)
  return nil unless selinux_support? &amp;&amp; selinux_label_support?(file)

  if component</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Must first get existing context to replace a single component
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">88
89
90</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    context = Selinux.lgetfilecon(file)[1]
    if context == -1</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
We can&#8217;t set partial context components when no context exists
unless/until we can find a way to make Puppet call this method once for all
selinux file label attributes.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">      Puppet.warning &quot;Can't set SELinux context on file unless the file already has some kind of context&quot;
      return nil
    end
    context = context.split(':')
    case component
      when :seluser
        context[0] = value
      when :selrole
        context[1] = value
      when :seltype
        context[2] = value
      when :selrange
        context[3] = value
      else
        raise ArguementError, &quot;set_selinux_context component must be one of :seluser, :selrole, :seltype, or :selrange&quot;
    end
    context = context.join(':')
  else
    context = value
  end

  retval = Selinux.lsetfilecon(file, context)
  if retval == 0
    return true
  else
    Puppet.warning &quot;Failed to set SELinux context #{context} on #{file}&quot;
    return false
  end
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="set_selinux_default_context-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>set_selinux_default_context</strong>(file) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Since this call relies on get_selinux_default_context it also needs a full
non-relative path to the file.  Fortunately, that seems to be all Puppet
uses.  This will set the file&#8217;s SELinux context to the policy&#8217;s
default context (if any) if it differs from the context currently on the
file.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


128
129
130
131
132
133
134
135
136
137</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 128</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_selinux_default_context'>set_selinux_default_context</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new_context'>new_context</span> <span class='op'>=</span> <span class='id identifier rubyid_get_selinux_default_context'>get_selinux_default_context</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_new_context'>new_context</span>
  <span class='id identifier rubyid_cur_context'>cur_context</span> <span class='op'>=</span> <span class='id identifier rubyid_get_selinux_current_context'>get_selinux_current_context</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_new_context'>new_context</span> <span class='op'>!=</span> <span class='id identifier rubyid_cur_context'>cur_context</span>
    <span class='id identifier rubyid_set_selinux_context'>set_selinux_context</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_new_context'>new_context</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_new_context'>new_context</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/util/selinux.rb', line 128</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">128
129
130
131
132
133
134
135
136
137
138</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_set_selinux_default_context'>set_selinux_default_context</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new_context'>new_context</span> <span class='op'>=</span> <span class='id identifier rubyid_get_selinux_default_context'>get_selinux_default_context</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_new_context'>new_context</span>
  <span class='id identifier rubyid_cur_context'>cur_context</span> <span class='op'>=</span> <span class='id identifier rubyid_get_selinux_current_context'>get_selinux_current_context</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_new_context'>new_context</span> <span class='op'>!=</span> <span class='id identifier rubyid_cur_context'>cur_context</span>
    <span class='id identifier rubyid_set_selinux_context'>set_selinux_context</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_new_context'>new_context</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_new_context'>new_context</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Mar  6 02:14:07 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.5 (ruby-1.9.2).
</div>

  </body>
</html>