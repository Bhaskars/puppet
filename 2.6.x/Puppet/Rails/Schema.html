<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Puppet::Rails::Schema
  
    &mdash; Documentation by YARD 0.7.5
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/docco.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/docco.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Puppet.html" title="Puppet (module)">Puppet</a></span></span> &raquo; <span class='title'>Rails</span>
     &raquo; 
    <span class="title">Schema</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Puppet::Rails::Schema
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Puppet::Rails::Schema</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/puppet/rails/database/schema.rb</dd>
  
</dl>
<div class="clear"></div>








  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#init-class_method" title="init (class method)">+ (Object) <strong>init</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="init-class_method">
  
    + (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>init</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/rails/database/schema.rb', line 2</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_init'>init</span>
  <span class='id identifier rubyid_oldout'>oldout</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Util</span><span class='period'>.</span><span class='id identifier rubyid_benchmark'>benchmark</span><span class='lparen'>(</span><span class='const'>Puppet</span><span class='comma'>,</span> <span class='symbol'>:notice</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Initialized database</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='comment'># We want to rewrite stdout, so we don't get migration messages.
</span>    <span class='id identifier rubyid_oldout'>oldout</span> <span class='op'>=</span> <span class='gvar'>$stdout</span>
    <span class='gvar'>$stdout</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/dev/null</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>w</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Schema</span><span class='period'>.</span><span class='id identifier rubyid_define'>define</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:resources</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:title</span><span class='comma'>,</span> <span class='symbol'>:text</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:restype</span><span class='comma'>,</span>  <span class='symbol'>:string</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:host_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:source_file_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:exported</span><span class='comma'>,</span> <span class='symbol'>:boolean</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:line</span><span class='comma'>,</span> <span class='symbol'>:integer</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:resources</span><span class='comma'>,</span> <span class='symbol'>:host_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:resources</span><span class='comma'>,</span> <span class='symbol'>:source_file_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>

      <span class='comment'># Thanks, mysql!  MySQL requires a length on indexes in text fields.
</span>      <span class='comment'># So, we provide them for mysql and handle everything else specially.
</span>      <span class='comment'># Oracle doesn't index on CLOB fields, so we skip it
</span>      <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:dbadapter</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mysql</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CREATE INDEX typentitle ON resources (restype,title(50));</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>elsif</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:dbadapter</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>oracle_enhanced</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:resources</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:title</span><span class='comma'>,</span> <span class='symbol'>:restype</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:source_files</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:filename</span><span class='comma'>,</span> <span class='symbol'>:string</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:path</span><span class='comma'>,</span> <span class='symbol'>:string</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:source_files</span><span class='comma'>,</span> <span class='symbol'>:filename</span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:resource_tags</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:resource_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:puppet_tag_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:resource_tags</span><span class='comma'>,</span> <span class='symbol'>:resource_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:resource_tags</span><span class='comma'>,</span> <span class='symbol'>:puppet_tag_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:puppet_tags</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:string</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>

      <span class='comment'># Oracle automatically creates a primary key index
</span>      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:puppet_tags</span><span class='comma'>,</span> <span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:integer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:dbadapter</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>oracle_enhanced</span><span class='tstring_end'>&quot;</span></span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:hosts</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:string</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:ip</span><span class='comma'>,</span> <span class='symbol'>:string</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:environment</span><span class='comma'>,</span> <span class='symbol'>:text</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:last_compile</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:last_freshcheck</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:last_report</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='comment'>#Use updated_at to automatically add timestamp on save.
</span>        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:source_file_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:hosts</span><span class='comma'>,</span> <span class='symbol'>:source_file_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:hosts</span><span class='comma'>,</span> <span class='symbol'>:name</span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:fact_names</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:string</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:fact_names</span><span class='comma'>,</span> <span class='symbol'>:name</span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:fact_values</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:value</span><span class='comma'>,</span> <span class='symbol'>:text</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:fact_name_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:host_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:fact_values</span><span class='comma'>,</span> <span class='symbol'>:fact_name_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:fact_values</span><span class='comma'>,</span> <span class='symbol'>:host_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:param_values</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:value</span><span class='comma'>,</span>  <span class='symbol'>:text</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:param_name_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:line</span><span class='comma'>,</span> <span class='symbol'>:integer</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:resource_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:param_values</span><span class='comma'>,</span> <span class='symbol'>:param_name_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:param_values</span><span class='comma'>,</span> <span class='symbol'>:resource_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:param_names</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:string</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:param_names</span><span class='comma'>,</span> <span class='symbol'>:name</span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:inventory_nodes</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:string</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:timestamp</span><span class='comma'>,</span> <span class='symbol'>:datetime</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:inventory_nodes</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:unique</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:inventory_facts</span><span class='comma'>,</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='kw'>false</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:node_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:string</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:value</span><span class='comma'>,</span> <span class='symbol'>:text</span><span class='comma'>,</span> <span class='symbol'>:null</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:inventory_facts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:node_id</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:unique</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>ensure</span>
  <span class='gvar'>$stdout</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='gvar'>$stdout</span> <span class='op'>=</span> <span class='id identifier rubyid_oldout'>oldout</span> <span class='kw'>if</span> <span class='id identifier rubyid_oldout'>oldout</span>
  <span class='id identifier rubyid_oldout'>oldout</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/rails/database/schema.rb', line 2</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">2
3
4
5</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def self.init
  oldout = nil
  Puppet::Util.benchmark(Puppet, :notice, &quot;Initialized database&quot;) do</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
We want to rewrite stdout, so we don&#8217;t get migration messages.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    oldout = $stdout
    $stdout = File.open(&quot;/dev/null&quot;, &quot;w&quot;)
    ActiveRecord::Schema.define do
      create_table :resources do |t|
        t.column :title, :text, :null =&gt; false
        t.column :restype,  :string, :null =&gt; false
        t.column :host_id, :integer
        t.column :source_file_id, :integer
        t.column :exported, :boolean
        t.column :line, :integer
        t.column :updated_at, :datetime
        t.column :created_at, :datetime
      end
      add_index :resources, :host_id, :integer =&gt; true
      add_index :resources, :source_file_id, :integer =&gt; true
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Thanks, mysql!  MySQL requires a length on indexes in text fields. So, we
provide them for mysql and handle everything else specially. Oracle
doesn&#8217;t index on CLOB fields, so we skip it
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">      <span class='kw'>if</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:dbadapter</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>mysql</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CREATE INDEX typentitle ON resources (restype,title(50));</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>elsif</span> <span class='const'>Puppet</span><span class='lbracket'>[</span><span class='symbol'>:dbadapter</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>oracle_enhanced</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:resources</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:title</span><span class='comma'>,</span> <span class='symbol'>:restype</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:source_files</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:filename</span><span class='comma'>,</span> <span class='symbol'>:string</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:path</span><span class='comma'>,</span> <span class='symbol'>:string</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:source_files</span><span class='comma'>,</span> <span class='symbol'>:filename</span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:resource_tags</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:resource_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:puppet_tag_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:resource_tags</span><span class='comma'>,</span> <span class='symbol'>:resource_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_add_index'>add_index</span> <span class='symbol'>:resource_tags</span><span class='comma'>,</span> <span class='symbol'>:puppet_tag_id</span><span class='comma'>,</span> <span class='symbol'>:integer</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>

      <span class='id identifier rubyid_create_table'>create_table</span> <span class='symbol'>:puppet_tags</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:string</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:updated_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
        <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_column'>column</span> <span class='symbol'>:created_at</span><span class='comma'>,</span> <span class='symbol'>:datetime</span>
      <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Oracle automatically creates a primary key index
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">55
56
57
58
59
60
61
62
63
64</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">      add_index :puppet_tags, :id, :integer =&gt; true if Puppet[:dbadapter] != &quot;oracle_enhanced&quot;

      create_table :hosts do |t|
        t.column :name, :string, :null =&gt; false
        t.column :ip, :string
        t.column :environment, :text
        t.column :last_compile, :datetime
        t.column :last_freshcheck, :datetime
        t.column :last_report, :datetime</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Use updated_at to automatically add timestamp on save.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        t.column :updated_at, :datetime
        t.column :source_file_id, :integer
        t.column :created_at, :datetime
      end
      add_index :hosts, :source_file_id, :integer =&gt; true
      add_index :hosts, :name

      create_table :fact_names do |t|
        t.column :name, :string, :null =&gt; false
        t.column :updated_at, :datetime
        t.column :created_at, :datetime
      end
      add_index :fact_names, :name

      create_table :fact_values do |t|
        t.column :value, :text, :null =&gt; false
        t.column :fact_name_id, :integer, :null =&gt; false
        t.column :host_id, :integer, :null =&gt; false
        t.column :updated_at, :datetime
        t.column :created_at, :datetime
      end
      add_index :fact_values, :fact_name_id, :integer =&gt; true
      add_index :fact_values, :host_id, :integer =&gt; true

      create_table :param_values do |t|
        t.column :value,  :text, :null =&gt; false
        t.column :param_name_id, :integer, :null =&gt; false
        t.column :line, :integer
        t.column :resource_id, :integer
        t.column :updated_at, :datetime
        t.column :created_at, :datetime
      end
      add_index :param_values, :param_name_id, :integer =&gt; true
      add_index :param_values, :resource_id, :integer =&gt; true

      create_table :param_names do |t|
        t.column :name, :string, :null =&gt; false
        t.column :updated_at, :datetime
        t.column :created_at, :datetime
      end
      add_index :param_names, :name

      create_table :inventory_nodes do |t|
        t.column :name, :string, :null =&gt; false
        t.column :timestamp, :datetime, :null =&gt; false
        t.column :updated_at, :datetime
        t.column :created_at, :datetime
      end

      add_index :inventory_nodes, :name, :unique =&gt; true

      create_table :inventory_facts, :id =&gt; false do |t|
        t.column :node_id, :integer, :null =&gt; false
        t.column :name, :string, :null =&gt; false
        t.column :value, :text, :null =&gt; false
      end

      add_index :inventory_facts, [:node_id, :name], :unique =&gt; true
    end
  end
ensure
  $stdout.close
  $stdout = oldout if oldout
  oldout = nil
end</pre>
      </td>
    </tr>
  

</table>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Mar  6 02:14:23 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.5 (ruby-1.9.2).
</div>

  </body>
</html>