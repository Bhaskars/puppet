<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Puppet::Provider::NameService::DirectoryService
  
    &mdash; Documentation by YARD 0.7.5
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/docco.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/docco.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (D)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../../Puppet.html" title="Puppet (module)">Puppet</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Provider.html" title="Puppet::Provider (class)">Provider</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../NameService.html" title="Puppet::Provider::NameService (class)">NameService</a></span></span>
     &raquo; 
    <span class="title">DirectoryService</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Puppet::Provider::NameService::DirectoryService
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../NameService.html" title="Puppet::Provider::NameService (class)">Puppet::Provider::NameService</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next"><span class='object_link'><a href="../../Provider.html" title="Puppet::Provider (class)">Puppet::Provider</a></span></li>
          
            <li class="next"><span class='object_link'><a href="../NameService.html" title="Puppet::Provider::NameService (class)">Puppet::Provider::NameService</a></span></li>
          
            <li class="next">Puppet::Provider::NameService::DirectoryService</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/puppet/provider/nameservice/directoryservice.rb</dd>
  
</dl>
<div class="clear"></div>


  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="ds_to_ns_attribute_map-classvariable" class="">@@ds_to_ns_attribute_map =
          <div class="docstring">
  <div class="discussion">
    <p>
JJM 2007-07-25: This map is used to map NameService attributes to their
</p>
<pre class="code ruby"><code>
    corresponding DirectoryService attribute names.
    See: http://images.apple.com/server/docs.Open_Directory_v10.4.pdf
</code></pre>
<p>
JJM: Note, this is de-coupled from the Puppet::Type, and must
</p>
<pre class="code ruby"><code>
    be actively maintained.  There may also be collisions with different
    types (Users, Groups, Mounts, Hosts, etc...)</code></pre>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>RecordName</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='symbol'>:name</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>PrimaryGroupID</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='symbol'>:gid</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>NFSHomeDirectory</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='symbol'>:home</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>UserShell</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='symbol'>:shell</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>UniqueID</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='symbol'>:uid</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>RealName</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='symbol'>:comment</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Password</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='symbol'>:password</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>GeneratedUID</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='symbol'>:guid</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>IPAddress</span><span class='tstring_end'>'</span></span>    <span class='op'>=&gt;</span> <span class='symbol'>:ip_address</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ENetAddress</span><span class='tstring_end'>'</span></span>  <span class='op'>=&gt;</span> <span class='symbol'>:en_address</span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>GroupMembership</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='symbol'>:members</span><span class='comma'>,</span>
<span class='rbrace'>}</span></pre></dd>
      
        <dt id="ns_to_ds_attribute_map-classvariable" class="">@@ns_to_ds_attribute_map =
          <div class="docstring">
  <div class="discussion">
    <p>
JJM The same table as above, inverted.
</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>RecordName</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:gid</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>PrimaryGroupID</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:home</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>NFSHomeDirectory</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:shell</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>UserShell</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:uid</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>UniqueID</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:comment</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>RealName</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:password</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Password</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:guid</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>GeneratedUID</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:en_address</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>ENetAddress</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:ip_address</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>IPAddress</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:members</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>GroupMembership</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
<span class='rbrace'>}</span></pre></dd>
      
        <dt id="password_hash_dir-classvariable" class="">@@password_hash_dir =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/var/db/shadow/hash</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
    </dl>
  




  <h2>Class Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#ds_path%3D-class_method" title="ds_path= (class method)">+ (Object) <strong>ds_path</strong> </a>
    

    
  </span>
  
  
    
    <span class="note title writeonly">writeonly</span>
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
JJM: This allows us to pass information when calling.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#macosx_version_major%3D-class_method" title="macosx_version_major= (class method)">+ (Object) <strong>macosx_version_major</strong> </a>
    

    
  </span>
  
  
    
    <span class="note title writeonly">writeonly</span>
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Sets the attribute macosx_version_major.
</p>
</div></span>
  
</li>

    
  </ul>



  
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="../../Provider.html" title="Puppet::Provider (class)">Puppet::Provider</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Provider.html#model-instance_method" title="Puppet::Provider#model (method)">#model</a></span>, <span class='object_link'><a href="../../Provider.html#resource-instance_method" title="Puppet::Provider#resource (method)">#resource</a></span></p>

  
  
  <h3 class="inherited">Attributes included from <span class='object_link'><a href="../../Util/Docs.html" title="Puppet::Util::Docs (module)">Util::Docs</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Util/Docs.html#doc-instance_method" title="Puppet::Util::Docs#doc (method)">#doc</a></span>, <span class='object_link'><a href="../../Util/Docs.html#nodoc-instance_method" title="Puppet::Util::Docs#nodoc (method)">#nodoc</a></span></p>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_attribute_hash-class_method" title="generate_attribute_hash (class method)">+ (Object) <strong>generate_attribute_hash</strong>(input_hash, *type_properties) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_ds_path-class_method" title="get_ds_path (class method)">+ (Object) <strong>get_ds_path</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_exec_preamble-class_method" title="get_exec_preamble (class method)">+ (Object) <strong>get_exec_preamble</strong>(ds_action, resource_name = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_macosx_version_major-class_method" title="get_macosx_version_major (class method)">+ (Object) <strong>get_macosx_version_major</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_password-class_method" title="get_password (class method)">+ (Object) <strong>get_password</strong>(guid) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#instances-class_method" title="instances (class method)">+ (Object) <strong>instances</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#list_all_present-class_method" title="list_all_present (class method)">+ (Object) <strong>list_all_present</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_dscl_plist_data-class_method" title="parse_dscl_plist_data (class method)">+ (Object) <strong>parse_dscl_plist_data</strong>(dscl_output) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_dscl_url_data-class_method" title="parse_dscl_url_data (class method)">+ (Object) <strong>parse_dscl_url_data</strong>(dscl_output) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_password-class_method" title="set_password (class method)">+ (Object) <strong>set_password</strong>(resource_name, guid, password_hash) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#single_report-class_method" title="single_report (class method)">+ (Object) <strong>single_report</strong>(resource_name, *type_properties) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_members-instance_method" title="#add_members (instance method)">- (Object) <strong>add_members</strong>(current_members, new_members) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">- (Object) <strong>create</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
NBK: we override @parent.create as we need to execute a series of commands
to create objects with dscl, rather than the single command nameservice.rb
expects to be returned by addcmd.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#deletecmd-instance_method" title="#deletecmd (instance method)">- (Object) <strong>deletecmd</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ensure%3D-instance_method" title="#ensure= (instance method)">- (Object) <strong>ensure=</strong>(ensure_value) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#getinfo-instance_method" title="#getinfo (instance method)">- (Object) <strong>getinfo</strong>(refresh = false) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#password%3D-instance_method" title="#password= (instance method)">- (Object) <strong>password=</strong>(passphrase) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_unwanted_members-instance_method" title="#remove_unwanted_members (instance method)">- (Object) <strong>remove_unwanted_members</strong>(current_members, new_members) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set-instance_method" title="#set (instance method)">- (Object) <strong>set</strong>(param, value) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
NBK: we override @parent.set as we need to execute a series of commands to
deal with array values, rather than the single command nameservice.rb
expects to be returned by modifycmd.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="../NameService.html" title="Puppet::Provider::NameService (class)">Puppet::Provider::NameService</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../NameService.html#autogen-instance_method" title="Puppet::Provider::NameService#autogen (method)">#autogen</a></span>, <span class='object_link'><a href="../NameService.html#autogen_default-class_method" title="Puppet::Provider::NameService.autogen_default (method)">autogen_default</a></span>, <span class='object_link'><a href="../NameService.html#autogen_defaults-class_method" title="Puppet::Provider::NameService.autogen_defaults (method)">autogen_defaults</a></span>, <span class='object_link'><a href="../NameService.html#autogen_id-instance_method" title="Puppet::Provider::NameService#autogen_id (method)">#autogen_id</a></span>, <span class='object_link'><a href="../NameService.html#delete-instance_method" title="Puppet::Provider::NameService#delete (method)">#delete</a></span>, <span class='object_link'><a href="../NameService.html#ensure-instance_method" title="Puppet::Provider::NameService#ensure (method)">#ensure</a></span>, <span class='object_link'><a href="../NameService.html#exists%3F-instance_method" title="Puppet::Provider::NameService#exists? (method)">#exists?</a></span>, <span class='object_link'><a href="../NameService.html#get-instance_method" title="Puppet::Provider::NameService#get (method)">#get</a></span>, <span class='object_link'><a href="../NameService.html#groups-instance_method" title="Puppet::Provider::NameService#groups (method)">#groups</a></span>, <span class='object_link'><a href="../NameService.html#info2hash-instance_method" title="Puppet::Provider::NameService#info2hash (method)">#info2hash</a></span>, <span class='object_link'><a href="../NameService.html#initialize-instance_method" title="Puppet::Provider::NameService#initialize (method)">#initialize</a></span>, <span class='object_link'><a href="../NameService.html#initvars-class_method" title="Puppet::Provider::NameService.initvars (method)">initvars</a></span>, <span class='object_link'><a href="../NameService.html#listbyname-class_method" title="Puppet::Provider::NameService.listbyname (method)">listbyname</a></span>, <span class='object_link'><a href="../NameService.html#option-class_method" title="Puppet::Provider::NameService.option (method)">option</a></span>, <span class='object_link'><a href="../NameService.html#options-class_method" title="Puppet::Provider::NameService.options (method)">options</a></span>, <span class='object_link'><a href="../NameService.html#resource_type%3D-class_method" title="Puppet::Provider::NameService.resource_type= (method)">resource_type=</a></span>, <span class='object_link'><a href="../NameService.html#section-class_method" title="Puppet::Provider::NameService.section (method)">section</a></span>, <span class='object_link'><a href="../NameService.html#validate-class_method" title="Puppet::Provider::NameService.validate (method)">validate</a></span>, <span class='object_link'><a href="../NameService.html#verify-class_method" title="Puppet::Provider::NameService.verify (method)">verify</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="../../Provider.html" title="Puppet::Provider (class)">Puppet::Provider</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Provider.html#clear-instance_method" title="Puppet::Provider#clear (method)">#clear</a></span>, <span class='object_link'><a href="../../Provider.html#command-class_method" title="Puppet::Provider.command (method)">command</a></span>, <span class='object_link'><a href="../../Provider.html#command-instance_method" title="Puppet::Provider#command (method)">#command</a></span>, <span class='object_link'><a href="../../Provider.html#commands-class_method" title="Puppet::Provider.commands (method)">commands</a></span>, <span class='object_link'><a href="../../Provider.html#declared_feature%3F-class_method" title="Puppet::Provider.declared_feature? (method)">declared_feature?</a></span>, <span class='object_link'><a href="../../Provider.html#default%3F-class_method" title="Puppet::Provider.default? (method)">default?</a></span>, <span class='object_link'><a href="../../Provider.html#defaultfor-class_method" title="Puppet::Provider.defaultfor (method)">defaultfor</a></span>, <span class='object_link'><a href="../../Provider.html#get-instance_method" title="Puppet::Provider#get (method)">#get</a></span>, <span class='object_link'><a href="../../Provider.html#initialize-instance_method" title="Puppet::Provider#initialize (method)">#initialize</a></span>, <span class='object_link'><a href="../../Provider.html#initvars-class_method" title="Puppet::Provider.initvars (method)">initvars</a></span>, <span class='object_link'><a href="../../Provider.html#make_command_methods-class_method" title="Puppet::Provider.make_command_methods (method)">make_command_methods</a></span>, <span class='object_link'><a href="../../Provider.html#mk_resource_methods-class_method" title="Puppet::Provider.mk_resource_methods (method)">mk_resource_methods</a></span>, <span class='object_link'><a href="../../Provider.html#mkmodelmethods-class_method" title="Puppet::Provider.mkmodelmethods (method)">mkmodelmethods</a></span>, <span class='object_link'><a href="../../Provider.html#name-instance_method" title="Puppet::Provider#name (method)">#name</a></span>, <span class='object_link'><a href="../../Provider.html#optional_commands-class_method" title="Puppet::Provider.optional_commands (method)">optional_commands</a></span>, <span class='object_link'><a href="../../Provider.html#specificity-class_method" title="Puppet::Provider.specificity (method)">specificity</a></span>, <span class='object_link'><a href="../../Provider.html#supports_parameter%3F-class_method" title="Puppet::Provider.supports_parameter? (method)">supports_parameter?</a></span>, <span class='object_link'><a href="../../Provider.html#to_s-instance_method" title="Puppet::Provider#to_s (method)">#to_s</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Util/Logging.html" title="Puppet::Util::Logging (module)">Util::Logging</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Util/Logging.html#send_log-instance_method" title="Puppet::Util::Logging#send_log (method)">#send_log</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Util/Docs.html" title="Puppet::Util::Docs (module)">Util::Docs</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Util/Docs.html#desc-instance_method" title="Puppet::Util::Docs#desc (method)">#desc</a></span>, <span class='object_link'><a href="../../Util/Docs.html#dochook-instance_method" title="Puppet::Util::Docs#dochook (method)">#dochook</a></span>, <span class='object_link'><a href="../../Util/Docs.html#doctable-instance_method" title="Puppet::Util::Docs#doctable (method)">#doctable</a></span>, <span class='object_link'><a href="../../Util/Docs.html#nodoc%3F-instance_method" title="Puppet::Util::Docs#nodoc? (method)">#nodoc?</a></span>, <span class='object_link'><a href="../../Util/Docs.html#pad-instance_method" title="Puppet::Util::Docs#pad (method)">#pad</a></span>, <span class='object_link'><a href="../../Util/Docs.html#scrub-instance_method" title="Puppet::Util::Docs#scrub (method)">#scrub</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Util.html" title="Puppet::Util (module)">Util</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Util.html#activerecord_version-class_method" title="Puppet::Util.activerecord_version (method)">activerecord_version</a></span>, <span class='object_link'><a href="../../Util.html#benchmark-instance_method" title="Puppet::Util#benchmark (method)">#benchmark</a></span>, <span class='object_link'><a href="../../Util.html#chuser-class_method" title="Puppet::Util.chuser (method)">chuser</a></span>, <span class='object_link'><a href="../../Util.html#classproxy-class_method" title="Puppet::Util.classproxy (method)">classproxy</a></span>, <span class='object_link'><a href="../../Util.html#execfail-instance_method" title="Puppet::Util#execfail (method)">#execfail</a></span>, <span class='object_link'><a href="../../Util.html#execpipe-instance_method" title="Puppet::Util#execpipe (method)">#execpipe</a></span>, <span class='object_link'><a href="../../Util.html#execute-instance_method" title="Puppet::Util#execute (method)">#execute</a></span>, <span class='object_link'><a href="../../Util.html#logmethods-class_method" title="Puppet::Util.logmethods (method)">logmethods</a></span>, <span class='object_link'><a href="../../Util.html#memory-instance_method" title="Puppet::Util#memory (method)">#memory</a></span>, <span class='object_link'><a href="../../Util.html#proxy-class_method" title="Puppet::Util.proxy (method)">proxy</a></span>, <span class='object_link'><a href="../../Util.html#recmkdir-class_method" title="Puppet::Util.recmkdir (method)">recmkdir</a></span>, <span class='object_link'><a href="../../Util.html#replace_file-instance_method" title="Puppet::Util#replace_file (method)">#replace_file</a></span>, <span class='object_link'><a href="../../Util.html#symbolize-instance_method" title="Puppet::Util#symbolize (method)">#symbolize</a></span>, <span class='object_link'><a href="../../Util.html#symbolizehash-instance_method" title="Puppet::Util#symbolizehash (method)">#symbolizehash</a></span>, <span class='object_link'><a href="../../Util.html#symbolizehash%21-instance_method" title="Puppet::Util#symbolizehash! (method)">#symbolizehash!</a></span>, <span class='object_link'><a href="../../Util.html#synchronize_on-class_method" title="Puppet::Util.synchronize_on (method)">synchronize_on</a></span>, <span class='object_link'><a href="../../Util.html#thinmark-instance_method" title="Puppet::Util#thinmark (method)">#thinmark</a></span>, <span class='object_link'><a href="../../Util.html#threadlock-instance_method" title="Puppet::Util#threadlock (method)">#threadlock</a></span>, <span class='object_link'><a href="../../Util.html#which-instance_method" title="Puppet::Util#which (method)">#which</a></span>, <span class='object_link'><a href="../../Util.html#withumask-class_method" title="Puppet::Util.withumask (method)">withumask</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Util/POSIX.html" title="Puppet::Util::POSIX (module)">Util::POSIX</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Util/POSIX.html#get_posix_field-instance_method" title="Puppet::Util::POSIX#get_posix_field (method)">#get_posix_field</a></span>, <span class='object_link'><a href="../../Util/POSIX.html#gid-instance_method" title="Puppet::Util::POSIX#gid (method)">#gid</a></span>, <span class='object_link'><a href="../../Util/POSIX.html#idfield-instance_method" title="Puppet::Util::POSIX#idfield (method)">#idfield</a></span>, <span class='object_link'><a href="../../Util/POSIX.html#methodbyid-instance_method" title="Puppet::Util::POSIX#methodbyid (method)">#methodbyid</a></span>, <span class='object_link'><a href="../../Util/POSIX.html#methodbyname-instance_method" title="Puppet::Util::POSIX#methodbyname (method)">#methodbyname</a></span>, <span class='object_link'><a href="../../Util/POSIX.html#search_posix_field-instance_method" title="Puppet::Util::POSIX#search_posix_field (method)">#search_posix_field</a></span>, <span class='object_link'><a href="../../Util/POSIX.html#uid-instance_method" title="Puppet::Util::POSIX#uid (method)">#uid</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../Confiner.html" title="Puppet::Provider::Confiner (module)">Confiner</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Confiner.html#confine-instance_method" title="Puppet::Provider::Confiner#confine (method)">#confine</a></span>, <span class='object_link'><a href="../Confiner.html#confine_collection-instance_method" title="Puppet::Provider::Confiner#confine_collection (method)">#confine_collection</a></span>, <span class='object_link'><a href="../Confiner.html#suitable%3F-instance_method" title="Puppet::Provider::Confiner#suitable? (method)">#suitable?</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Util/Warnings.html" title="Puppet::Util::Warnings (module)">Util::Warnings</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Util/Warnings.html#clear_warnings-instance_method" title="Puppet::Util::Warnings#clear_warnings (method)">#clear_warnings</a></span>, <span class='object_link'><a href="../../Util/Warnings.html#notice_once-instance_method" title="Puppet::Util::Warnings#notice_once (method)">#notice_once</a></span>, <span class='object_link'><a href="../../Util/Warnings.html#warnonce-instance_method" title="Puppet::Util::Warnings#warnonce (method)">#warnonce</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../Util/Errors.html" title="Puppet::Util::Errors (module)">Util::Errors</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../Util/Errors.html#adderrorcontext-instance_method" title="Puppet::Util::Errors#adderrorcontext (method)">#adderrorcontext</a></span>, <span class='object_link'><a href="../../Util/Errors.html#devfail-instance_method" title="Puppet::Util::Errors#devfail (method)">#devfail</a></span>, <span class='object_link'><a href="../../Util/Errors.html#error_context-instance_method" title="Puppet::Util::Errors#error_context (method)">#error_context</a></span>, <span class='object_link'><a href="../../Util/Errors.html#exceptwrap-instance_method" title="Puppet::Util::Errors#exceptwrap (method)">#exceptwrap</a></span>, <span class='object_link'><a href="../../Util/Errors.html#fail-instance_method" title="Puppet::Util::Errors#fail (method)">#fail</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <p class="notice">This class inherits a constructor from <span class='object_link'><a href="../NameService.html#initialize-instance_method" title="Puppet::Provider::NameService#initialize (method)">Puppet::Provider::NameService</a></span></p>
  
</div>

  <div id="class_attr_details" class="attr_details">
    <h2>Class Attribute Details</h2>
    
      
      <span id="ds_path=-class_method"></span>
      <span id=""></span>
      <div class="method_details first">
  <p class="signature first" id="ds_path=-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>ds_path=</strong>(value)  <span class="extras">(writeonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
JJM: This allows us to pass information when calling
</p>
<pre class="code ruby"><code>
     Puppet::Type.type
 e.g. Puppet::Type.type(:user).provide :directoryservice, :ds_path =&gt; &quot;Users&quot;
 This is referenced in the get_ds_path class method</code></pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


29
30
31</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 29</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ds_path='>ds_path=</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='ivar'>@ds_path</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 29</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">29
30
31
32</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_ds_path='>ds_path=</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='ivar'>@ds_path</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      
      <span id="macosx_version_major=-class_method"></span>
      <span id=""></span>
      <div class="method_details ">
  <p class="signature " id="macosx_version_major=-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>macosx_version_major=</strong>(value)  <span class="extras">(writeonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets the attribute macosx_version_major
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'></span>
      
      
      
        &mdash;
        <div class='inline'><p>
the value to set the attribute macosx_version_major to.
</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 30</span>

<span class='kw'>def</span> <span class='id identifier rubyid_macosx_version_major='>macosx_version_major=</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='ivar'>@macosx_version_major</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 30</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">30
31
32
33</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_macosx_version_major='>macosx_version_major=</span><span class='lparen'>(</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='ivar'>@macosx_version_major</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="generate_attribute_hash-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>generate_attribute_hash</strong>(input_hash, *type_properties) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 182</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_generate_attribute_hash'>generate_attribute_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_input_hash'>input_hash</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_type_properties'>type_properties</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_attribute_hash'>attribute_hash</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_input_hash'>input_hash</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='op'>|</span>
    <span class='id identifier rubyid_ds_attribute'>ds_attribute</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dsAttrTypeStandard:</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='cvar'>@@ds_to_ns_attribute_map</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_ds_attribute'>ds_attribute</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_type_properties'>type_properties</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='cvar'>@@ds_to_ns_attribute_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_ds_attribute'>ds_attribute</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_ds_value'>ds_value</span> <span class='op'>=</span> <span class='id identifier rubyid_input_hash'>input_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span>
    <span class='kw'>case</span> <span class='cvar'>@@ds_to_ns_attribute_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_ds_attribute'>ds_attribute</span><span class='rbracket'>]</span>
      <span class='kw'>when</span> <span class='symbol'>:members</span>
        <span class='id identifier rubyid_ds_value'>ds_value</span> <span class='op'>=</span> <span class='id identifier rubyid_ds_value'>ds_value</span> <span class='comment'># only members uses arrays so far
</span>      <span class='kw'>when</span> <span class='symbol'>:gid</span><span class='comma'>,</span> <span class='symbol'>:uid</span>
        <span class='comment'># OS X stores objects like uid/gid as strings.
</span>        <span class='comment'># Try casting to an integer for these cases to be
</span>        <span class='comment'># consistent with the other providers and the group type
</span>        <span class='comment'># validation
</span>        <span class='kw'>begin</span>
          <span class='id identifier rubyid_ds_value'>ds_value</span> <span class='op'>=</span> <span class='const'>Integer</span><span class='lparen'>(</span><span class='id identifier rubyid_ds_value'>ds_value</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>rescue</span> <span class='const'>ArgumentError</span>
          <span class='id identifier rubyid_ds_value'>ds_value</span> <span class='op'>=</span> <span class='id identifier rubyid_ds_value'>ds_value</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
      <span class='kw'>else</span> <span class='id identifier rubyid_ds_value'>ds_value</span> <span class='op'>=</span> <span class='id identifier rubyid_ds_value'>ds_value</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_attribute_hash'>attribute_hash</span><span class='lbracket'>[</span><span class='cvar'>@@ds_to_ns_attribute_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_ds_attribute'>ds_attribute</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_ds_value'>ds_value</span>
  <span class='kw'>end</span>

  <span class='comment'># NBK: need to read the existing password here as it's not actually
</span>  <span class='comment'># stored in the user record. It is stored at a path that involves the
</span>  <span class='comment'># UUID of the user record for non-Mobile local acccounts.
</span>  <span class='comment'># Mobile Accounts are out of scope for this provider for now
</span>  <span class='id identifier rubyid_attribute_hash'>attribute_hash</span><span class='lbracket'>[</span><span class='symbol'>:password</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_password'>get_password</span><span class='lparen'>(</span><span class='id identifier rubyid_attribute_hash'>attribute_hash</span><span class='lbracket'>[</span><span class='symbol'>:guid</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@resource_type</span><span class='period'>.</span><span class='id identifier rubyid_validproperties'>validproperties</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:password</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_features'>features</span><span class='period'>.</span><span class='id identifier rubyid_root?'>root?</span>
  <span class='id identifier rubyid_attribute_hash'>attribute_hash</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 182</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">182
183
184
185
186
187
188
189
190
191
192</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def self.generate_attribute_hash(input_hash, *type_properties)
  attribute_hash = {}
  input_hash.keys.each do |key|
    ds_attribute = key.sub(&quot;dsAttrTypeStandard:&quot;, &quot;&quot;)
    next unless (@@ds_to_ns_attribute_map.keys.include?(ds_attribute) and type_properties.include? @@ds_to_ns_attribute_map[ds_attribute])
    ds_value = input_hash[key]
    case @@ds_to_ns_attribute_map[ds_attribute]
      when :members
        ds_value = ds_value # only members uses arrays so far
      when :gid, :uid</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
OS X stores objects like uid/gid as strings. Try casting to an integer for
these cases to be consistent with the other providers and the group type
validation
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">196
197
198
199
200
201
202
203
204
205
206</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">        begin
          ds_value = Integer(ds_value[0])
        rescue ArgumentError
          ds_value = ds_value[0]
        end
      else ds_value = ds_value[0]
    end
    attribute_hash[@@ds_to_ns_attribute_map[ds_attribute]] = ds_value
  end
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
NBK: need to read the existing password here as it&#8217;s not actually
stored in the user record. It is stored at a path that involves the UUID of
the user record for non-Mobile local acccounts. Mobile Accounts are out of
scope for this provider for now
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">210
211
212
213</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  attribute_hash[:password] = self.get_password(attribute_hash[:guid]) if @resource_type.validproperties.include?(:password) and Puppet.features.root?
  attribute_hash
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="get_ds_path-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_ds_path</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


91
92
93
94
95
96
97
98
99
100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 91</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_ds_path'>get_ds_path</span>
  <span class='comment'># JJM: 2007-07-24 This method dynamically returns the DS path we're concerned with.
</span>  <span class='comment'>#      For example, if we're working with an user type, this will be /Users
</span>  <span class='comment'>#      with a group type, this will be /Groups.
</span>  <span class='comment'>#   @ds_path is an attribute of the class itself.
</span>  <span class='kw'>return</span> <span class='ivar'>@ds_path</span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='ivar'>@ds_path</span><span class='rparen'>)</span>
  <span class='comment'># JJM: &quot;Users&quot; or &quot;Groups&quot; etc ...  (Based on the Puppet::Type)
</span>  <span class='comment'>#       Remember this is a class method, so self.class is Class
</span>  <span class='comment'>#       Also, @resource_type seems to be the reference to the
</span>  <span class='comment'>#       Puppet::Type this class object is providing for.
</span>  <span class='ivar'>@resource_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_capitalize'>capitalize</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>s</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 91</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">91
92</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def self.get_ds_path</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM: 2007-07-24 This method dynamically returns the DS path we&#8217;re
concerned with.
</p>
<pre class="code ruby"><code>
     For example, if we're working with an user type, this will be /Users
     with a group type, this will be /Groups.
  @ds_path is an attribute of the class itself.</code></pre>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">96
97</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  <span class='kw'>return</span> <span class='ivar'>@ds_path</span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='ivar'>@ds_path</span><span class='rparen'>)</span></pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM: &#8220;Users&#8221; or &#8220;Groups&#8221; etc &#8230;  (Based on the
Puppet::Type)
</p>
<pre class="code ruby"><code>
      Remember this is a class method, so self.class is Class
      Also, @resource_type seems to be the reference to the
      Puppet::Type this class object is providing for.</code></pre>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">101
102
103</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  @resource_type.name.to_s.capitalize + &quot;s&quot;
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="get_exec_preamble-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_exec_preamble</strong>(ds_action, resource_name = nil) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 249</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_exec_preamble'>get_exec_preamble</span><span class='lparen'>(</span><span class='id identifier rubyid_ds_action'>ds_action</span><span class='comma'>,</span> <span class='id identifier rubyid_resource_name'>resource_name</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'># JJM 2007-07-24
</span>  <span class='comment'>#     DSCL commands are often repetitive and contain the same positional
</span>  <span class='comment'>#     arguments over and over. See http://developer.apple.com/documentation/Porting/Conceptual/PortingUnix/additionalfeatures/chapter_10_section_9.html
</span>  <span class='comment'>#     for an example of what I mean.
</span>  <span class='comment'>#     This method spits out proper DSCL commands for us.
</span>  <span class='comment'>#     We EXPECT name to be @resource[:name] when called from an instance object.
</span>
  <span class='comment'># 10.4 doesn't support the -plist option for dscl, and 10.5 has a
</span>  <span class='comment'># different format for the -url output with objects with spaces in
</span>  <span class='comment'># their values. *sigh*. Use -url for 10.4 in the hope this can be
</span>  <span class='comment'># deprecated one day, and use -plist for 10.5 and higher.
</span>  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_macosx_version_major'>get_macosx_version_major</span> <span class='op'>&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>10.4</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_command_vector'>command_vector</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_command'>command</span><span class='lparen'>(</span><span class='symbol'>:dscl</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-plist</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='rbracket'>]</span>
  <span class='kw'>elsif</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_macosx_version_major'>get_macosx_version_major</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>10.4</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_command_vector'>command_vector</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_command'>command</span><span class='lparen'>(</span><span class='symbol'>:dscl</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-url</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Puppet does not support OS X versions &lt; 10.4</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># JJM: The actual action to perform.  See &quot;man dscl&quot;
</span>  <span class='comment'>#      Common actiosn: -create, -delete, -merge, -append, -passwd
</span>  <span class='id identifier rubyid_command_vector'>command_vector</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ds_action'>ds_action</span>
  <span class='comment'># JJM: get_ds_path will spit back &quot;Users&quot; or &quot;Groups&quot;,
</span>  <span class='comment'># etc...  Depending on the Puppet::Type of our self.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_resource_name'>resource_name</span>
    <span class='id identifier rubyid_command_vector'>command_vector</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_get_ds_path'>get_ds_path</span><span class='rbrace'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_resource_name'>resource_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_command_vector'>command_vector</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_get_ds_path'>get_ds_path</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='comment'># JJM:  This returns most of the preamble of the command.
</span>  <span class='comment'>#       e.g. 'dscl / -create /Users/mccune'
</span>  <span class='id identifier rubyid_command_vector'>command_vector</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 249</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">249
250</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def self.get_exec_preamble(ds_action, resource_name = nil)</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM 2007-07-24
</p>
<pre class="code ruby"><code>
    DSCL commands are often repetitive and contain the same positional
    arguments over and over. See http://developer.apple.com/documentation/Porting/Conceptual/PortingUnix/additionalfeatures/chapter_10_section_9.html
    for an example of what I mean.
    This method spits out proper DSCL commands for us.
    We EXPECT name to be @resource[:name] when called from an instance object.</code></pre>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">256
257</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"></pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
10.4 doesn&#8217;t support the -plist option for dscl, and 10.5 has a
different format for the -url output with objects with spaces in their
values. <b>sigh</b>. Use -url for 10.4 in the hope this can be deprecated
one day, and use -plist for 10.5 and higher.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">261
262
263
264
265
266
267
268
269</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_macosx_version_major'>get_macosx_version_major</span> <span class='op'>&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>10.4</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_command_vector'>command_vector</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_command'>command</span><span class='lparen'>(</span><span class='symbol'>:dscl</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-plist</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='rbracket'>]</span>
  <span class='kw'>elsif</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_macosx_version_major'>get_macosx_version_major</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>10.4</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_command_vector'>command_vector</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_command'>command</span><span class='lparen'>(</span><span class='symbol'>:dscl</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-url</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Puppet does not support OS X versions &lt; 10.4</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM: The actual action to perform.  See &#8220;man dscl&#8220;
</p>
<pre class="code ruby"><code>
     Common actiosn: -create, -delete, -merge, -append, -passwd</code></pre>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">271
272</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  <span class='id identifier rubyid_command_vector'>command_vector</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ds_action'>ds_action</span></pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM: get_ds_path will spit back &#8220;Users&#8221; or
&#8220;Groups&#8221;, etc&#8230;  Depending on the Puppet::Type of our
self.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">274
275
276
277
278
279</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  <span class='kw'>if</span> <span class='id identifier rubyid_resource_name'>resource_name</span>
    <span class='id identifier rubyid_command_vector'>command_vector</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_get_ds_path'>get_ds_path</span><span class='rbrace'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_resource_name'>resource_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_command_vector'>command_vector</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_get_ds_path'>get_ds_path</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span></pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM:  This returns most of the preamble of the command.
</p>
<pre class="code ruby"><code>
      e.g. 'dscl / -create /Users/mccune'</code></pre>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">281
282
283</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  command_vector
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="get_macosx_version_major-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_macosx_version_major</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 104</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_macosx_version_major'>get_macosx_version_major</span>
  <span class='kw'>return</span> <span class='ivar'>@macosx_version_major</span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='ivar'>@macosx_version_major</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='comment'># Make sure we've loaded all of the facts
</span>    <span class='const'>Facter</span><span class='period'>.</span><span class='id identifier rubyid_loadfacts'>loadfacts</span>

    <span class='kw'>if</span> <span class='const'>Facter</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='lparen'>(</span><span class='symbol'>:macosx_productversion_major</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_product_version_major'>product_version_major</span> <span class='op'>=</span> <span class='const'>Facter</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='lparen'>(</span><span class='symbol'>:macosx_productversion_major</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='comment'># TODO: remove this code chunk once we require Facter 1.5.5 or higher.
</span>      <span class='const'>Puppet</span><span class='period'>.</span><span class='id identifier rubyid_warning'>warning</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DEPRECATION WARNING: Future versions of the directoryservice provider will require Facter 1.5.5 or newer.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_product_version'>product_version</span> <span class='op'>=</span> <span class='const'>Facter</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='lparen'>(</span><span class='symbol'>:macosx_productversion</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not determine OS X version from Facter</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_product_version'>product_version</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_product_version_major'>product_version_major</span> <span class='op'>=</span> <span class='id identifier rubyid_product_version'>product_version</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(\d+)\.(\d+).</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_product_version_major'>product_version_major</span><span class='rbrace'>}</span><span class='tstring_content'> is not supported by the directoryservice provider</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>10.0</span><span class='words_sep'> </span><span class='tstring_content'>10.1</span><span class='words_sep'> </span><span class='tstring_content'>10.2</span><span class='words_sep'> </span><span class='tstring_content'>10.3</span><span class='words_sep'>}</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_product_version_major'>product_version_major</span><span class='rparen'>)</span>
    <span class='ivar'>@macosx_version_major</span> <span class='op'>=</span> <span class='id identifier rubyid_product_version_major'>product_version_major</span>
    <span class='kw'>return</span> <span class='ivar'>@macosx_version_major</span>
  <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not determine OS X version: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_detail'>detail</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 104</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">104
105
106
107</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def self.get_macosx_version_major
  return @macosx_version_major if defined?(@macosx_version_major)
  begin</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Make sure we&#8217;ve loaded all of the facts
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">108
109
110
111
112
113</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    Facter.loadfacts

    if Facter.value(:macosx_productversion_major)
      product_version_major = Facter.value(:macosx_productversion_major)
    else</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
TODO: remove this code chunk once we require Facter 1.5.5 or higher.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">114
115
116
117
118
119
120
121
122
123
124
125
126</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">      Puppet.warning(&quot;DEPRECATION WARNING: Future versions of the directoryservice provider will require Facter 1.5.5 or newer.&quot;)
      product_version = Facter.value(:macosx_productversion)
      fail(&quot;Could not determine OS X version from Facter&quot;) if product_version.nil?
      product_version_major = product_version.scan(/(\d+)\.(\d+)./).join(&quot;.&quot;)
    end
    fail(&quot;#{product_version_major} is not supported by the directoryservice provider&quot;) if %w{10.0 10.1 10.2 10.3}.include?(product_version_major)
    @macosx_version_major = product_version_major
    return @macosx_version_major
  rescue Puppet::ExecutionFailure =&gt; detail
    fail(&quot;Could not determine OS X version: #{detail}&quot;)
  end
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="get_password-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_password</strong>(guid) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


315
316
317
318
319
320
321
322
323
324
325</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 315</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_password'>get_password</span><span class='lparen'>(</span><span class='id identifier rubyid_guid'>guid</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_password_hash'>password_hash</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_password_hash_file'>password_hash_file</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='cvar'>@@password_hash_dir</span><span class='rbrace'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_guid'>guid</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_password_hash_file'>password_hash_file</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span><span class='lparen'>(</span><span class='id identifier rubyid_password_hash_file'>password_hash_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not read password hash file at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_password_hash_file'>password_hash_file</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_readable?'>readable?</span><span class='lparen'>(</span><span class='id identifier rubyid_password_hash_file'>password_hash_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_password_hash_file'>password_hash_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_password_hash'>password_hash</span> <span class='op'>=</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
    <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_password_hash'>password_hash</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 315</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">315
316
317
318
319
320
321
322
323
324
325
326</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_password'>get_password</span><span class='lparen'>(</span><span class='id identifier rubyid_guid'>guid</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_password_hash'>password_hash</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_password_hash_file'>password_hash_file</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='cvar'>@@password_hash_dir</span><span class='rbrace'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_guid'>guid</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_password_hash_file'>password_hash_file</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span><span class='lparen'>(</span><span class='id identifier rubyid_password_hash_file'>password_hash_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not read password hash file at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_password_hash_file'>password_hash_file</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='kw'>not</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_readable?'>readable?</span><span class='lparen'>(</span><span class='id identifier rubyid_password_hash_file'>password_hash_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_password_hash_file'>password_hash_file</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_password_hash'>password_hash</span> <span class='op'>=</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
    <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_password_hash'>password_hash</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="instances-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>instances</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81
82
83
84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 78</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_instances'>instances</span>
  <span class='comment'># JJM Class method that provides an array of instance objects of this
</span>  <span class='comment'>#     type.
</span>  <span class='comment'># JJM: Properties are dependent on the Puppet::Type we're managine.
</span>  <span class='id identifier rubyid_type_property_array'>type_property_array</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='ivar'>@resource_type</span><span class='period'>.</span><span class='id identifier rubyid_validproperties'>validproperties</span>

  <span class='comment'># Create a new instance of this Puppet::Type for each object present
</span>  <span class='comment'>#    on the system.
</span>  <span class='id identifier rubyid_list_all_present'>list_all_present</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name_string'>name_string</span><span class='op'>|</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_single_report'>single_report</span><span class='lparen'>(</span><span class='id identifier rubyid_name_string'>name_string</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_type_property_array'>type_property_array</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 78</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">78
79</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def self.instances</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM Class method that provides an array of instance objects of this
</p>
<pre class="code ruby"><code>
    type.
</code></pre>
<p>
JJM: Properties are dependent on the Puppet::Type we&#8217;re managine.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">82
83
84</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  <span class='id identifier rubyid_type_property_array'>type_property_array</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='ivar'>@resource_type</span><span class='period'>.</span><span class='id identifier rubyid_validproperties'>validproperties</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Create a new instance of this Puppet::Type for each object present
</p>
<pre class="code ruby"><code>
   on the system.</code></pre>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">86
87
88
89
90</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  list_all_present.collect do |name_string|
    self.new(single_report(name_string, *type_property_array))
  end
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="list_all_present-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>list_all_present</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


128
129
130
131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 128</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_list_all_present'>list_all_present</span>
  <span class='comment'># JJM: List all objects of this Puppet::Type already present on the system.
</span>  <span class='kw'>begin</span>
    <span class='id identifier rubyid_dscl_output'>dscl_output</span> <span class='op'>=</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_get_exec_preamble'>get_exec_preamble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-list</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not get </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource_type</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'> list from DirectoryService</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_dscl_output'>dscl_output</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 128</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">128
129</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def self.list_all_present</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM: List all objects of this Puppet::Type already present on the system.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">130
131
132
133
134
135
136
137</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  begin
    dscl_output = execute(get_exec_preamble(&quot;-list&quot;))
  rescue Puppet::ExecutionFailure =&gt; detail
    fail(&quot;Could not get #{@resource_type.name} list from DirectoryService&quot;)
  end
  dscl_output.split(&quot;\n&quot;)
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="parse_dscl_plist_data-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>parse_dscl_plist_data</strong>(dscl_output) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


178
179
180</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 178</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parse_dscl_plist_data'>parse_dscl_plist_data</span><span class='lparen'>(</span><span class='id identifier rubyid_dscl_output'>dscl_output</span><span class='rparen'>)</span>
  <span class='const'>Plist</span><span class='period'>.</span><span class='id identifier rubyid_parse_xml'>parse_xml</span><span class='lparen'>(</span><span class='id identifier rubyid_dscl_output'>dscl_output</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 178</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">178
179
180
181</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parse_dscl_plist_data'>parse_dscl_plist_data</span><span class='lparen'>(</span><span class='id identifier rubyid_dscl_output'>dscl_output</span><span class='rparen'>)</span>
  <span class='const'>Plist</span><span class='period'>.</span><span class='id identifier rubyid_parse_xml'>parse_xml</span><span class='lparen'>(</span><span class='id identifier rubyid_dscl_output'>dscl_output</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="parse_dscl_url_data-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>parse_dscl_url_data</strong>(dscl_output) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 138</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parse_dscl_url_data'>parse_dscl_url_data</span><span class='lparen'>(</span><span class='id identifier rubyid_dscl_output'>dscl_output</span><span class='rparen'>)</span>
  <span class='comment'># we need to construct a Hash from the dscl -url output to match
</span>  <span class='comment'># that returned by the dscl -plist output for 10.5+ clients.
</span>  <span class='comment'>#
</span>  <span class='comment'># Nasty assumptions:
</span>  <span class='comment'>#   a) no values *end* in a colon ':', only keys
</span>  <span class='comment'>#   b) if a line ends in a colon and the next line does start with
</span>  <span class='comment'>#      a space, then the second line is a value of the first.
</span>  <span class='comment'>#   c) (implied by (b)) keys don't start with spaces.
</span>
  <span class='id identifier rubyid_dscl_plist'>dscl_plist</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_dscl_output'>dscl_output</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_array'>array</span><span class='comma'>,</span> <span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_line'>line</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s+</span><span class='regexp_end'>/</span></span>   <span class='comment'># it's a value
</span>      <span class='id identifier rubyid_array'>array</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_line'>line</span> <span class='comment'># add the value to the previous key
</span>    <span class='kw'>else</span>
      <span class='id identifier rubyid_array'>array</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_line'>line</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_array'>array</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>

  <span class='id identifier rubyid_dscl_output'>dscl_output</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
    <span class='comment'># This should be a 'normal' entry. key and value on one line.
</span>    <span class='comment'># We split on ': ' to deal with keys/values with a colon in them.
</span>    <span class='id identifier rubyid_split_array'>split_array</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>:\s+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_split_array'>split_array</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='const'>CGI</span><span class='op'>::</span><span class='id identifier rubyid_unescape'>unescape</span><span class='lparen'>(</span><span class='id identifier rubyid_split_array'>split_array</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='rparen'>)</span>
    <span class='comment'># We need to treat GroupMembership separately as it is currently
</span>    <span class='comment'># the only attribute we care about multiple values for, and
</span>    <span class='comment'># the values can never contain spaces (shortnames)
</span>    <span class='comment'># We also make every value an array to be consistent with the
</span>    <span class='comment'># output of dscl -plist under 10.5
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GroupMembership</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_dscl_plist'>dscl_plist</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_dscl_plist'>dscl_plist</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_value'>value</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_dscl_plist'>dscl_plist</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 138</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">138
139</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def self.parse_dscl_url_data(dscl_output)</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
we need to construct a Hash from the dscl -url output to match that
returned by the dscl -plist output for 10.5+ clients.
</p>
<p>
Nasty assumptions:
</p>
<pre class="code ruby"><code>
  a) no values *end* in a colon ':', only keys
  b) if a line ends in a colon and the next line does start with
     a space, then the second line is a value of the first.
  c) (implied by (b)) keys don't start with spaces.</code></pre>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">147
148
149
150
151
152
153
154
155
156
157
158
159</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">
  dscl_plist = {}
  dscl_output.split(&quot;\n&quot;).inject([]) do |array, line|
    if line =~ /^\s+/   # it's a value
      array[-1] &lt;&lt; line # add the value to the previous key
    else
      array &lt;&lt; line
    end
    array
  end.compact

  dscl_output.each do |line|</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
This should be a &#8216;normal&#8217; entry. key and value on one line. We
split on &#8217;: &#8217; to deal with keys/values with a colon in them.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">161
162
163
164</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='id identifier rubyid_split_array'>split_array</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>:\s+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_split_array'>split_array</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='const'>CGI</span><span class='op'>::</span><span class='id identifier rubyid_unescape'>unescape</span><span class='lparen'>(</span><span class='id identifier rubyid_split_array'>split_array</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='rparen'>)</span></pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
We need to treat GroupMembership separately as it is currently the only
attribute we care about multiple values for, and the values can never
contain spaces (shortnames) We also make every value an array to be
consistent with the output of dscl -plist under 10.5
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">169
170
171
172
173
174
175
176
177</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    if key == &quot;GroupMembership&quot;
      dscl_plist[key] = value.split(/\s/)
    else
      dscl_plist[key] = [value]
    end
  end
  dscl_plist
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="set_password-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>set_password</strong>(resource_name, guid, password_hash) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 284</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set_password'>set_password</span><span class='lparen'>(</span><span class='id identifier rubyid_resource_name'>resource_name</span><span class='comma'>,</span> <span class='id identifier rubyid_guid'>guid</span><span class='comma'>,</span> <span class='id identifier rubyid_password_hash'>password_hash</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_password_hash_file'>password_hash_file</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='cvar'>@@password_hash_dir</span><span class='rbrace'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_guid'>guid</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>begin</span>
    <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='id identifier rubyid_password_hash_file'>password_hash_file</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>w</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_f'>f</span><span class='op'>|</span> <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_password_hash'>password_hash</span><span class='rparen'>)</span><span class='rbrace'>}</span>
  <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>EACCES</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not write to password hash file: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_detail'>detail</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># NBK: For shadow hashes, the user AuthenticationAuthority must contain a value of
</span>  <span class='comment'># &quot;;ShadowHash;&quot;. The LKDC in 10.5 makes this more interesting though as it
</span>  <span class='comment'># will dynamically generate ;Kerberosv5;;username@LKDC:SHA1 attributes if
</span>  <span class='comment'># missing. Thus we make sure we only set ;ShadowHash; if it is missing, and
</span>  <span class='comment'># we can do this with the merge command. This allows people to continue to
</span>  <span class='comment'># use other custom AuthenticationAuthority attributes without stomping on them.
</span>  <span class='comment'>#
</span>  <span class='comment'># There is a potential problem here in that we're only doing this when setting
</span>  <span class='comment'># the password, and the attribute could get modified at other times while the
</span>  <span class='comment'># hash doesn't change and so this doesn't get called at all... but
</span>  <span class='comment'># without switching all the other attributes to merge instead of create I can't
</span>  <span class='comment'># see a simple enough solution for this that doesn't modify the user record
</span>  <span class='comment'># every single time. This should be a rather rare edge case. (famous last words)
</span>
  <span class='id identifier rubyid_dscl_vector'>dscl_vector</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_exec_preamble'>get_exec_preamble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-merge</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_resource_name'>resource_name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dscl_vector'>dscl_vector</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AuthenticationAuthority</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>;ShadowHash;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_dscl_output'>dscl_output</span> <span class='op'>=</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_dscl_vector'>dscl_vector</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not set AuthenticationAuthority.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 284</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">284
285
286
287
288
289
290
291
292</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def self.set_password(resource_name, guid, password_hash)
  password_hash_file = &quot;#{@@password_hash_dir}/#{guid}&quot;
  begin
    File.open(password_hash_file, 'w') { |f| f.write(password_hash)}
  rescue Errno::EACCES =&gt; detail
    fail(&quot;Could not write to password hash file: #{detail}&quot;)
  end
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
NBK: For shadow hashes, the user AuthenticationAuthority must contain a
value of &#8220;;ShadowHash;&#8221;. The LKDC in 10.5 makes this more
interesting though as it will dynamically generate
;Kerberosv5;;username@LKDC:SHA1 attributes if missing. Thus we make sure we
only set ;ShadowHash; if it is missing, and we can do this with the merge
command. This allows people to continue to use other custom
AuthenticationAuthority attributes without stomping on them.
</p>
<p>
There is a potential problem here in that we&#8217;re only doing this when
setting the password, and the attribute could get modified at other times
while the hash doesn&#8217;t change and so this doesn&#8217;t get called at
all&#8230; but without switching all the other attributes to merge instead
of create I can&#8217;t see a simple enough solution for this that
doesn&#8217;t modify the user record every single time. This should be a
rather rare edge case. (famous last words)
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">305
306
307
308
309
310
311
312
313
314</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">
  dscl_vector = self.get_exec_preamble(&quot;-merge&quot;, resource_name)
  dscl_vector &lt;&lt; &quot;AuthenticationAuthority&quot; &lt;&lt; &quot;;ShadowHash;&quot;
  begin
    dscl_output = execute(dscl_vector)
  rescue Puppet::ExecutionFailure =&gt; detail
    fail(&quot;Could not set AuthenticationAuthority.&quot;)
  end
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="single_report-class_method">
  
    + (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>single_report</strong>(resource_name, *type_properties) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 214</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_single_report'>single_report</span><span class='lparen'>(</span><span class='id identifier rubyid_resource_name'>resource_name</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_type_properties'>type_properties</span><span class='rparen'>)</span>
  <span class='comment'># JJM 2007-07-24:
</span>  <span class='comment'>#     Given a the name of an object and a list of properties of that
</span>  <span class='comment'>#     object, return all property values in a hash.
</span>  <span class='comment'>#
</span>  <span class='comment'>#     This class method returns nil if the object doesn't exist
</span>  <span class='comment'>#     Otherwise, it returns a hash of the object properties.
</span>
  <span class='id identifier rubyid_all_present_str_array'>all_present_str_array</span> <span class='op'>=</span> <span class='id identifier rubyid_list_all_present'>list_all_present</span>

  <span class='comment'># NBK: shortcut the process if the resource is missing
</span>  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_all_present_str_array'>all_present_str_array</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_resource_name'>resource_name</span>

  <span class='id identifier rubyid_dscl_vector'>dscl_vector</span> <span class='op'>=</span> <span class='id identifier rubyid_get_exec_preamble'>get_exec_preamble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-read</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_resource_name'>resource_name</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_dscl_output'>dscl_output</span> <span class='op'>=</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_dscl_vector'>dscl_vector</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not get report.  command execution failed.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Two code paths is ugly, but until we can drop 10.4 support we don't
</span>  <span class='comment'># have a lot of choice. Ultimately this should all be done using Ruby
</span>  <span class='comment'># to access the DirectoryService APIs directly, but that's simply not
</span>  <span class='comment'># feasible for a while yet.
</span>  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_macosx_version_major'>get_macosx_version_major</span> <span class='op'>&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>10.4</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_dscl_plist'>dscl_plist</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parse_dscl_plist_data'>parse_dscl_plist_data</span><span class='lparen'>(</span><span class='id identifier rubyid_dscl_output'>dscl_output</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get_macosx_version_major'>get_macosx_version_major</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>10.4</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_dscl_plist'>dscl_plist</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parse_dscl_url_data'>parse_dscl_url_data</span><span class='lparen'>(</span><span class='id identifier rubyid_dscl_output'>dscl_output</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Puppet does not support OS X versions &lt; 10.4</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_generate_attribute_hash'>generate_attribute_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_dscl_plist'>dscl_plist</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_type_properties'>type_properties</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 214</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">214
215</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def self.single_report(resource_name, *type_properties)</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM 2007-07-24:
</p>
<pre class="code ruby"><code>
    Given a the name of an object and a list of properties of that
    object, return all property values in a hash.

    This class method returns nil if the object doesn't exist
    Otherwise, it returns a hash of the object properties.</code></pre>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">221
222
223
224</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">
  <span class='id identifier rubyid_all_present_str_array'>all_present_str_array</span> <span class='op'>=</span> <span class='id identifier rubyid_list_all_present'>list_all_present</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
NBK: shortcut the process if the resource is missing
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">225
226
227
228
229
230
231
232
233
234</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_all_present_str_array'>all_present_str_array</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_resource_name'>resource_name</span>

  <span class='id identifier rubyid_dscl_vector'>dscl_vector</span> <span class='op'>=</span> <span class='id identifier rubyid_get_exec_preamble'>get_exec_preamble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-read</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_resource_name'>resource_name</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_dscl_output'>dscl_output</span> <span class='op'>=</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_dscl_vector'>dscl_vector</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not get report.  command execution failed.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Two code paths is ugly, but until we can drop 10.4 support we don&#8217;t
have a lot of choice. Ultimately this should all be done using Ruby to
access the DirectoryService APIs directly, but that&#8217;s simply not
feasible for a while yet.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">238
239
240
241
242
243
244
245
246
247
248</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  if self.get_macosx_version_major &gt; &quot;10.4&quot;
    dscl_plist = self.parse_dscl_plist_data(dscl_output)
  elsif self.get_macosx_version_major == &quot;10.4&quot;
    dscl_plist = self.parse_dscl_url_data(dscl_output)
  else
    fail(&quot;Puppet does not support OS X versions &lt; 10.4&quot;)
  end

  self.generate_attribute_hash(dscl_plist, *type_properties)
end</pre>
      </td>
    </tr>
  

</table>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="add_members-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>add_members</strong>(current_members, new_members) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


459
460
461
462
463
464
465
466
467
468
469
470</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 459</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_members'>add_members</span><span class='lparen'>(</span><span class='id identifier rubyid_current_members'>current_members</span><span class='comma'>,</span> <span class='id identifier rubyid_new_members'>new_members</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new_members'>new_members</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_new_member'>new_member</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_current_members'>current_members</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='kw'>not</span> <span class='id identifier rubyid_current_members'>current_members</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_new_member'>new_member</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='symbol'>:dseditgroup</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-o</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>edit</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-a</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_member'>new_member</span><span class='comma'>,</span> <span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not add </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_member'>new_member</span><span class='rbrace'>}</span><span class='tstring_content'> to group: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_detail'>detail</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 459</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">459
460
461
462
463
464
465
466
467
468
469
470
471</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_add_members'>add_members</span><span class='lparen'>(</span><span class='id identifier rubyid_current_members'>current_members</span><span class='comma'>,</span> <span class='id identifier rubyid_new_members'>new_members</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new_members'>new_members</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_new_member'>new_member</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_current_members'>current_members</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='kw'>not</span> <span class='id identifier rubyid_current_members'>current_members</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_new_member'>new_member</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='symbol'>:dseditgroup</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-o</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>edit</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-a</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_member'>new_member</span><span class='comma'>,</span> <span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not add </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_member'>new_member</span><span class='rbrace'>}</span><span class='tstring_content'> to group: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_detail'>detail</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="create-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>create</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
NBK: we override @parent.create as we need to execute a series of commands
to create objects with dscl, rather than the single command nameservice.rb
expects to be returned by addcmd. Thus we don&#8217;t bother defining
addcmd.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 399</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_exists?'>exists?</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>already exists</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='comment'># NBK: First we create the object with a known guid so we can set the contents
</span>  <span class='comment'># of the password hash if required
</span>  <span class='comment'># Shelling out sucks, but for a single use case it doesn't seem worth
</span>  <span class='comment'># requiring people install a UUID library that doesn't come with the system.
</span>  <span class='comment'># This should be revisited if Puppet starts managing UUIDs for other platform
</span>  <span class='comment'># user records.
</span>  <span class='id identifier rubyid_guid'>guid</span> <span class='op'>=</span> <span class='backtick'>%x{</span><span class='tstring_content'>/usr/bin/uuidgen</span><span class='tstring_end'>}</span></span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>

  <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_get_exec_preamble'>get_exec_preamble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>&lt;&lt;</span> <span class='cvar'>@@ns_to_ds_attribute_map</span><span class='lbracket'>[</span><span class='symbol'>:guid</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_guid'>guid</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not set GeneratedUID for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_detail'>detail</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span><span class='lparen'>(</span><span class='symbol'>:password</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_set_password'>set_password</span><span class='lparen'>(</span><span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_guid'>guid</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Now we create all the standard properties
</span>  <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Type</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='lparen'>(</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_validproperties'>validproperties</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_property'>property</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_property'>property</span> <span class='op'>==</span> <span class='symbol'>:ensure</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span><span class='lparen'>(</span><span class='id identifier rubyid_property'>property</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_property'>property</span> <span class='op'>==</span> <span class='symbol'>:members</span>
        <span class='id identifier rubyid_add_members'>add_members</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_get_exec_preamble'>get_exec_preamble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>&lt;&lt;</span> <span class='cvar'>@@ns_to_ds_attribute_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_symbolize'>symbolize</span><span class='lparen'>(</span><span class='id identifier rubyid_property'>property</span><span class='rparen'>)</span><span class='rbracket'>]</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_property'>property</span> <span class='op'>==</span> <span class='symbol'>:password</span>  <span class='comment'># skip setting the password here
</span>        <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span><span class='rparen'>)</span>
        <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
          <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not create </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_detail'>detail</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 399</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">399
400
401
402
403
404
405</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def create
  if exists?
    info &quot;already exists&quot;
    return nil
  end
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
NBK: First we create the object with a known guid so we can set the
contents of the password hash if required Shelling out sucks, but for a
single use case it doesn&#8217;t seem worth requiring people install a UUID
library that doesn&#8217;t come with the system. This should be revisited
if Puppet starts managing UUIDs for other platform user records.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">411
412
413
414
415
416
417
418
419
420
421
422
423
424
425</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  <span class='id identifier rubyid_guid'>guid</span> <span class='op'>=</span> <span class='backtick'>%x{</span><span class='tstring_content'>/usr/bin/uuidgen</span><span class='tstring_end'>}</span></span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>

  <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_get_exec_preamble'>get_exec_preamble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>&lt;&lt;</span> <span class='cvar'>@@ns_to_ds_attribute_map</span><span class='lbracket'>[</span><span class='symbol'>:guid</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_guid'>guid</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not set GeneratedUID for </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_detail'>detail</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span><span class='lparen'>(</span><span class='symbol'>:password</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_set_password'>set_password</span><span class='lparen'>(</span><span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_guid'>guid</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Now we create all the standard properties
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  Puppet::Type.type(@resource.class.name).validproperties.each do |property|
    next if property == :ensure
    if value = @resource.should(property) and value != &quot;&quot;
      if property == :members
        add_members(nil, value)
      else
        exec_arg_vector = self.class.get_exec_preamble(&quot;-create&quot;, @resource[:name])
        exec_arg_vector &lt;&lt; @@ns_to_ds_attribute_map[symbolize(property)]
        next if property == :password  # skip setting the password here
        exec_arg_vector &lt;&lt; value.to_s
        begin
          execute(exec_arg_vector)
        rescue Puppet::ExecutionFailure =&gt; detail
          fail(&quot;Could not create #{@resource.class.name} #{@resource.name}: #{detail}&quot;)
        end
      end
    end
  end
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="deletecmd-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>deletecmd</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


472
473
474
475
476
477</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 472</span>

<span class='kw'>def</span> <span class='id identifier rubyid_deletecmd'>deletecmd</span>
  <span class='comment'># JJM: Like addcmd, only called when deleting the object itself
</span>  <span class='comment'>#    Note, this isn't used to delete properties of the object,
</span>  <span class='comment'>#    at least that's how I understand it...
</span>  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_get_exec_preamble'>get_exec_preamble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-delete</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 472</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">472
473</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def deletecmd</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM: Like addcmd, only called when deleting the object itself
</p>
<pre class="code ruby"><code>
   Note, this isn't used to delete properties of the object,
   at least that's how I understand it...</code></pre>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">476
477
478</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  self.class.get_exec_preamble(&quot;-delete&quot;, @resource[:name])
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="ensure=-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>ensure=</strong>(ensure_value) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 327</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ensure='>ensure=</span><span class='lparen'>(</span><span class='id identifier rubyid_ensure_value'>ensure_value</span><span class='rparen'>)</span>
  <span class='kw'>super</span>
  <span class='comment'># We need to loop over all valid properties for the type we're
</span>  <span class='comment'># managing and call the method which sets that property value
</span>  <span class='comment'># dscl can't create everything at once unfortunately.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_ensure_value'>ensure_value</span> <span class='op'>==</span> <span class='symbol'>:present</span>
    <span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_validproperties'>validproperties</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_name'>name</span> <span class='op'>==</span> <span class='symbol'>:ensure</span>
      <span class='comment'># LAK: We use property.sync here rather than directly calling
</span>      <span class='comment'># the settor method because the properties might do some kind
</span>      <span class='comment'># of conversion.  In particular, the user gid property might
</span>      <span class='comment'># have a string and need to convert it to a number
</span>      <span class='kw'>if</span> <span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_should'>should</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
        <span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_property'>property</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sync'>sync</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>=</span> <span class='id identifier rubyid_autogen'>autogen</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
        <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 327</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">327
328
329</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def ensure=(ensure_value)
  super</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
We need to loop over all valid properties for the type we&#8217;re managing
and call the method which sets that property value dscl can&#8217;t create
everything at once unfortunately.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">332
333
334
335</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  if ensure_value == :present
    @resource.class.validproperties.each do |name|
      next if name == :ensure</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
LAK: We use property.sync here rather than directly calling the settor
method because the properties might do some kind of conversion.  In
particular, the user gid property might have a string and need to convert
it to a number
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">339
340
341
342
343
344
345
346
347
348
349</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">      if @resource.should(name)
        @resource.property(name).sync
      elsif value = autogen(name)
        self.send(name.to_s + &quot;=&quot;, value)
      else
        next
      end
    end
  end
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="getinfo-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>getinfo</strong>(refresh = false) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 479</span>

<span class='kw'>def</span> <span class='id identifier rubyid_getinfo'>getinfo</span><span class='lparen'>(</span><span class='id identifier rubyid_refresh'>refresh</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='comment'># JJM 2007-07-24:
</span>  <span class='comment'>#      Override the getinfo method, which is also defined in nameservice.rb
</span>  <span class='comment'>#      This method returns and sets @infohash
</span>  <span class='comment'># I'm not re-factoring the name &quot;getinfo&quot; because this method will be
</span>  <span class='comment'># most likely called by nameservice.rb, which I didn't write.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_refresh'>refresh</span> <span class='kw'>or</span> <span class='lparen'>(</span><span class='op'>!</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='ivar'>@property_value_cache_hash</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='op'>!</span> <span class='ivar'>@property_value_cache_hash</span><span class='rparen'>)</span>
    <span class='comment'># JJM 2007-07-24: OK, there's a bit of magic that's about to
</span>    <span class='comment'># happen... Let's see how strong my grip has become... =)
</span>    <span class='comment'>#
</span>    <span class='comment'># self is a provider instance of some Puppet::Type, like
</span>    <span class='comment'># Puppet::Type::User::ProviderDirectoryservice for the case of the
</span>    <span class='comment'># user type and this provider.
</span>    <span class='comment'>#
</span>    <span class='comment'># self.class looks like &quot;user provider directoryservice&quot;, if that
</span>    <span class='comment'># helps you ...
</span>    <span class='comment'>#
</span>    <span class='comment'># self.class.resource_type is a reference to the Puppet::Type class,
</span>    <span class='comment'># probably Puppet::Type::User or Puppet::Type::Group, etc...
</span>    <span class='comment'>#
</span>    <span class='comment'># self.class.resource_type.validproperties is a class method,
</span>    <span class='comment'># returning an Array of the valid properties of that specific
</span>    <span class='comment'># Puppet::Type.
</span>    <span class='comment'>#
</span>    <span class='comment'># So... something like [:comment, :home, :password, :shell, :uid,
</span>    <span class='comment'># :groups, :ensure, :gid]
</span>    <span class='comment'>#
</span>    <span class='comment'># Ultimately, we add :name to the list, delete :ensure from the
</span>    <span class='comment'># list, then report on the remaining list. Pretty whacky, ehh?
</span>    <span class='id identifier rubyid_type_properties'>type_properties</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_resource_type'>resource_type</span><span class='period'>.</span><span class='id identifier rubyid_validproperties'>validproperties</span>
    <span class='id identifier rubyid_type_properties'>type_properties</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:ensure</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_type_properties'>type_properties</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='symbol'>:ensure</span>
    <span class='id identifier rubyid_type_properties'>type_properties</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:guid</span>  <span class='comment'># append GeneratedUID so we just get the report here
</span>    <span class='ivar'>@property_value_cache_hash</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_single_report'>single_report</span><span class='lparen'>(</span><span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_type_properties'>type_properties</span><span class='rparen'>)</span>
    <span class='lbracket'>[</span><span class='symbol'>:uid</span><span class='comma'>,</span> <span class='symbol'>:gid</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_param'>param</span><span class='op'>|</span>
      <span class='ivar'>@property_value_cache_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_param'>param</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@property_value_cache_hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_param'>param</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='kw'>if</span> <span class='ivar'>@property_value_cache_hash</span> <span class='kw'>and</span> <span class='ivar'>@property_value_cache_hash</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_param'>param</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@property_value_cache_hash</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 479</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">479
480</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def getinfo(refresh = false)</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM 2007-07-24:
</p>
<pre class="code ruby"><code>
     Override the getinfo method, which is also defined in nameservice.rb
     This method returns and sets @infohash
</code></pre>
<p>
I&#8217;m not re-factoring the name &#8220;getinfo&#8221; because this
method will be most likely called by nameservice.rb, which I didn&#8217;t
write.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">485
486</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  if refresh or (! defined?(@property_value_cache_hash) or ! @property_value_cache_hash)</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM 2007-07-24: OK, there&#8217;s a bit of magic that&#8217;s about to
happen&#8230; Let&#8217;s see how strong my grip has become&#8230; =)
</p>
<p>
self is a provider instance of some Puppet::Type, like
Puppet::Type::User::ProviderDirectoryservice for the case of the user type
and this provider.
</p>
<p>
self.class looks like &#8220;user provider directoryservice&#8221;, if that
helps you &#8230;
</p>
<p>
self.class.resource_type is a reference to the Puppet::Type class, probably
Puppet::Type::User or Puppet::Type::Group, etc&#8230;
</p>
<p>
self.class.resource_type.validproperties is a class method, returning an
Array of the valid properties of that specific Puppet::Type.
</p>
<p>
So&#8230; something like [:comment, :home, :password, :shell, :uid,
:groups, :ensure, :gid]
</p>
<p>
Ultimately, we add :name to the list, delete :ensure from the list, then
report on the remaining list. Pretty whacky, ehh?
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">508
509
510
511
512
513
514
515
516
517
518</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    type_properties = [:name] + self.class.resource_type.validproperties
    type_properties.delete(:ensure) if type_properties.include? :ensure
    type_properties &lt;&lt; :guid  # append GeneratedUID so we just get the report here
    @property_value_cache_hash = self.class.single_report(@resource[:name], *type_properties)
    [:uid, :gid].each do |param|
      @property_value_cache_hash[param] = @property_value_cache_hash[param].to_i if @property_value_cache_hash and @property_value_cache_hash.include?(param)
    end
  end
  @property_value_cache_hash
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="password=-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>password=</strong>(passphrase) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


350
351
352
353
354
355
356
357
358
359
360
361
362
363
364</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 350</span>

<span class='kw'>def</span> <span class='id identifier rubyid_password='>password=</span><span class='lparen'>(</span><span class='id identifier rubyid_passphrase'>passphrase</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_get_exec_preamble'>get_exec_preamble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-read</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>&lt;&lt;</span> <span class='cvar'>@@ns_to_ds_attribute_map</span><span class='lbracket'>[</span><span class='symbol'>:guid</span><span class='rbracket'>]</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_guid_output'>guid_output</span> <span class='op'>=</span> <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_guid_plist'>guid_plist</span> <span class='op'>=</span> <span class='const'>Plist</span><span class='period'>.</span><span class='id identifier rubyid_parse_xml'>parse_xml</span><span class='lparen'>(</span><span class='id identifier rubyid_guid_output'>guid_output</span><span class='rparen'>)</span>
    <span class='comment'># Although GeneratedUID like all DirectoryService values can be multi-valued
</span>    <span class='comment'># according to the schema, in practice user accounts cannot have multiple UUIDs
</span>    <span class='comment'># otherwise Bad Things Happen, so we just deal with the first value.
</span>    <span class='id identifier rubyid_guid'>guid</span> <span class='op'>=</span> <span class='id identifier rubyid_guid_plist'>guid_plist</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dsAttrTypeStandard:</span><span class='embexpr_beg'>#{</span><span class='cvar'>@@ns_to_ds_attribute_map</span><span class='lbracket'>[</span><span class='symbol'>:guid</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_set_password'>set_password</span><span class='lparen'>(</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_guid'>guid</span><span class='comma'>,</span> <span class='id identifier rubyid_passphrase'>passphrase</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not set </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_param'>param</span><span class='rbrace'>}</span><span class='tstring_content'> on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>]: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_detail'>detail</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 350</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">350
351
352
353
354
355
356</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def password=(passphrase)
  exec_arg_vector = self.class.get_exec_preamble(&quot;-read&quot;, @resource.name)
  exec_arg_vector &lt;&lt; @@ns_to_ds_attribute_map[:guid]
  begin
    guid_output = execute(exec_arg_vector)
    guid_plist = Plist.parse_xml(guid_output)</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
Although GeneratedUID like all DirectoryService values can be multi-valued
according to the schema, in practice user accounts cannot have multiple
UUIDs otherwise Bad Things Happen, so we just deal with the first value.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">359
360
361
362
363
364
365</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    guid = guid_plist[&quot;dsAttrTypeStandard:#{@@ns_to_ds_attribute_map[:guid]}&quot;][0]
    self.class.set_password(@resource.name, guid, passphrase)
  rescue Puppet::ExecutionFailure =&gt; detail
    fail(&quot;Could not set #{param} on #{@resource.class.name}[#{@resource.name}]: #{detail}&quot;)
  end
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="remove_unwanted_members-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>remove_unwanted_members</strong>(current_members, new_members) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


446
447
448
449
450
451
452
453
454
455
456
457</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 446</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_unwanted_members'>remove_unwanted_members</span><span class='lparen'>(</span><span class='id identifier rubyid_current_members'>current_members</span><span class='comma'>,</span> <span class='id identifier rubyid_new_members'>new_members</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current_members'>current_members</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_member'>member</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_new_members'>new_members</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_member'>member</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='symbol'>:dseditgroup</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-o</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>edit</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-d</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_member'>member</span><span class='comma'>,</span> <span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not remove </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_member'>member</span><span class='rbrace'>}</span><span class='tstring_content'> from group: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_detail'>detail</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 446</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">446
447
448
449
450
451
452
453
454
455
456
457
458</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_remove_unwanted_members'>remove_unwanted_members</span><span class='lparen'>(</span><span class='id identifier rubyid_current_members'>current_members</span><span class='comma'>,</span> <span class='id identifier rubyid_new_members'>new_members</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current_members'>current_members</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_member'>member</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='kw'>not</span> <span class='id identifier rubyid_new_members'>new_members</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_member'>member</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='symbol'>:dseditgroup</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-o</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>edit</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-d</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_member'>member</span><span class='comma'>,</span> <span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
        <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not remove </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_member'>member</span><span class='rbrace'>}</span><span class='tstring_content'> from group: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_detail'>detail</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <p class="signature " id="set-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>set</strong>(param, value) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
NBK: we override @parent.set as we need to execute a series of commands to
deal with array values, rather than the single command nameservice.rb
expects to be returned by modifycmd. Thus we don&#8217;t bother defining
modifycmd.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 370</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='id identifier rubyid_param'>param</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_validate'>validate</span><span class='lparen'>(</span><span class='id identifier rubyid_param'>param</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current_members'>current_members</span> <span class='op'>=</span> <span class='ivar'>@property_value_cache_hash</span><span class='lbracket'>[</span><span class='symbol'>:members</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_param'>param</span> <span class='op'>==</span> <span class='symbol'>:members</span>
    <span class='comment'># If we are meant to be authoritative for the group membership
</span>    <span class='comment'># then remove all existing members who haven't been specified
</span>    <span class='comment'># in the manifest.
</span>    <span class='id identifier rubyid_remove_unwanted_members'>remove_unwanted_members</span><span class='lparen'>(</span><span class='id identifier rubyid_current_members'>current_members</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:auth_membership</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='id identifier rubyid_current_members'>current_members</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

    <span class='comment'># if they're not a member, make them one.
</span>    <span class='id identifier rubyid_add_members'>add_members</span><span class='lparen'>(</span><span class='id identifier rubyid_current_members'>current_members</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_get_exec_preamble'>get_exec_preamble</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-create</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='comment'># JJM: The following line just maps the NS name to the DS name
</span>    <span class='comment'>#      e.g. { :uid =&gt; 'UniqueID' }
</span>    <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>&lt;&lt;</span> <span class='cvar'>@@ns_to_ds_attribute_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_symbolize'>symbolize</span><span class='lparen'>(</span><span class='id identifier rubyid_param'>param</span><span class='rparen'>)</span><span class='rbracket'>]</span>
    <span class='comment'># JJM: The following line sends the actual value to set the property to
</span>    <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>ExecutionFailure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
      <span class='id identifier rubyid_fail'>fail</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not set </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_param'>param</span><span class='rbrace'>}</span><span class='tstring_content'> on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='ivar'>@resource</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>]: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_detail'>detail</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/puppet/provider/nameservice/directoryservice.rb', line 370</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">370
371
372
373
374</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def set(param, value)
  self.class.validate(param, value)
  current_members = @property_value_cache_hash[:members]
  if param == :members</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
If we are meant to be authoritative for the group membership then remove
all existing members who haven&#8217;t been specified in the manifest.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">377
378
379</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='id identifier rubyid_remove_unwanted_members'>remove_unwanted_members</span><span class='lparen'>(</span><span class='id identifier rubyid_current_members'>current_members</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@resource</span><span class='lbracket'>[</span><span class='symbol'>:auth_membership</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='id identifier rubyid_current_members'>current_members</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
if they&#8217;re not a member, make them one.
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">380
381
382
383</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    add_members(current_members, value)
  else
    exec_arg_vector = self.class.get_exec_preamble(&quot;-create&quot;, @resource[:name])</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM: The following line just maps the NS name to the DS name
</p>
<pre class="code ruby"><code>
     e.g. { :uid =&gt; 'UniqueID' }</code></pre>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">385
386</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    <span class='id identifier rubyid_exec_arg_vector'>exec_arg_vector</span> <span class='op'>&lt;&lt;</span> <span class='cvar'>@@ns_to_ds_attribute_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_symbolize'>symbolize</span><span class='lparen'>(</span><span class='id identifier rubyid_param'>param</span><span class='rparen'>)</span><span class='rbracket'>]</span></pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    <p>
JJM: The following line sends the actual value to set the property to
</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">387
388
389
390
391
392
393
394
395</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    exec_arg_vector &lt;&lt; value.to_s
    begin
      execute(exec_arg_vector)
    rescue Puppet::ExecutionFailure =&gt; detail
      fail(&quot;Could not set #{param} on #{@resource.class.name}[#{@resource.name}]: #{detail}&quot;)
    end
  end
end</pre>
      </td>
    </tr>
  

</table>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Mar  6 02:14:34 2012 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.5 (ruby-1.9.2).
</div>

  </body>
</html>